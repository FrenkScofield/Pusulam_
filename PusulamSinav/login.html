<link href="assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<style>

    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }

    .TarihSecici {
        cursor: pointer;
        text-align: left;
        width: 100%;
        background: transparent;
        border: none;
        padding-left: 14px;
        padding-right: 14px;
        padding-top: 8px;
        padding-bottom: 7px;
    }

    .datepicker-dropdown {
        top: 190px !important;
    }

    .webTarih {
        top: 190px !important;
    }

    .mobilTarih {
        top: 125px !important;
    }

    [v-cloak] {
        display: none;
    }
</style>
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta charset="utf-8" />
    <title>Pusulam Login</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="Preview page of Metronic Admin Theme #4 for " name="description" />
    <meta content="" name="author" />
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
    <link href="assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.css" rel="stylesheet" />
    <link href="assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <link href="assets/global/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/global/plugins/select2/css/select2-bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- END PAGE LEVEL PLUGINS -->
    <!-- BEGIN THEME GLOBAL STYLES -->
    <link href="assets/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
    <link href="assets/global/css/plugins.min.css" rel="stylesheet" type="text/css" />
    <!-- END THEME GLOBAL STYLES -->
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link href="assets/pages/css/login.min.css" rel="stylesheet" type="text/css" />
    <!-- END PAGE LEVEL STYLES -->
    <!-- BEGIN THEME LAYOUT STYLES -->
    <!-- END THEME LAYOUT STYLES -->
    <link rel="shortcut icon" href="favicon.ico" />
</head>


<body class="login" style=" margin-top: 90px; color: #666666; font-weight: 100; background-image: url(img/arka.jpg); ">
    <div class="logo">
        <img src="img/okyanus_logoyeni.png" />
    </div>
    <div class="content" id="app">
        <form>
            <div v-cloak>

            <div v-if="!SIFREMIUNUTTUM">
                <h3 class="form-title font-green">Oturum Aç</h3>
                <div class="alert alert-danger display-hide">
                    <button class="close" data-close="alert"></button>
                    <span> Kullanıcı Adınızı ve Şifrenizi Giriniz. </span>
                </div>
                <div class="form-group">
                    <label class="control-label visible-ie8 visible-ie9">T.C. Kimlik Numarası</label>
                    <input class="form-control form-control-solid placeholder-no-fix" type="number" autocomplete="off" placeholder="T.C. Kimlik Numarası" name="username" v-model="TCKIMLIKNO" maxlength="11" onKeyPress="if(this.value.length==11) return false;" pattern="\d*" />
                </div>
                <div class="form-group">
                    <label class="control-label visible-ie8 visible-ie9">Şifre</label>
                    <input class="form-control form-control-solid placeholder-no-fix" type="password" autocomplete="off" placeholder="Şifre" name="password" v-model="SIFRE" v-on:keyup.enter="GirisYap" />
                </div>
                <div class="form-actions">
                    <button type="button"
                            class="btn green uppercase"
                            :disabled="TCKIMLIKNO == undefined || TCKIMLIKNO.length != 11 "
                            @click="GirisYap">
                        GİRİŞ YAP
                    </button>
                    <label class="rememberme check mt-checkbox mt-checkbox-outline">
                        <input type="checkbox" name="remember" v-model="beniHatirla" />Beni Hatırla
                        <span></span>
                    </label>
                    <div style="margin-top: 20px;">
                        <a href="javascript:;" id="forget-password" class="" @click="SifremiUnuttumAc">Şifremi Unuttum</a>
                    </div>
                </div>
                <div class="form-actions">

                    <button type="button"
                            class="btn blue uppercase"
                            style="width:100%"
                            @click="interaktifGit">
                        İNTERAKTİF'DEN GİRİŞ YAP
                    </button>
                </div>
            </div>
            <div v-if="SIFREMIUNUTTUM">
                <div class="row col-md-12">
                    <h3>Şifrenizi mi Unuttunuz?</h3>
                    <p style="text-align:justify">
                        Şifrenizi sıfırlamak için aşağıdaki alanları eksiksiz doldurunuz.
                    </p>
                    <div class="form-group">
                        <div class="input-icon">
                            <i class="fa fa-user"></i>
                            <input class="form-control placeholder-no-fix" type="text" maxlength="11" autocomplete="off" placeholder="TCNO" v-model="SIFRESIFIRLATCKIMLIKNO">
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-icon">
                            <i class="fa fa-envelope"></i>
                            <input class="form-control placeholder-no-fix" type="text" maxlength="150" autocomplete="off" placeholder="Ad Soyad" v-model="ADSOYAD">
                        </div>
                    </div>
                    <div class="col-md-12" style="padding:0px">
                        <div class="dropdown-toggle btn grey-cararra" data-toggle="dropdown" role="button" title="Doğum Tarihi" style="width:100%; padding:0px;">
                            <input type="text" id="birthday" v-model="DOGUMTARIHI" class="TarihSecici" readonly placeholder="Doğum tarihinizi seçiniz..">
                            <span class="bs-caret" style="position:absolute; right:12px; top:5px;">
                                <span class="caret"></span>
                            </span>
                        </div>
                    </div>
                    <!--<div class="form-group">
                        <c-tarih controller="SinavTanimla"
                                 :tarih="DOGUMTARIHI"
                                 @change-date="TarihSelected">
                        </c-tarih>
                    </div>-->
                    <div class="form-group">
                        <label v-show="KULLANICITIP==4">Lütfen velinizin TC Kimlik numarasını yazınız</label>
                        <label v-show="KULLANICITIP==5">Lütfen öğrencinizin TC Kimlik numarasını yazınız</label>
                        <label>{{REFERANCENAME_PLACEHOLDER}}</label>
                        <div v class="input-icon">
                            <i class="fa fa-envelope"></i>
                            <input class="form-control placeholder-no-fix" type="text" maxlength="50" autocomplete="off" placeholder="TC Kimlik No" v-model="REFERANCE_TCNO">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-icon">
                            <i class="fa fa-envelope"></i>
                            <input class="form-control placeholder-no-fix" type="password" maxlength="50" autocomplete="off" placeholder="Şifre" v-model="SIFRE" pattern="^[a-z]{2,4}$" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-icon">
                            <i class="fa fa-envelope"></i>
                            <input class="form-control placeholder-no-fix" type="password" maxlength="50" autocomplete="off" placeholder="Şifre Tekrar" v-model="SIFRETEKRAR" pattern="^[a-z]{2,4}$" required>
                        </div>
                    </div>


                    <div class="form-group" id="forgetformfooter">
                        <button type="button" class="btn yellow" @click="SIFREMIUNUTTUM = false">
                            <i class="fa fa-arrow-left"></i> Vazgeç
                        </button>
                        <button type="button" class="btn blue" @click="SifreSifirla">
                            Şifremi Oluştur <i class="fa fa-envelope"></i>
                        </button>
                    </div>
                </div>
            </div>
            </div>
        </form>
        <!--<form class="forget-form" action="index.html" method="post">
            <h3 class="font-green">Forget Password ?</h3>
            <p> Enter your e-mail address below to reset your password. </p>
            <div class="form-group">
                <input class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="Email" name="email" />
            </div>
            <div class="form-actions">
                <button type="button" id="back-btn" class="btn green btn-outline">Back</button>
                <button type="submit" class="btn btn-success uppercase pull-right">Submit</button>
            </div>
        </form>-->
    </div>
    <div class="copyright"> 2021 © Pusulam. Okyanus Kolejleri </div>


    <!-- BEGIN CORE PLUGINS -->
    <script src="assets/global/plugins/jquery.min.js" type="text/javascript"></script>
    <script src="assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="assets/global/plugins/js.cookie.min.js" type="text/javascript"></script>
    <script src="assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
    <script src="assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
    <script src="assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
    <script src="assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js" type="text/javascript"></script>
    <!-- END CORE PLUGINS -->
    <script src="assets/global/plugins/bootbox/bootbox.min.js"></script>
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <script src="assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
    <script src="assets/global/plugins/jquery-validation/js/additional-methods.min.js" type="text/javascript"></script>
    <script src="assets/global/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>
    <!-- END PAGE LEVEL PLUGINS -->
    <!-- BEGIN THEME GLOBAL SCRIPTS -->
    <script src="assets/global/scripts/app.min.js" type="text/javascript"></script>
    <!-- END THEME GLOBAL SCRIPTS -->
    <!-- BEGIN PAGE LEVEL SCRIPTS -->
    <script src="assets/pages/scripts/login.min.js" type="text/javascript"></script>
    <!-- END PAGE LEVEL SCRIPTS -->
    <!-- BEGIN THEME LAYOUT SCRIPTS -->
    <!-- END THEME LAYOUT SCRIPTS -->
    <script src="scripts/jquery.cookie.js"></script>
    <script src="scripts/Tools.js"></script>
    <script src="scripts/vue.js"></script>
    <script src="scripts/vue-resource.min.js"></script>
    <script src="assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js" type="text/javascript"></script>
    <script src="assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js" type="text/javascript"></script>
    <script src="assets/global/plugins/bootstrap-datepicker/locales/bootstrap-datepicker.tr.min.js" type="text/javascript"></script>
</body>
</html>


<script src="VueComponents/SinavFiltreleri.js?v=5"></script>
<script>
    var vue = new Vue({
        el: "#app",
        name: "Login",

        data: {
            controller: "Login",
            TCKIMLIKNO: undefined,
            SIFRE: undefined,
            beniHatirla: false,

            SIFREMI: false,
            SIFREMIUNUTTUM: false,
            SIFRESIFIRLATCKIMLIKNO: '',
            EPOSTA: '',
            SIFRETEKRAR: '',
            ADSOYAD: '',
            DOGUMTARIHI: '',
            REFERANCE_TCNO: '',
            KULLANICITIP: 0,
            REFERANCENAME_PLACEHOLDER: ''
        },

        mounted() {
            if (session != null) {
                window.location.replace("AnaSayfa.html#AnaSayfa");
            }
            
            this.TCKIMLIKNO = '';
            this.SIFRE = '';

        },

        methods: {

            TarihSelected(TARIH) {
                this.DOGUMTARIHI = TARIH;
            },
            GirisYap() {
                if (this.TCKIMLIKNO.length != 11) {
                    Alert_Warning("Lütfen TC ve şifre girip tekrar deneyiniz.")
                    return;
                }

                let p = { TCKIMLIKNO: this.TCKIMLIKNO, SIFRE: this.SIFRE };

                WebPost(this, this.controller, "GirisYap", p, '', '', function (data) {
                    if (data != null) {

                        $.removeCookie("K");
                        var expDate;
                        if (vue.beniHatirla) {
                            expDate = 1;
                        }
                        else {
                            expDate = new Date();
                            expDate.setTime(expDate.getTime() + (24 * 60 * 60 * 1000)); // 24 saat  (3 * 60)
                        }
                        $.cookie("K", JSON.stringify(data), { expires: expDate });
                        window.location.replace("AnaSayfa.html#AnaSayfa");
                    }
                    else {
                        Alert_Error("T.C. Kimlik Numaranızı veya Şifrenizi yanlış girdiniz. Lütfen tekrar deneyiniz.");
                    }
                })
            },
            interaktifGit() {
                let interaktifYol = 'https://interaktif'
                if (location.href.indexOf("https://pusulam.okyanuskoleji.k12.tr") > -1) {
                    interaktifYol = 'https://interaktif.okyanuskoleji.k12.tr/'
                }
                else if (location.href.indexOf("https://testpusulam") > -1) {
                    interaktifYol = 'https://testinteraktif.okyanuskoleji.k12.tr/'
                }
                window.location.replace(interaktifYol);
            },

            SifremiUnuttumAc() {

                if (this.TCKIMLIKNO == undefined || this.TCKIMLIKNO.length != 11) {
                    Alert_Warning('Öncelikle TC Kimlik Numaranızı giriniz.')
                    return;
                }
                let tc = this.TCKIMLIKNO
                let p = {
                    TCKIMLIKNO: tc
                }
                WebPost(this, this.controller, "SifreDegistirYetkiKontrol", p, '', '', function (data, parent) {

                    let sifreDegistirmeEngelliMi = data;
                    if (sifreDegistirmeEngelliMi == 0) {
                        if (tc) {
                            parent.SIFREMIUNUTTUM = true;
                            parent.SIFRESIFIRLATCKIMLIKNO = tc
                            vue.$nextTick(function () {
                                $('.TarihSecici').each(function () {
                                    $(this).datepicker({
                                        format: 'dd.mm.yyyy',
                                        language: 'tr',
                                        autoclose: true
                                    }).on(
                                        'changeDate', () => {
                                            var day1 = $(this).datepicker('getDate').getDate();
                                            var month1 = $(this).datepicker('getDate').getMonth() + 1;
                                            var year1 = $(this).datepicker('getDate').getFullYear();
                                            var fullDate = (day1 < 10 ? '0' + day1 : day1) + "." + (month1 < 10 ? '0' + month1 : month1) + "." + year1;

                                            vue.DOGUMTARIHI = fullDate;
                                        }
                                    ).on(
                                        'click', () => {
                                            if (Mobilmi())
                                                $(".datepicker-dropdown").addClass("mobilTarih");
                                            else
                                                $(".datepicker-dropdown").addClass("webTarih");
                                        }
                                    );
                                });
                            });



                            WebPost(parent, parent.controller, "OgrenciVeliSifreSifirlaKontrol", p, '', '', function (data, parentSub) {

                                if (data) {
                                    let resultData = JSON.parse(data)[0];
                                    if (resultData.ERRCODE > 0) {
                                        bootbox.alert(resultData.ERRMESSAGE);
                                        vue.SifremiUnuttumKapat()
                                        return false;
                                    }
                                    vue.REFERANCENAME_PLACEHOLDER = resultData.MASKED_ADSOYAD;
                                    vue.KULLANICITIP = resultData.KULLANICITIP;
                                    vue.REFERANCENAME = resultData.ADSOYAD;
                                    vue.KULLANICITIP = resultData.KULLANICITIP;

                                }
                                else {
                                    bootbox.alert("İşleminiz yapılamadı. Lütfen girdiğiniz bilgileri kontrol ediniz....");
                                }
                            });
                        }

                        else {
                            bootbox.alert("Lütfen TC Kimlik numaranızı giriniz!");
                        }
                    }
                    else {
                        bootbox.alert("Şifre değiştirme yetkiniz bulunmuyor.Lütfen sistem yöneticinize başvurunuz");
                    }
                });
            },
            SifremiUnuttumKapat() {
                this.SIFRESIFIRLATCKIMLIKNO = '';
                this.EPOSTA = '';
                this.SIFREMIUNUTTUM = false;
            },

            SifreSifirla() {
                $("#SifreSifirlaButon").attr("disabled", "disabled")

                //let passwordPattern = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[^\w\s]).{8,}$/;

                if (this.SIFRESIFIRLATCKIMLIKNO == "") {
                    bootbox.alert("Lütfen tc no giriniz");
                    return;
                }

                this.TCKONTROL(this.SIFRESIFIRLATCKIMLIKNO);

                if (this.ADSOYAD == "") {
                    bootbox.alert("Lütfen adınızı soyadınızı giriniz");
                    return;
                }

                if (this.DOGUMTARIHI == "") {
                    bootbox.alert("Lütfen doğum tarihinizi giriniz");
                    return;
                }

                if (this.REFERANCENAME == "") {
                    bootbox.alert("Lütfen referans (Veli/Öğrenci) adını giriniz");
                    return;
                }

                if (this.SIFRE == "") {
                    bootbox.alert("Lütfen şifrenizi giriniz");
                    return;
                }
                if (this.SIFRETEKRAR == "") {
                    bootbox.alert("Lütfen şifre tekrarını giriniz");
                    return;
                }
                if (this.SIFRE != this.SIFRETEKRAR) {
                    bootbox.alert("Girilen Şifreler uyuşmuyor");
                    return;
                }

                //let passPatternControl = passwordPattern.test(this.SIFRE);

                //if (!passPatternControl) {
                //    bootbox.alert("Şifreniz en az 8 karakter,en az 1 sayısal,en az 1 küçük harf,en az 1 büyük harf,en az 1 özel karakter içermelidir!");
                //}

                var p = {
                    TCKIMLIKNO: this.SIFRESIFIRLATCKIMLIKNO,
                    ADSOYAD: this.ADSOYAD,
                    REFERANCE_TCNO: this.REFERANCE_TCNO,
                    BIRTHDAY: this.DOGUMTARIHI,
                    REFERANCENAME: this.REFERANCENAME,
                    SIFRE: this.SIFRE,
                    KULLANICI_TIP: this.KULLANICITIP
                };

                WebPost(this, this.controller, "OgrenciVeliSifreSifirla", p, '', '', function (data, parent) {
                    if (data) {

                        if (data) {
                            let errcode = JSON.parse(data)[0].ERRCODE;
                            let errmessage = JSON.parse(data)[0].ERRMESSAGE;

                            if (errcode === 1) {
                                bootbox.alert(errmessage);
                                return false;
                            }
                            else {
                                bootbox.alert(errmessage);
                                vue.SifremiUnuttumKapat();

                            }
                        }

                    }
                    else {
                        bootbox.alert("İşleminiz yapılamadı. Lütfen girdiğiniz bilgileri kontrol ederek tekrar deneyiniz...");
                        return false;
                    }
                });
            },



            TCKONTROL(tcno) {
                var toplam = Number(tcno.substring(0, 1)) + Number(tcno.substring(1, 2)) +
                    Number(tcno.substring(2, 3)) + Number(tcno.substring(3, 4)) +
                    Number(tcno.substring(4, 5)) + Number(tcno.substring(5, 6)) +
                    Number(tcno.substring(6, 7)) + Number(tcno.substring(7, 8)) +
                    Number(tcno.substring(8, 9)) + Number(tcno.substring(9, 10));
                var strtoplam = String(toplam);
                var onunbirlerbas = strtoplam.substring(strtoplam.length, strtoplam.length - 1);

                if (onunbirlerbas == tcno.substring(10, 11)) {
                    return true;
                } else {
                    return false;
                }
            }

        }
    });
</script>

<!--<script src="Scripts/PublicMethods.js"></script>-->
<!--<script>
    window.onload = function () {
        try {
            return
            var query = window.location.search.substring(1).split('&');
            var tc = query[0].split('=')[1];
            var oturum = query[1].split('=')[1];

            var p = { TCKIMLIKNO: tc, OTURUM: oturum };
            SqlWebAction("POST", "Login", "Login", JSON.stringify(p), '', '', function (data) {
                if (data != null) {
                    data.OTURUM = oturum;
                    $.removeCookie("K");
                    $.cookie("K", JSON.stringify(data), { expires: 1 });
                    window.location.replace("AnaSayfa.html#AnaSayfa");
                }
                else {
                    Alert_Error("Giriş Yetkiniz Yok. Lütfen Yöneticiniz ile İletişime Geçiniz..!");
                }
            })

        } catch (e) {

            Alert_Error("Oturum Hatası! İnteraktif sistemine giriş yaptıktan sonra tekrar deneyiniz.");
        }
    };
</script>-->
