
<div class="page-head">
    <!-- BEGIN PAGE TITLE -->
    <div class="page-title col-md-12">
        <h1>
            Kullanıcı Menü Yetkilendirme <small>Kullanıcı Yetkilendirme</small> <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
    <!-- END PAGE TITLE -->
</div>

<div class="row" id="app">

    <div class="col-md-12">
        <div class="portlet box green-haze dd-item" style="border:none">
            <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Filtreler </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form collapse in" id="filters">
                <div class="form-body form-horizontal">
                    <div class="row">
                        <c-sube controller="KullaniciYetkilendirme"
                                @OnChange="SubeSelected">
                        </c-sube>
                    </div>
                    <div class="row">
                        <c-kademe controller="KullaniciYetkilendirme"
                                  @OnChange="KademeSelected">
                        </c-kademe>
                    </div>
                    <div class="row">
                        <c-kademe3 controller="KullaniciYetkilendirme"
                                   :id_kademe="ID_KADEME"
                                   @OnChange="Kademe3Selected">
                        </c-kademe3>
                    </div>
                    <div class="row">
                        <c-kullanici-tipi controller="KullaniciYetkilendirme"
                                          @OnChange="KullaniciTipiSelected">
                        </c-kullanici-tipi>
                    </div>
                    <div class="row">
                        <c-kullanici controller="KullaniciYetkilendirme"
                                     :id_sube="ID_SUBE"
                                     :id_kademe3="ID_KADEME3"
                                     :idkullanicitipi="ID_KULLANICITIPI"
                                     @OnChange="KullaniciSelected">
                        </c-kullanici>
                    </div>
                    <div class="row">
                        <input style="float:right;margin: 10px;" type="button" class="btn btn-success" v-on:click="Listele" value="Listele">
                    </div>
                </div>
                <div class="form-body form-horizontal">
                    <div class="row">
                        <div class="form-md-line-input">
                            <label class="control-label col-md-3">
                                TCKİMLİKNO
                            </label>
                            <div class="col-md-9"><input type="text" placeholder="TCKİMLİKNO" v-model="TCKIMLIKNO" class="form-control" /></div>
                        </div>
                    </div>
                    <div class="row">
                        <input style="float:right;margin: 10px;" type="button" class="btn btn-success" v-on:click="Listele2" value="Listele">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12" v-if="LISTE.length>0">
        <div class="portlet light">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-list font-green"></i>
                    <span class="caption-subject bold font-green uppercase"> Menü Listesi </span>
                    <span class="caption-helper"></span>
                </div>
            </div>
            <div class="portlet-body form">
                <form role="form">
                    <div class="portlet light bordered">
                        <div class="portlet-body">
                            <table id="ogrencisonuc" class="table table-striped table-bordered table-checkable">
                                <thead>
                                    <tr>
                                        <th>MENÜ ADI</th>
                                        <th style="width:50px;">YETKİ</th>
                                    </tr>
                                </thead>
                                <tr v-for="u in LISTE" @click="Check(u)" style="cursor:pointer;">
                                    <td style="font-weight:600; text-align:left">{{u.AD}}</td>
                                    <td style="font-weight:600;">
                                        <div class="md-checkbox" style="margin:auto!important; width:20px!important; display:block;">
                                            <input type="checkbox" v-model="u.YETKILI" :id="u.ID_MENU" class="md-check" v-bind:true-value="true" v-bind:false-value="false" />
                                            <label :for="u.ID_MENU">
                                                <span></span>
                                                <span class="check"></span>
                                                <span class="box"></span>
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                            </table>

                            <div class="row">
                                <div class="col-md-12 text-right" style="margin-left:0px;margin-right:0px;">
                                    <button type="button" class="btn green" @click="Kaydet">KAYDET</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="VueComponents/SubeGrupSinif.js?v=3"></script>
<script src="VueComponents/YetkilendirmeFiltreleri.js?v=3"></script>

<script>
    var vue = new Vue({
        el: "#app",
        name: "KullaniciYetkilendirme.html",

        data: {
            ID_KADEME: 0,
            ID_KULLANICITIPI: 0,
            ID_SUBE: 0,
            ID_KADEME3: 0,
            LISTE: [],
            TCKIMLIKNO: ''
        },

        mounted() {
            this.LISTE = [];
        },

        methods: {
            KullaniciTipiSelected(ID_KULLANICITIPI) {
                this.ID_KULLANICITIPI = ID_KULLANICITIPI;
                ListeTemizle(this.LISTE);
            },

            SubeSelected(ID_SUBE) {
                this.ID_SUBE = ID_SUBE;
                ListeTemizle(this.LISTE);
            },

            KademeSelected(ID_KADEME) {
                this.ID_KADEME = ID_KADEME;
                ListeTemizle(this.LISTE);
            },

            Kademe3Selected(ID_KADEME3) {
                this.ID_KADEME3 = ID_KADEME3;
                ListeTemizle(this.LISTE);
            },

            KullaniciSelected(TCKIMLIKNO) {
                this.TCKIMLIKNO = TCKIMLIKNO;
                this.Listele();
            },

            Listele() {
                var _tckimlikno = this.TCKIMLIKNO;
                ListeTemizle(this.LISTE);
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    TC_YETKI: _tckimlikno
                };

                WebPost(this, "KullaniciYetkilendirme", "MenuListele", p, '#ogrencisonuc', 'Yükleniyor..', function (data, parent) {
                    if (data != null) {
                        $('#filters').collapse('hide');
                        parent.LISTE = data;
                    }
                    else {
                        Alert_Warning("Seçilen kriterlere göre öğrenci bulunamadı!");
                    }
                })
            },

            Listele2() {
                var _tckimlikno = this.TCKIMLIKNO;
                ListeTemizle(this.LISTE);
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    TC_YETKI: _tckimlikno
                };

                WebPost(this, "KullaniciYetkilendirme", "MenuListele", p, '#ogrencisonuc', 'Yükleniyor..', function (data, parent) {
                    if (data != null) {
                        $('#filters').collapse('hide');
                        parent.LISTE = data;
                    }
                    else {
                        Alert_Warning("Seçilen kriterlere göre öğrenci bulunamadı!");
                    }
                })
            },
            Kaydet() {
                var _this = this;

                var _tckimlikno = this.TCKIMLIKNO;
                if (_tckimlikno == 0) {
                    Alert_Warning("Kullanıcı seçimi yaptığınızdan emin olunuz!");
                    return;
                }

                var list = $.grep(this.LISTE, function (n, i) {
                    return n.YETKILI == true;
                });

                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    TC_YETKI: _tckimlikno,
                    SQLJSON: JSON.stringify(list)
                };


                WebPost(this, "KullaniciYetkilendirme", "KullaniciMenuKaydet", p, '#ogrencisonuc', 'Yükleniyor..', function (data, parent) {
                    if (data === true) {
                        Alert_Info("Menü Yetkilendirme Tamamlanmıştır...");
                        _this.Listele();
                    }
                    else {
                        Alert_Warning("Menü Yetkilendirme Yapılamadı..!");
                    }
                })

            },
            Check(u) {
                u.YETKILI = !u.YETKILI;
            }
        }
    });
</script>
<script src="Scripts/PublicMethods.js"></script>
