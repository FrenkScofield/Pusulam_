
<div class="page-head">
    <!-- BEGIN PAGE TITLE -->
    <div class="page-title col-md-12">
        <h1>
            Menü Listesi <small>Birim Yetkilendirme</small> <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
    <!-- END PAGE TITLE -->
</div>

<div class="row" id="app">

    <div class="col-md-12">
        <div class="portlet box green-haze dd-item" style="border:none">
            <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Filtreler </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form collapse in" id="filters">
                <div class="form-body form-horizontal">
                    <div class="row">
                        <c-kademe controller="BirimYetkilendirme"
                                  @OnChange="KademeSelected">
                        </c-kademe>
                    </div>
                    <div class="row">
                        <c-kullanici-tipi controller="BirimYetkilendirme"
                                          @OnChange="KullaniciTipiSelected">
                        </c-kullanici-tipi>
                    </div>
                    <div class="row">
                        <input style="float:right;margin: 10px;" type="button" class="btn btn-success" v-on:click="Listele" value="Listele">  
                    </div> 
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12" v-show="LISTE.length>0">
        <div class="portlet light">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-list font-green"></i>
                    <span class="caption-subject bold font-green uppercase"> Menü Listesi </span>
                    <span class="caption-helper"></span>
                </div>
            </div>
            <div class="portlet-body form">
                <form role="form">
                    <div class="portlet light bordered">
                        <div class="portlet-body">
                            <table id="ogrencisonuc" class="table table-striped table-bordered table-checkable">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>Menüler</th>
                                    </tr>
                                </thead>
                                <tr v-for="u in LISTE">
                                    <td style="font-weight:600;">
                                        <input type="checkbox" :value=u.ID_MENU :id="u.KOD" v-model='selectedMenu' />
                                    </td>
                                    <td style="font-weight:600;">{{u.AD}}</td>
                                </tr>
                            </table>
                            <div class="row">
                                <div class="col-md-12 text-right" style="margin-left:0px;margin-right:0px;">
                                    <button type="button" class="btn green" @click="Kaydet">KAYDET</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="../../VueComponents/YetkilendirmeFiltreleri.js?v=3"></script>
<!--<script src="VueComponents/YetkilendirmeFiltreleri.js"></script>-->
<!--<script src="VueComponents/SoruFiltreleri.js"></script>
<script src="VueComponents/SubeGrupSinif.js"></script>-->

<script>
    var vue = new Vue({
        el: "#app",
        name: "BirimYetkilendirme.html",

        data: {
            ID_KADEME: 0,
            ID_KULLANICITIPI: 0,
            selectedMenu: [],
            LISTE: []
        },

        mounted() {
        },

        methods: {
            KademeSelected(ID_KADEME) {
                this.ID_KADEME = ID_KADEME;
                this.Listele();
            },

            KullaniciTipiSelected(ID_KULLANICITIPI) {
                this.ID_KULLANICITIPI = ID_KULLANICITIPI;
                this.Listele();
            },

            Listele() {
                var _idKademe = this.ID_KADEME;
                var _idKullaniciTipi = this.ID_KULLANICITIPI;

                this.LISTE = [];
                this.selectedMenu = [];


                if (_idKademe == 0 || _idKullaniciTipi == 0) { return; }

                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    ID_KADEME: _idKademe,
                    ID_KULLANICITIPI: _idKullaniciTipi
                };

                WebPost(this, "BirimYetkilendirme", "MenuListele", p, '#ogrencisonuc', 'Yükleniyor..', function (data, parent) {
                    if (data != null) {
                        $('#filters').collapse('hide');
                        parent.LISTE = data;
                        $.each(data, function (i) {
                            if (this.YETKILI) {
                                parent.selectedMenu.push(this.ID_MENU)
                            }
                        });
                    }
                    else {
                        Alert_Warning("Seçilen kriterlere göre öğrenci bulunamadı!");
                    }
                })
            },
            Kaydet() {
                var _this = this;

                var _idKademe = this.ID_KADEME;
                var _idKullaniciTipi = this.ID_KULLANICITIPI;

                if (_idKademe == 0 || _idKullaniciTipi == 0) { return; }


                var _idMenu = '';
                $.each(this.selectedMenu, function (i) {
                    _idMenu += this + ',';
                });

                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    ID_KADEME: _idKademe,
                    ID_KULLANICITIPI: _idKullaniciTipi,
                    ID_MENUS: _idMenu
                };

                WebPost(this, "BirimYetkilendirme", "BirimMenuKaydet", p, '#ogrencisonuc', 'Yükleniyor..', function (data, parent) {
                    if (data === true) {
                        Alert_Info("Menü Yetkilendirme Tamamlanmıştır...");
                        _this.Listele();
                    }
                    else {
                        Alert_Warning("Menü Yetkilendirme Yapılamadı..!");
                    }
                })

            }
        }
    });
</script>
<script src="Scripts/PublicMethods.js"></script>
