<link href="assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css" rel="stylesheet" type="text/css" />

<div class="page-head">
    <!-- BEGIN PAGE TITLE -->
    <div class="page-title col-md-12">
        <h1>
            Soru Listesi <small>Liste</small> <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
    <!-- END PAGE TITLE -->
</div>

<div class="row" id="app">
    <div class="col-md-12">
        <div class="portlet box green-haze dd-item" style="border:none">
            <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Filtreler </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form collapse in" id="filters">
                <div class="form-body form-horizontal">
                    <div class="row">
                        <c-donem :controller="controller"
                                 @OnChange="DonemSelected">
                        </c-donem>
                    </div>
                    <div class="row">
                        <c-upgrade-grup :controller="controller" @OnChange="GrupSelected">
                        </c-upgrade-grup>
                    </div>
                    <div class="row">
                        <c-kategori :controller="controller"
                                    @OnChange="KategoriSelected">
                        </c-kategori>
                    </div>
                    <div class="row">
                        <div class="col-md-12 text-right">
                            <button type="button" class="btn green" @click="SoruListele">Listele</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-12" v-show="SORU_LISTESI.length>0">
        <div class="portlet light">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-list font-green"></i>
                    <span class="caption-subject bold font-green uppercase"> Liste </span>
                    <span class="caption-helper"></span>
                </div>
            </div>
            <!-- BEGIN PORTLET-->
            <div class="portlet-body form">
                <form role="form">
                    <div class="portlet light bordered">
                        <div class="portlet-body">
                            <table class="table table-striped table-bordered table-hover" id="sample_1">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>PUAN ARALIĞI</th>
                                        <th>KAZANIM ADEDİ</th>
                                        <th>ÖĞRENCİ SAYISI</th>
                                        <th>ÇÖZÜLME ORANI</th>
                                        <th>İndir</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="odd gradeX" v-for="u in SORU_LISTESI">
                                        <td>
                                            <div class="tooltipx" data-toggle="tooltip" data-html="true" data-placement="bottom" :title="'<img src=\''+ 'https://pusulam.okyanuskoleji.k12.tr/Dosyalar/' + u.DOSYA +'\' width=\'180\' />'">
                                                {{u.ID_TKTSORU}}
                                            </div>
                                        </td>
                                        <td>{{u.PUANARALIGI}}</td>
                                        <td>{{u.KAZANIMADEDI}}</td>
                                        <td>{{u.OGRENCISAYISI}}</td>
                                        <td>{{u.COZULMEORANI.toFixed(2)}}</td>
                                        <td><a :href="'https://pusulam.okyanuskoleji.k12.tr/Dosyalar/' + u.DOSYA" target="_blank" :download="'TktSoru_' + u.ID_TKTSORU">İndir</a></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
            <!-- END PORTLET-->
        </div>
    </div>
</div>

<div id="long" class="modal fade" tabindex="-1" data-replace="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-body" align="center" valign="middle">
                <div class="row" style="margin-top:0px!important;">
                    <div class="col-md-12">
                        <img id="imgLong" class="form-control" style="max-height: calc(100vh - 150px); height:auto; width:100%;" text-align:" alt="" src="">
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding-top:0px;">
                <button type="button" data-dismiss="modal" class="btn dark btn-outline">Kapat</button>
            </div>
        </div>
    </div>
</div>
<script src="VueComponents/SoruFiltreleri.js?v=3"></script>
<script>


    var tblSorular = null;

    var vue = new Vue({

        el: "#app",
        name: "SoruListesi.html",

        data: {
            controller: 'SorularinCozulmeOranlari',
            ID_TKTKATEGORI: 0,
            ID_SATISTURU: 0,
            DONEM: '',
            SORU_LISTESI: []
        },

        mounted() {
        },

        methods: {
            DonemSelected(DONEM) {
                this.DONEM = DONEM;
            },

            KategoriSelected(ID_TKTKATEGORI) {
                this.ID_TKTKATEGORI = ID_TKTKATEGORI;
            },

            GrupSelected(ID_SATISTURU) {
                this.ID_SATISTURU = ID_SATISTURU;
            },

            SoruListele() {
                this.SORU_LISTESI = [];
                if (tblSorular != null) {
                    tblSorular.rows().remove().draw();
                    tblSorular.destroy();
                }

                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    DONEM: this.DONEM,
                    ID_TKTKATEGORI: this.ID_TKTKATEGORI,
                    ID_SATISTURU: this.ID_SATISTURU
                };

                WebPost(this, this.controller, "SoruCozulmeOraniListele", p, '#app', '', function (data, parent) {
                    if (data != null) {
                        $('#filters').collapse('hide');

                        parent.SORU_LISTESI = JSON.parse(data);
                        //DOM update olmasını bekleyip update olunca listeyi oluşturuyor.

                        $("#sample_1").DataTable().destroy();
                        Vue.nextTick(function () {
                            parent.ListeOlustur();
                            vue.$nextTick(function () {
                                $('.tooltipx').tooltip();
                            });
                        })
                    }
                    else {
                        Alert_Warning("Liste Bulunamadı!");
                    }
                })
            },

            ResimGoster(TktObject) {
                $("#imgLong").attr("src", "https://pusulam.okyanuskoleji.k12.tr/Dosyalar/" + TktObject.DOSYA);
            },

            ListeOlustur() {
                tblSorular = $('#sample_1').DataTable(
                    {
                        "columnDefs": [{ "width": "25%", "targets": 0 }],
                        language: {
                            "url": "./Utility/dil.json"
                        }
                    });
            },
        }
    });

</script>

<script src="assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js" type="text/javascript"></script>
<script src="Scripts/PublicMethods.js"></script>