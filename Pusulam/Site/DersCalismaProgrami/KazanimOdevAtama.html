

<link href="assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css" rel="stylesheet" type="text/css" />
<style>
    td {
        vertical-align: middle !important;
    }

    tr td:first-child {
        text-align: left !important;
    }

    tbody tr {
        height: 51px;
    }

    .row {
        margin-top: 10px !important;
    }

    .modal-dialog {
        width: 500px;
    }

    table.dataTable {
        margin: 0px !important;
    }
</style>


<div class="page-head">
    <!-- BEGIN PAGE TITLE -->
    <div class="page-title col-md-12">
        <h1>
            Sınav <small>Kazanım Ödev Ekle</small> <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
    <!-- END PAGE TITLE -->
</div>

<div class="row" id="app">

    <div class="col-md-12">
        <div class="portlet light">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-plus font-green"></i>
                    <span class="caption-subject bold font-green uppercase">Kazanım Ödev Ekle</span>
                    <span class="caption-helper"></span>
                   
                </div>
            </div>
            <!-- BEGIN PORTLET-->
            <div class="portlet-body form">
                <form role="form">
                    <div class="portlet-body" style="padding:0px;">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="row">
                                    <c-sinavgrup controller="DersUnite"
                                                 :id_kademe3="ID_KADEME3"
                                                 @OnChange="KademeDersSelected">
                                    </c-sinavgrup>
                                </div>
                                <div class="row">
                                    <c_ders controller="DersUnite"
                                            :id_kademe3="ID_KADEME3"
                                            @OnChange="DersSelected">
                                    </c_ders>
                                </div>

                               
                            </div>
                            <div class="col-md-8">
                                <div class="portlet light">
                                    <div class="portlet-title">
                                        <div class="caption">
                                            <i class="icon-list font-green"></i>
                                            <span class="caption-subject bold font-green uppercase">Üniteler</span>
                                            <span class="caption-helper"></span>
                                        </div>
                                       
                                    </div>
                                    <!-- BEGIN PORTLET-->
                                    <div class="portlet-body form">
                                        <div class="portlet light bordered">
                                            <div class="portlet-body" style="padding:0px;">
                                                <table class="table table-striped table-bordered table-checkable" id='tblunite'>
                                                    <thead>
                                                        <tr>
                                                            <th>Kod</th>
                                                            <th>Ad</th>
                                                            <th style="width:100px!important;">Ödevler</th>
                                                            <th style="width:100px!important;">İşlemler</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="odd gradeX" v-for="u in JSONUNITE">
                                                            <td>{{u.KOD}}</td>
                                                            <td v-html="u.AD" :style='"padding-left: "+(u.KOD.length*5)+"px;"'></td>
                                                            <td style="width:120px!important;">
                                                                <div class="row" v-for="(u,j) in u.LINKLIST">
                                                                    <div class="form-md-line-input" v-if="u.ODEV!=''">
                                                                        <label class="control-label col-md-3" style="vertical-align:middle; margin-top: 7px;"></label>
                                                                        <div class="col-md-9">
                                                                            <div class="col-md-10" style="padding: 0px;">
                                                                                <!--<input type="text" v-model="u.ODEV" v-if="u.ODEV!=''" disabled class="form-control" />-->
                                                                                <label v-if="u.ODEV!=''">{{u.ODEV}}</label>
                                                                            </div>
                                                                          
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                            <td style="width:120px!important;">

                                                                <!--<button type="button" class="btn btn-xs red pull-right" @click="UniteSil(u.ID_DERSUNITE)">Sil</button>-->
                                                                <button type="button" class="btn btn-xs green" @click="OdevEkleDuzelt(u)">Ödev Ekle/Düzenle</button>






                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- END PORTLET-->
                                </div>
                            </div>
                        </div>
                    </div>

                </form>
            </div>
            <!-- END PORTLET-->
        </div>
    </div>


    <!-- Ünite Güncelle modal-->
    <div id="unitedty" class="modal fade" tabindex="-1" data-replace="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title">Ünite Detay</h4>
                </div>
                <div class="modal-body" align="center" valign="middle">
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="row">
                                    <div class="form-md-line-input">
                                        <label class="control-label col-md-3" style="vertical-align:middle;">Kod</label>
                                        <div class="col-md-9">
                                            <input type="text" v-if="UNITE!=null" v-model="UNITE.KOD" disabled class="form-control" />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-md-line-input">
                                        <label class="control-label col-md-3" style="vertical-align:middle;">Ad</label>
                                        <div class="col-md-9">
                                            <input type="text" v-if="UNITE!=null" v-model="UNITE.AD" disabled class="form-control" />
                                        </div>
                                    </div>
                                </div>


                                <div class="row" v-for="(u,j) in UNITE.LINKLIST">
                                    <div class="form-md-line-input">
                                        <label class="control-label col-md-3" style="vertical-align:middle; margin-top: 7px;">Ödev {{j + 1}}</label>
                                        <div class="col-md-9">
                                            <div class="col-md-10" style="padding: 0px;">
                                                <input type="text" v-model="u.ODEV" class="form-control" />
                                            </div>
                                            <button type="button" class="btn btn-xs red pull-right" style="margin-top: 5px;" @click="LinkSil(j)"><i class="fa fa-close"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <a href="javascript:;" @click="UNITE.LINKLIST.push({ LINK: '' })" style="float: right;margin-top: 30px;background-color: cornflowerblue;" data-repeater-create class="btn btn-success mt-repeater-add">
                                    <i class="fa fa-plus"></i> Ödev Ekle
                                </a>


                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer margin-right-10">
                    <button type="button" data-dismiss="modal" class="btn dark btn-outline margin-right-10 margin-top-10">Kapat</button>
                    <button type="button" class="btn btn-success btn-outline margin-right-10 margin-top-10" @click="UniteGuncelle()">Kaydet</button>
                </div>
            </div>
        </div>
    </div>

  
</div>

<script src="VueComponents/SinavFiltreleri.js"></script>
<script src="../../../VueComponents/Genel.js?v=6"></script>
<script>
    var tblUnite = null;
    var vue = new Vue({
        el: "#app",
        name: "KazanimOdevAtama.html",
        data: {
            ID_KADEME3: 0,
            ID_DERS: 0,
            ID_DERSUNITE: 0,
            JSONUNITE: [],
            dosyaYukleUnite: '',
            UNITE: { ID_DERSUNITE: 0, AD: '', ID_DERS: 0, KOD: '', LINKLIST: [{ LINK: '' }] }

        },
        mounted() {
            this.ListeOlustur();
        },
        updated() {
            $("#ddluniteID").hide();
        },
        methods: {
            KademeDersSelected(ID_KADEME3) {
                this.ID_KADEME3 = ID_KADEME3;
                this.UniteGetir();
            },
            DersSelected(ID_DERS) {
                this.ID_DERS = ID_DERS;
                this.UNITE.ID_DERS = ID_DERS;
                this.UniteGetir();
                
            },
            UniteGetir() {
                this.JSONUNITE = [];
                if (tblUnite != null) {
                    tblUnite.rows().remove().draw();
                    tblUnite.destroy();
                }
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    ID_DERS: this.ID_DERS,
                    ID_KADEME3: this.ID_KADEME3
                };
                WebPost(this, "KazanimOdevAtama", "DersUniteGetir", p, '', '', function (data, parent) {
                    if (data != null) {
                        parent.JSONUNITE = JSON.parse(data);
                        console.log(parent.JSONUNITE);
                        //DOM update olmasını bekleyip update olunca listeyi oluşturuyor.
                        Vue.nextTick(function () {
                            parent.ListeOlustur();
                        })
                    }
                    else {
                        Alert_Warning("Liste Bulunamadı!");
                    }
                })
            },
            ListeOlustur() {
                tblUnite = $('#tblunite').DataTable(
                    {
                        "columnDefs": [{ "width": "25%", "targets": 0 }],
                        language: {
                            "url": "./Utility/dil.json"
                        }
                    });
            },

           
            OdevEkleDuzelt(UNITE) {               
                this.UNITE = JSON.parse(JSON.stringify(UNITE));               
                $("#unitedty").modal();
                
            },
            UniteGuncelle() {
                if (this.UNITE.KOD.length % 3 == 0) {
                    var p = {
                        TCKIMLIKNO: session.TCKIMLIKNO,
                        OTURUM: session.OTURUM,
                        ID_DERS: this.ID_DERS,
                        ID_KADEME3: this.ID_KADEME3,
                        KOD: this.UNITE.KOD,
                        AD: this.UNITE.AD,
                        ID_DERSUNITE: this.UNITE.ID_DERSUNITE,
                        LINKLIST: JSON.stringify(this.UNITE.LINKLIST),
                    };

                    if (p.AD != "" && p.KOD != "") {
                        console.log(p);
                        WebPost(this, "KazanimOdevAtama", "OdevEkleGuncelle", p, '', '', function (data, parent) {
                            if (data == true) {
                                Alert_Info("Ödev Ekleme İşlemi Başarılı");
                                $("#unitedty").modal("hide");
                                Vue.nextTick(function () {
                                    parent.UniteGetir();
                                })
                            }
                            else {
                                Alert_Warning("Ödev Ekleme işlemi Başarısız");
                            }
                        })
                    }
                    else {
                        Alert_Warning("Alanları boş geçmeyin!");
                    }
                } else {
                    Alert_Warning("Kodlar üç veya üçün katı karakterden oluşmalıdır!");
                }
            },
            bosluk(length, ad) {
                var str = '';
                for (var i = 0; i < (length - 6) * 2; i++) {
                    str += '&nbsp';
                }
                return str + ad;
            },

          

            LinkSil(j) {
                this.UNITE.LINKLIST.splice(j, 1);
            },


        }
    });
</script>
<script src="Scripts/PublicMethods.js"></script>
<script src="assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js" type="text/javascript"></script>

<script src="../assets/global/plugins/jquery-repeater/jquery.repeater.js" type="text/javascript"></script>

<script src="../assets/pages/scripts/form-repeater.min.js" type="text/javascript"></script>



