<link href="assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css" rel="stylesheet" type="text/css" />
<style>
    td {
        vertical-align: middle !important;
    }

    .row {
        margin-top: 10px !important;
    }

    #OdevAciklama p {
        margin: 0px !important;
    }
</style>
<div class="page-head">
    <!-- BEGIN PAGE TITLE -->
    <div class="page-title col-md-12">
        <h1>
            Ödev Kontrol <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
    <!-- END PAGE TITLE -->
</div>

<div class="row" id="app">
    <div class="col-md-12">
        <ul class="nav nav-tabs" style="margin-bottom:0px;" v-if="!KONTROL">
            <li class="active">
                <a href="#tab_1_1" data-toggle="tab">Ödev Kontrolü</a>
            </li>
            <li>
                <a href="#tab_1_2" data-toggle="tab" v-if="DANISMAN">Ödev Danışman Kontrolü</a>
            </li>
            <li style="display: none;">
                <a href="#tab_1_3" data-toggle="tab"></a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade active in" id="tab_1_1">
                <div class="portlet box blue-hoki dd-item" style="border:none">
                    <!-- BEGIN PORTLET-->
                    <div class="portlet-body form">
                        <form role="form" style="padding:12px 20px">
                            <div class="row">
                                <c-sube :controller="controller"
                                        @OnChange="SubeSelected">
                                </c-sube>
                            </div>

                            <div class="row">
                                <c-kademe3 :controller="controller"
                                           :idsube="ID_SUBE"
                                           @OnChange="Kademe3Selected">
                                </c-kademe3>
                            </div>

                            <div class="row">
                                <c-sinif :controller="controller"
                                         :idsube="ID_SUBE"
                                         :idkademe3="ID_KADEME3"
                                         @OnChange="SinifSelected">
                                </c-sinif>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="portlet light" v-if="LISTE.length>0">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="icon-list font-green"></i>
                            <span class="caption-subject bold font-green uppercase"> Ödev Listesi </span>
                            <span class="caption-helper"></span>
                        </div>
                    </div>
                    <!-- BEGIN PORTLET-->
                    <div class="portlet-body form">
                        <form role="form">
                            <div class="portlet light bordered">
                                <div class="portlet-body">
                                    <table class="table table-striped table-bordered table-hover table-checkable">
                                        <thead>
                                            <tr>
                                                <th>Ders</th>
                                                <th>Başlık</th>
                                                <th>Veriliş T.</th>
                                                <th>Teslim T.</th>
                                                <th>İşlem</th>
                                                <th>Durum</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="odd gradeX" v-for="(u, index) in LISTE">
                                                <td>
                                                    {{u.DERSAD}}
                                                </td>
                                                <td>
                                                    {{u.BASLIK}}
                                                </td>
                                                <td>
                                                    {{u.VERILIS_TARIHI}}
                                                </td>
                                                <td>
                                                    {{u.TESLIM_TARIHI}}
                                                </td>
                                                <td>
                                                    <button type="button" class="btn green" @click="DetayGor(u.ID_ODEV, 1)">DETAY</button>
                                                    <button type="button" class="btn yellow" @click="DetayGor(u.ID_ODEV, 2)">DEĞİŞTİR</button>
                                                    <button type="button" class="btn btn-danger" @click="Sil(u.ID_ODEV)">SİL</button>
                                                </td>
                                                <td>
                                                    <button type="button" :class="'btn btn-' + (u.DURUM == 1?'success':u.DURUM == 2?'info':'danger')" @click="OgrenciListele(u.ID_ODEV, ID_SINIF, u)" :disabled="u.DURUM == 0">{{u.DURUM == 1?'KONTROL EDİLDİ':u.DURUM == 2?'KONTROL ET':'KONTROL EDİLMEDİ' }}</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- END PORTLET-->
                </div>
            </div>

            <div class="tab-pane fade" id="tab_1_2" v-if="DANISMAN">
                <div class="portlet box blue-hoki dd-item" style="border:none">
                    <!-- BEGIN PORTLET-->
                    <div class="portlet-body form">
                        <form role="form" style="padding:12px 20px">
                            <div class="row">
                                <c-sube :controller="controller"
                                        @OnChange="DanismanSubeSelected">
                                </c-sube>
                            </div>

                            <div class="row">
                                <c-kademe3 :controller="controller"
                                           :idsube="D_ID_SUBE"
                                           danisman="true"
                                           @OnChange="DanismanKademe3Selected">
                                </c-kademe3>
                            </div>

                            <div class="row">
                                <c-sinif :controller="controller"
                                         :idsube="D_ID_SUBE"
                                         :idkademe3="D_ID_KADEME3"
                                         danisman="true"
                                         @OnChange="DanismanSinifSelected">
                                </c-sinif>
                            </div>

                            <div class="row">
                                <c-sinif-odev-veren :controller="controller"
                                                    :idsinif="D_ID_SINIF"
                                                    @OnChange="OdevVerenSelected">
                                </c-sinif-odev-veren>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="portlet light" v-if="ODEVVERENODEVLISTE.length>0">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="icon-list font-green"></i>
                            <span class="caption-subject bold font-green uppercase"> Ödev Listesi </span>
                            <span class="caption-helper"></span>
                        </div>
                    </div>
                    <!-- BEGIN PORTLET-->
                    <div class="portlet-body form">
                        <form role="form">
                            <div class="portlet light bordered">
                                <div class="portlet-body">
                                    <table class="table table-striped table-bordered table-hover table-checkable">
                                        <thead>
                                            <tr>
                                                <th>Ders</th>
                                                <th>Başlık</th>
                                                <th>Veriliş T.</th>
                                                <th>Teslim T.</th>
                                                <th>İşlem</th>
                                                <th>Durum</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="odd gradeX" v-for="(u, index) in ODEVVERENODEVLISTE">
                                                <td>
                                                    {{u.DERSAD}}
                                                </td>
                                                <td>
                                                    {{u.BASLIK}}
                                                </td>
                                                <td>
                                                    {{u.VERILIS_TARIHI}}
                                                </td>
                                                <td>
                                                    {{u.TESLIM_TARIHI}}
                                                </td>
                                                <td>
                                                    <button type="button" class="btn green" @click="DetayGor(u.ID_ODEV, 1)">DETAY</button>
                                                </td>
                                                <td>
                                                    <button type="button" :class="'btn btn-' + (u.DURUM == 1?'success':u.DURUM == 2?'info':'danger')" disabled>{{u.DURUM == 1?'KONTROL EDİLDİ':u.DURUM == 2?'KONTROLE AÇIK':'KONTROL EDİLMEDİ' }}</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- END PORTLET-->
                </div>
            </div>

            <div class="tab-pane fade" id="tab_1_3">
                <div class="portlet light" v-if="LISTE.length>0">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="icon-list font-green"></i>
                            <span class="caption-subject bold font-green uppercase"> Ödev Kontrol Listesi </span>
                            <span class="caption-helper"></span>
                        </div>
                    </div>

                    <div class="portlet-body form">
                        <form role="form">
                            <div class="portlet light bordered">
                                <div class="portlet-body">
                                    <div class="row">
                                        <div class="col-md-12 text-right">
                                            <button type="button" class="btn yellow" @click="Geri">Geri</button>
                                            <button type="button" class="btn green" @click="KontrolKaydet">Kaydet</button>
                                        </div>
                                    </div>
                                    <div style="overflow-x:auto; margin-top:10px;">
                                        <table class="table table-striped table-bordered table-hover table-checkable" style="width:100%;">
                                            <thead>
                                                <tr>
                                                    <th style="text-align:right;">Ad Soyad</th>
                                                    <th style="width: 30px; text-align:center;" title="Tam Yaptı">
                                                        <a href="javascript:;" @click="TumuSec(1)"> T </a>
                                                    </th>
                                                    <th style="width: 30px; text-align:center;" title="Eksik Yaptı">
                                                        <a href="javascript:;" @click="TumuSec(2)"> E </a>
                                                    </th>
                                                    <th style="width: 30px; text-align:center;" title="Yapmadı">
                                                        <a href="javascript:;" @click="TumuSec(3)"> Y </a>
                                                    </th>
                                                    <th style="width: 30px; text-align:center;" title="Geç Yaptı">
                                                        <a href="javascript:;" @click="TumuSec(4)"> G </a>
                                                    </th>
                                                    <th style="width: 30px; text-align:center;" title="Diğer">
                                                        <a href="javascript:;" @click="TumuSec(5)"> D </a>
                                                    </th>
                                                    <th style="width: 100px; text-align:center;">Dosya Listesi</th>
                                                    <th>Açıklama</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="odd gradeX" v-for="(u, index) in ODEVKONTROLLISTE">
                                                    <td style="text-align:right;">
                                                        {{u.ADSOYAD}}
                                                    </td>
                                                    <td title="Tam Yaptı">
                                                        <div class="md-radio">
                                                            <input type="radio" :id="'1-' + u.ID_ODEVSINIFOGRENCI" :name="u.ID_ODEVSINIFOGRENCI" class="md-radiobtn" value="1" v-model="u.ID_ODEVDURUM">
                                                            <label :for="'1-' + u.ID_ODEVSINIFOGRENCI">
                                                                <span class="inc"></span>
                                                                <span class="check"></span>
                                                                <span class="box"></span>
                                                            </label>
                                                        </div>
                                                    </td>
                                                    <td title="Eksik Yaptı">
                                                        <div class="md-radio">
                                                            <input type="radio" :id="'2-' + u.ID_ODEVSINIFOGRENCI" :name="u.ID_ODEVSINIFOGRENCI" class="md-radiobtn" value="2" v-model="u.ID_ODEVDURUM">
                                                            <label :for="'2-' + u.ID_ODEVSINIFOGRENCI">
                                                                <span class="inc"></span>
                                                                <span class="check"></span>
                                                                <span class="box"></span>
                                                            </label>
                                                        </div>
                                                    </td>
                                                    <td title="Yapmadı">
                                                        <div class="md-radio">
                                                            <input type="radio" :id="'3-' + u.ID_ODEVSINIFOGRENCI" :name="u.ID_ODEVSINIFOGRENCI" class="md-radiobtn" value="3" v-model="u.ID_ODEVDURUM">
                                                            <label :for="'3-' + u.ID_ODEVSINIFOGRENCI">
                                                                <span class="inc"></span>
                                                                <span class="check"></span>
                                                                <span class="box"></span>
                                                            </label>
                                                        </div>
                                                    </td>
                                                    <td title="Geç Yaptı">
                                                        <div class="md-radio">
                                                            <input type="radio" :id="'4-' + u.ID_ODEVSINIFOGRENCI" :name="u.ID_ODEVSINIFOGRENCI" class="md-radiobtn" value="4" v-model="u.ID_ODEVDURUM">
                                                            <label :for="'4-' + u.ID_ODEVSINIFOGRENCI">
                                                                <span class="inc"></span>
                                                                <span class="check"></span>
                                                                <span class="box"></span>
                                                            </label>
                                                        </div>
                                                    </td>
                                                    <td title="Diğer">
                                                        <div class="md-radio">
                                                            <input type="radio" :id="'5-' + u.ID_ODEVSINIFOGRENCI" :name="u.ID_ODEVSINIFOGRENCI" class="md-radiobtn" value="5" v-model="u.ID_ODEVDURUM">
                                                            <label :for="'5-' + u.ID_ODEVSINIFOGRENCI">
                                                                <span class="inc"></span>
                                                                <span class="check"></span>
                                                                <span class="box"></span>
                                                            </label>
                                                        </div>
                                                    </td>
                                                    <td>

                                                        <button type="button" class="btn blue" @click="DosyaListele(u)" :disabled="u.OGRENCIDOSYALIST.length==0">Dosya Listele</button>

                                                    </td>
                                                    <td>
                                                        <input type="text" v-model="u.ACIKLAMA" class="form-control" placeholder="Açıklama" />
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12 text-right">
                                            <button type="button" class="btn yellow" @click="Geri">Geri</button>
                                            <button type="button" class="btn green" @click="KontrolKaydet">Kaydet</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div id="MODAL_DOSYA" class="modal fade in" tabindex="-1" data-replace="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body" style="padding-bottom:0px;" id="modal-body">
                    
                    <div class="row">
                        <div class="col-md-12"><h4><strong v-html="TEMPODEV.DERSAD"></strong></h4> <span v-html="TEMPODEV.BASLIK"></span></div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12"><h4><strong>Öğrenci</strong></h4></div>
                        <div class="col-md-12" v-html="ODEVDETAY.ADSOYAD" id="OdevAciklama"> </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12"><h4><strong>Açıklama</strong></h4></div>
                        <div class="col-md-12" v-html="ODEVDETAY.ACIKLAMA" id="OdevAciklama"> </div>
                    </div>

                    <div class="row" v-if="ODEVDETAY.OGRENCIDOSYALIST != undefined && ODEVDETAY.OGRENCIDOSYALIST.length > 0">
                        <div class="col-md-12"><h4><strong>Dosyalar</strong></h4></div>
                        <div class="col-md-12" v-for="(ITEM, index) in ODEVDETAY.OGRENCIDOSYALIST" style="cursor:pointer">
                            <a :href="'https://okyanusdata.s3-eu-west-1.amazonaws.com/pusulam/odev/ogrenci/' + ITEM.GUID" target="_blank">{{index + 1}}. Dosya</a>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn default" data-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>

    <div id="MODAL_DETAY" class="modal fade in" tabindex="-1" data-replace="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body" style="padding-bottom:0px;" id="modal-body">
                    <div class="row">
                        <div class="col-md-12"><h4><strong>Açıklama</strong></h4></div>
                        <div class="col-md-12" v-html="ODEVDETAY.ACIKLAMA" id="OdevAciklama">
                        </div>
                    </div>
                    <div class="row" v-if="ODEVDETAY.LINKLIST!=undefined && ODEVDETAY.LINKLIST.length>0">
                        <div class="col-md-12"><h4><strong>Linkler</strong></h4></div>
                        <div class="col-md-12" v-for="(ITEM, index) in ODEVDETAY.LINKLIST">
                            <span>{{(index + 1) + '. '}}</span><a :href="ITEM.LINK" target="_blank">{{ITEM.AD}}</a>
                        </div>
                    </div>
                    <div class="row" v-if="ODEVDETAY.DOSYALIST!=undefined && ODEVDETAY.DOSYALIST.length>0">
                        <div class="col-md-12"><h4><strong>Dosyalar</strong></h4></div>
                        <div class="col-md-12" v-for="(ITEM, index) in ODEVDETAY.DOSYALIST">
                            <span>{{(index + 1) + '. '}}</span><a :href="'https://okyanusdata.s3-eu-west-1.amazonaws.com/pusulam/odev/ogretmen/' + ITEM.GUID " target="_blank">{{ITEM.AD}}</a>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn default" data-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>

    <div id="MODAL_UPDATE" class="modal fade in" tabindex="-1" data-replace="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-body" style="padding-bottom:0px;" id="modal-body">
                    <div class="row">
                        <c-tarih tarihid="t_verilis"
                                 label="Veriliş Tarihi"
                                 gun="0"
                                 :idset="ODEVDETAY.VERILIS_TARIHI"
                                 @change-date="VerilisTarihiSelected">
                        </c-tarih>
                    </div>

                    <div class="row">
                        <c-tarih tarihid="t_teslim"
                                 label="Teslim Tarihi"
                                 gun="0"
                                 :idset="ODEVDETAY.TESLIM_TARIHI"
                                 @change-date="TeslimTarihiSelected">
                        </c-tarih>
                    </div>

                    <div class="row">
                        <div class="form-md-line-input">
                            <label class="control-label col-md-3">Başlık </label>
                            <div class="col-md-9">
                                <input type="text" v-model="ODEVDETAY.BASLIK" class="form-control" placeholder="Başlık" />
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-md-line-input">
                            <label class="control-label col-md-3">Açıklama </label>
                            <div class="col-md-9">
                                <textarea id="editor">{{ODEVDETAY.ACIKLAMA}}</textarea>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-md-line-input">
                            <label class="control-label col-md-3">Linkler </label>
                            <div class="col-md-9">
                                <div class="row" v-for="ITEM in ODEVDETAY.LINKLIST" style="padding-bottom:8px; margin-left:0px; margin-right:0px; border-bottom:1px solid gray; margin-top:0px!important;">
                                    <input type="text" v-model="ITEM.AD" class="form-control col-md-12" @change="LinkControl(ITEM)" placeholder="Link Açıklama" />
                                    <input type="text" v-model="ITEM.LINK" class="form-control col-md-12" @change="LinkControl(ITEM)" placeholder="Link" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-md-line-input">
                            <label class="control-label col-md-3">Dosyalar </label>
                            <div class="col-md-9">
                                <div class="fileinput fileinput-new" data-provides="fileinput">
                                    <div class="input-group" style="width:100%!important;">
                                        <div class="form-control uneditable-input input-fixed input-medium" data-trigger="fileinput" style="width:100%!important;">
                                            <i class="fa fa-file fileinput-exists"></i>&nbsp;
                                            <span class="fileinput-filename"> </span>
                                        </div>
                                        <span class="input-group-addon btn default btn-file">
                                            <span class="fileinput-new"> Dosya Seç </span>
                                            <span class="fileinput-exists"> Değiştir </span>
                                            <input multiple="multiple" type="file" name="..." id="Dosya">
                                        </span>
                                        <a href="javascript:;" class="input-group-addon btn red fileinput-exists" data-dismiss="fileinput"> Sil </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row" v-if="ODEVDETAY.DOSYALIST!=undefined && ODEVDETAY.DOSYALIST.length>0">
                        <div class="form-md-line-input">
                            <label class="control-label col-md-3"></label>
                            <div class="col-md-9">
                                <table class="table table-striped table-bordered table-hover table-checkable">
                                    <tbody>
                                        <tr v-for="(ITEM, index) in ODEVDETAY.DOSYALIST">
                                            <td>{{(index + 1) + '. '}}</td>
                                            <td>
                                                <a :href="'../../Dosyalar/Odev/' + ITEM.GUID + '.' + ITEM.UZANTI" target="_blank">{{ITEM.AD}}</a>
                                            </td>
                                            <td style="width:50px;">
                                                <button type="button" class="btn btn-xs btn-danger" @click="DosyaSil(ITEM)">SİL</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="row" v-if="ODEVDETAY.ID_MORPADERS>0">
                        <c-morpa-materyal-multi :controller="controller"
                                                :idmorpaders="ODEVDETAY.ID_MORPADERS"
                                                :idset="ODEVDETAYTEMP.ID_MORPAMATERYALLIST"
                                                @OnChange="MorpaMateryalSelected">
                        </c-morpa-materyal-multi>
                    </div>
                    <div class="row" v-if="ODEVDETAY.ID_MORPADERS>0">
                        <c-morpa-kazanim-multi :controller="controller"
                                               :idmorpaders="ODEVDETAY.ID_MORPADERS"
                                               :idset="ODEVDETAYTEMP.ID_MORPAKAZANIMLIST"
                                               @OnChange="MorpaKazanimSelected">
                        </c-morpa-kazanim-multi>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn default" data-dismiss="modal">Kapat</button>
                    <button type="button" class="btn btn-info" @click="Guncelle">Güncelle</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="assets/global/plugins/ckeditor/ckeditor.js"></script>
<script src="VueComponents/Filtre.js"></script>
<script src="VueComponents/FiltreEk.js?v=002"></script>

<script>
    var vue = new Vue({
        el: "#app",
        name: "OdevKontrol",

        data: {
            controller: 'OdevKontrol',
            ID_SUBE: 0,
            ID_KADEME3: 0,
            ID_SINIF: 0,
            D_ID_SUBE: 0,
            D_ID_KADEME3: 0,
            D_ID_SINIF: 0,
            TC_ODEVVEREN: '',
            LISTE: [],
            ODEVVERENODEVLISTE: [],
            ODEVKONTROLLISTE: [],
            DANISMAN: false,
            ODEVDETAY: {},
            ODEVDETAYTEMP: {},
            KONTROL: false,
            TEMPODEV: {DERSAD :"" , BASLIK : ""}
        },

        mounted() {
            var p = { TCKIMLIKNO: session.TCKIMLIKNO, OTURUM: session.OTURUM };
            WebPost(this, this.controller, "DanismanMi", p, '', '', function (data, parent) {
                parent.DANISMAN = data;
            })

            this.$nextTick(function () {
                CKEDITOR.replace('editor');
                //Editor değiştiğinde model güncellensin
                CKEDITOR.instances['editor'].on('change', function () {
                    vue.ODEVDETAY.ACIKLAMA = CKEDITOR.instances['editor'].getData();
                });
            })
        },

        methods: {
            MorpaMateryalSelected(val) {
                this.ODEVDETAY.ID_MORPAMATERYALLIST = val;
            },

            MorpaKazanimSelected(val) {
                this.ODEVDETAY.ID_MORPAKAZANIMLIST = val;
            },

            SubeSelected(val) {
                this.ID_SUBE = val;
                this.ID_KADEME3 = 0;
                this.ID_SINIF = 0;
            },

            Kademe3Selected(val) {
                this.ID_KADEME3 = val;
                this.ID_SINIF = 0;
            },

            SinifSelected(val) {
                this.ID_SINIF = val;
                this.Listele();
            },

            DanismanSubeSelected(val) {
                this.D_ID_SUBE = val;
                this.D_ID_KADEME3 = 0;
                this.D_ID_SINIF = 0;
            },

            DanismanKademe3Selected(val) {
                this.D_ID_KADEME3 = val;
                this.D_ID_SINIF = 0;
            },

            DanismanSinifSelected(val) {
                this.D_ID_SINIF = val;
            },

            OdevVerenSelected(val) {
                if (val != undefined) {
                    this.TC_ODEVVEREN = val;
                    this.OdevVerenOdevListele();
                }
            },

            VerilisTarihiSelected(val) {
                this.ODEVDETAY.VERILIS_TARIHI = val;
            },

            TeslimTarihiSelected(val) {
                this.ODEVDETAY.TESLIM_TARIHI = val;
            },

            LinkControl(ITEM) {
                var NEWS = [];
                for (var i = 0; i < this.ODEVDETAY.LINKLIST.length; i++) {
                    if (this.ODEVDETAY.LINKLIST[i].LINK.length > 0 || this.ODEVDETAY.LINKLIST[i].AD.length > 0) {
                        NEWS.push(this.ODEVDETAY.LINKLIST[i])
                    }
                }
                NEWS.push({ AD: '', LINK: '' });
                this.ODEVDETAY.LINKLIST = NEWS;
            },

            Listele() {
                this.LISTE = [];
                if (this.ID_SINIF != 0) {
                    var p = { TCKIMLIKNO: session.TCKIMLIKNO, OTURUM: session.OTURUM, ID_SINIF: this.ID_SINIF };
                    WebPost(vue, vue.controller, "Listele", p, '', '', function (data, parent) {
                        if (data != '[]') {
                            parent.LISTE = JSON.parse(data);
                            $('#MODAL_UPDATE').modal('hide');
                        }
                        else {
                            //Alert_Warning("Ödev Bulunamadı!");
                        }
                    })
                } else {
                    Alert_Warning("Sınıf Seçimi Zorunludur!");
                }
            },

            DetayGor(ID_ODEV, TUR) {
                this.ODEVDETAY = {};
                this.ODEVDETAYTEMP = {};
                vue.$forceUpdate();
                $('.fileinput').fileinput('clear');
                var p = { TCKIMLIKNO: session.TCKIMLIKNO, OTURUM: session.OTURUM, ID_ODEV: ID_ODEV };
                WebPost(vue, vue.controller, "OdevDetayGetir", p, '', '', function (data, parent) {
                    if (data != null) {
                        parent.ODEVDETAY = JSON.parse(data);
                        var data = JSON.parse(data);
                        if (TUR == 1) {
                            $('#MODAL_DETAY').modal();
                        }
                        else {
                            parent.ODEVDETAY.LINKLIST.push({ AD: '', LINK: '' });
                            CKEDITOR.instances['editor'].setData(parent.ODEVDETAY.ACIKLAMA);

                            parent.ODEVDETAY.ID_MORPAKAZANIMLIST = [];
                            for (var i = 0; i < data.ID_MORPAKAZANIMLIST.length; i++) {
                                parent.ODEVDETAY.ID_MORPAKAZANIMLIST.push(data.ID_MORPAKAZANIMLIST[i].ID_MORPAKAZANIM);
                            }

                            parent.ODEVDETAY.ID_MORPAMATERYALLIST = [];
                            for (var i = 0; i < data.ID_MORPAMATERYALLIST.length; i++) {
                                parent.ODEVDETAY.ID_MORPAMATERYALLIST.push(data.ID_MORPAMATERYALLIST[i].ID_MORPAMATERYAL);
                            }

                            parent.ODEVDETAYTEMP = JSON.parse(JSON.stringify(parent.ODEVDETAY));
                            $('#MODAL_UPDATE').modal();
                        }
                    }
                    else {
                        Alert_Warning("Bir Hata Oluştu!");
                    }
                })
            },

            DosyaListele(item) {
                this.ODEVDETAY = item;
                $('#MODAL_DOSYA').modal();
            },

            Sil(ID_ODEV) {
                Alert_Confirm("Emin misiniz?", "Ödevi silmek istediğinizden emin misiniz?", function () {
                    var p = {
                        TCKIMLIKNO: session.TCKIMLIKNO,
                        OTURUM: session.OTURUM,
                        ID_ODEV: ID_ODEV
                    };

                    WebPost(vue, vue.controller, "Sil", p, '', '', function (data, parent) {
                        if (data) {
                            Alert_Info("Ödev Silindi.");
                            vue.Listele();
                        } else {
                            Alert_Warning("Bir hata oluştu!");
                        }
                    });
                });
            },

            OgrenciListele(ID_ODEV, ID_SINIF, item) {
                this.TEMPODEV = item;
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    ID_ODEV: ID_ODEV,
                    ID_SINIF: ID_SINIF
                };

                WebPost(vue, vue.controller, "OgrenciListele", p, '', '', function (data, parent) {
                    if (data != null) {
                        $("#tab_1_1").attr("class", "tab-pane");
                        $("#tab_1_2").attr("class", "tab-pane");
                        $("#tab_1_3").attr("class", "tab-pane fade active in");
                        parent.KONTROL = true;
                        parent.ODEVKONTROLLISTE = JSON.parse(data);
                    } else {
                        Alert_Warning("Bir hata oluştu!");
                    }
                });
            },

            Geri() {
                $("#tab_1_1").attr("class", "tab-pane fade active in");
                $("#tab_1_2").attr("class", "tab-pane");
                $("#tab_1_3").attr("class", "tab-pane");
                this.KONTROL = false;
                this.ODEVKONTROLLISTE = [];
            },

            KontrolKaydet() {
                var LIST = [];
                for (var i = 0; i < this.ODEVKONTROLLISTE.length; i++) {
                    if (this.ODEVKONTROLLISTE[i].ID_ODEVDURUM != '') {
                        LIST.push(this.ODEVKONTROLLISTE[i]);
                    }
                }

                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    SQLJSON: JSON.stringify(LIST)
                };

                WebPost(vue, vue.controller, "OdevKontrolKaydet", p, '', '', function (data, parent) {
                    if (data) {
                        Alert_Info("Kaydedildi.");
                    } else {
                        Alert_Warning("Bir hata oluştu!");
                    }
                });
            },

            OdevVerenOdevListele() {
                this.ODEVVERENODEVLISTE = [];
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    TC_ODEVVEREN: this.TC_ODEVVEREN,
                    ID_SINIF: this.D_ID_SINIF
                };
                WebPost(vue, vue.controller, "OdevVerenOdevListele", p, '', '', function (data, parent) {
                    if (data != '[]') {
                        parent.ODEVVERENODEVLISTE = JSON.parse(data);
                    }
                    else {
                        //Alert_Warning("Ödev Bulunamadı!");
                    }
                })
            },

            DosyaSil(DOSYA) {
                this.ODEVDETAY.DOSYALIST.splice(this.ODEVDETAY.DOSYALIST.indexOf(DOSYA), 1);
            },

            Guncelle() {
                var VERILIS_TARIHI = (strToDate(this.ODEVDETAY.VERILIS_TARIHI));
                var TESLIM_TARIHI = (strToDate(this.ODEVDETAY.TESLIM_TARIHI));
                console.log(this.ODEVDETAY.ID_ODEVTUR, this.ODEVDETAY.ID_MORPAKAZANIMLIST.length);

                if (VERILIS_TARIHI > TESLIM_TARIHI) {
                    Alert_Info("Tarih Seçimini Kontrol Ediniz...");
                    return;
                }
                else if (this.ODEVDETAY.ID_ODEVTUR == 0) {
                    Alert_Info('Lütfen Ödev Türü Seçiniz.');
                    return;
                }
                if (this.ODEVDETAY.BASLIK.length == 0) {
                    Alert_Info('Lütfen Ödev Konusu Giriniz.');
                    return;
                }
                else if (this.ODEVDETAY.VERILIS_TARIHI.length == 0) {
                    Alert_Info('Lütfen Ödev Veriliş Tarihi Seçiniz.');
                    return;
                }
                else if (this.ODEVDETAY.TESLIM_TARIHI.length == 0) {
                    Alert_Info('Lütfen Ödev Teslim Tarihi Seçiniz.');
                    return;
                }
                else if (this.ODEVDETAY.ID_ODEVTUR == 5 && (this.ODEVDETAY.ID_MORPADERS == 0 || this.ODEVDETAY.ID_MORPAMATERYALLIST.length == 0 || this.ODEVDETAY.ID_MORPAKAZANIMLIST.length == 0)) {
                    Alert_Info('Morpa ödevleri için "Morpa Ders, Morpa Materyal, Morpa Kazanım" seçimleri zorunludur.');
                    return;
                }
                else {
                    var x = document.getElementById("Dosya");
                        if ('files' in x) {

                            let p = JSON.stringify(vue.ODEVDETAY);
                            var formData = new FormData();
                            formData.append("TCKIMLIKNO", session.TCKIMLIKNO);
                            formData.append("OTURUM", session.OTURUM);
                            formData.append("file", x.files[0]);
                            formData.append("SQLJSON", p);
                            formData.append("ID_ODEV", vue.ODEVDETAY.ID_ODEV)
                            $.ajax({
                                url: vue.controller + '/Guncelle',
                                processData: false,
                                contentType: false,
                                data: formData,
                                type: 'POST'
                            }).done(function (result) {
                                App.unblockUI('#app');
                                if (result != null) {
                                    vue.Kaydedildi();                                    
                                }
                                else
                                    Alert_Error("Dosya Yüklenirken Hata Oluştu")
                            })
                          
                         }
                    else {
                        var p = { TCKIMLIKNO: session.TCKIMLIKNO, OTURUM: session.OTURUM, SQLJSON: JSON.stringify(vue.ODEVDETAY) };
                        WebPost(vue, vue.controller, "Guncelle", p, '', '', function (data, parent) {
                            if (data > 0) {
                                Alert_Info("Kaydedildi!");
                                vue.Listele();
                            }
                            else {
                                Alert_Warning("Kaydedilirken Sorun Oluştu!");
                            }
                        })
                    }
                    //if ('files' in x) {
                    //    if (x.files.length > 0) {
                    //        var counter = 0;
                    //        var control = true;
                    //        for (var i = 0; i < x.files.length; i++) {
                    //            var file = x.files[i];
                    //            DosyaYukleOdev(file, 'Odev', function (data) {
                    //                counter++;
                    //                var RESULT = JSON.parse(data);
                    //                if (RESULT.success) {
                    //                    var DOSYA = new Object();
                    //                    DOSYA.AD = RESULT.ad;
                    //                    DOSYA.GUID = RESULT.guid;
                    //                    DOSYA.UZANTI = RESULT.uzanti;
                    //                    vue.ODEVDETAY.DOSYALIST.push(DOSYA);
                    //                } else {
                    //                    control = false;
                    //                }
                    //                if (x.files.length == counter) {
                    //                    if (!control) {
                    //                        Alert_Warning("Dosyalar Kaydedilirken Sorun Oluştu!");
                    //                    } else {
                    //                        var p = { TCKIMLIKNO: session.TCKIMLIKNO, OTURUM: session.OTURUM, SQLJSON: JSON.stringify(vue.ODEVDETAY) };
                    //                        WebPost(vue, vue.controller, "Guncelle", p, '', '', function (data, parent) {
                    //                            if (data > 0) {
                    //                                Alert_Info("Kaydedildi!");
                    //                                vue.Listele();
                    //                            }
                    //                            else {
                    //                                Alert_Warning("Kaydedilirken Sorun Oluştu!");
                    //                            }
                    //                        })
                    //                    }
                    //                }
                    //            });
                    //        }
                    //    } else {
                    //        var p = { TCKIMLIKNO: session.TCKIMLIKNO, OTURUM: session.OTURUM, SQLJSON: JSON.stringify(vue.ODEVDETAY) };
                    //        WebPost(vue, vue.controller, "Guncelle", p, '', '', function (data, parent) {
                    //            if (data > 0) {
                    //                Alert_Info("Kaydedildi!");
                    //                vue.Listele();
                    //            }
                    //            else {
                    //                Alert_Warning("Kaydedilirken Sorun Oluştu!");
                    //            }
                    //        })
                    //    }
                    //} else {
                    //    var p = { TCKIMLIKNO: session.TCKIMLIKNO, OTURUM: session.OTURUM, SQLJSON: JSON.stringify(vue.ODEVDETAY) };
                    //    WebPost(vue, vue.controller, "Guncelle", p, '', '', function (data, parent) {
                    //        if (data > 0) {
                    //            Alert_Info("Kaydedildi!");
                    //            vue.Listele();
                    //        }
                    //        else {
                    //            Alert_Warning("Kaydedilirken Sorun Oluştu!");
                    //        }
                    //    })
                    //}
                }
            },

            TumuSec(item) {
                $.each(this.ODEVKONTROLLISTE, (j, el) => {
                    el.ID_ODEVDURUM = item;
                });
            },
        },
    });
</script>
<script src="Scripts/PublicMethods.js"></script>
<script src="assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js" type="text/javascript"></script>
