<style>
    table td, th {
        font-size: 10px !important;
    }

    .TarihSecici {
        cursor: pointer;
        text-align: left;
        width: 100%;
        background: transparent;
        border: none;
        padding-left: 14px;
        padding-right: 14px;
        padding-top: 8px;
        padding-bottom: 7px;
    }
</style>

<div class="page-head">
    <div class="page-title col-md-12">
        <h1>
            Etüt Raporu <small>Öğretmen Etüt Raporu</small> <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
</div>

<div class="row" id="app">
    <div class="col-md-12">
        <div class="portlet box green-haze dd-item" style="border:none">
            <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Filtreler </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form collapse in" id="filters">
                <div class="form-body form-group-lg form-horizontal">
                    <div class="form-inline list-group-item row">

                        <div class="portlet light col-md-12" id="FiltreDiv" style="margin:0px; border-bottom-style: solid;border-bottom-width: 3px;border-bottom-color: rgb(0, 173, 239);">
                            <div class="portlet-body">
                                <div class="form-inline">
                                    <c-sube controller="EtutOgretmenRapor"
                                            @OnChange="SubeSelected">
                                    </c-sube>

                                    <c-kademe-sube-personel controller="EtutOgretmenRapor"
                                                :idsube="ID_SUBE"
                                                @OnChange="IdKademeSelected" />

                                    <c-ogretmen-multi controller="EtutOgretmenRapor"
                                                :idsube="ID_SUBE"
                                                :idkademe="ID_KADEME"
                                                @OnChange="TcPersonelSelected" />

                                    <!--<c-sube-ogretmen-yan controller="EtutOgretmenRapor"
                                                         :idsube="ID_SUBE"
                                                         :idders="0"
                                                         @OnChange="SubeOgretmenSelected">
                                    </c-sube-ogretmen-yan>-->
                                </div>
                            </div>
                        </div>

                        <div class="portlet light col-md-12" id="FiltreDivTarih" style="margin:0px; border-bottom-style: solid;border-bottom-width: 3px;border-bottom-color: rgb(0, 173, 239);" v-show="tcogretmen!=''">
                            <div class="portlet-body">
                                <div class="form-inline">
                                    <div class="row col-md-2" style="margin:0px;">
                                        <div class="dropdown-toggle btn grey-cararra" data-toggle="dropdown" role="button" title="Başlangıç Seçiniz.." style="width:100%; padding:0px;">
                                            <input type="text" id="bas" v-model="ITEM.BASLANGIC" class="TarihSecici" readonly placeholder="Başlangıç Seçiniz..">
                                            <span class="bs-caret" style="position:absolute; right:12px; top:5px;">
                                                <span class="caret"></span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="row col-md-2" style="margin:0px;">
                                        <div class="dropdown-toggle btn grey-cararra" data-toggle="dropdown" role="button" title="Bitiş Seçiniz.." style="width:100%; padding:0px;">
                                            <input type="text" id="bit" v-model="ITEM.BITIS" class="TarihSecici" readonly placeholder="Bitiş Seçiniz..">
                                            <span class="bs-caret" style="position:absolute; right:12px; top:5px;">
                                                <span class="caret"></span>
                                            </span>
                                        </div>
                                    </div>

                                    <input style="float:right;margin: 10px;" type="button" class="btn btn-success" v-on:click="Raporla" value="Raporla">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portlet light col-md-12" id="Tablodiv" style="min-height:100px;padding:20px;" v-if="divAc==1">
        <table id="tablobaslik" class="table table-striped table-bordered table-checkable" style="margin-bottom:0px; color:#111; margin:0px!important">
            <thead>
                <tr style="background:#32c5d2">
                    <th>Kampüs</th>
                    <th>Sınıf</th>
                    <th>Öğretmen <br /> Ad Soyad</th>
                    <th>Öğretmen <br /> Branşı</th>
                    <th>Toplam <br /> Etüt Dakikası</th>
                    <th>Detay</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="u in LISTE"    v-bind:style=" [u.GENEL== true ? {'background': '#32c5d2'} : {'background': 'lightyellow'} ]"  >
                    <td>{{u.ADSOYAD}}</td>                  
                    <td>{{u.BRANS}}</td>
                    <td>{{u.SUBEAD}}</td>
                    <td>{{u.SINIFAD}}</td>
                    <td>{{u.SURE}}</td>
                    <td>
                        <a @click="EtutDetay(u)" href="javascript:;" class="btn btn-outline btn-circle btn-sm green" v-if="u.SURE>0 && u.GENEL==false"><i class="fa fa-mail-forward"></i>Detay</a>
                    </td>

                </tr>
            </tbody>
        </table>
    </div>

    <div class="modal draggable fade" id="ModalEtutDetay" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="col-md-12" id="RaporTool">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                        <h4 class="modal-title" id="ModalBaslik">{{etutOgretmen.ADSOYAD}} - {{etutOgretmen.SINIFAD}}</h4><small>Etüt Detay Listesi</small>
                    </div>
                </div>

                <div class="modal-body">

                    <ul class="nav nav-tabs" style="display: none;">
                        <li style="display: none;" class="active"><a href="#tab_1_1" data-toggle="tab"></a></li>
                        <li style="display: none;"><a href="#tab_1_2" data-toggle="tab"></a></li>
                    </ul>
                    <div class="tab-content">

                        <div class="tab-pane fade active in" id="tab_1_1">
                            <div class="form-group">
                                <div class="row col-md-12">

                                    <table id="tablobaslik" class="table table-striped table-bordered table-checkable" style="margin-bottom:0px; color:#111; margin:10px!important">
                                        <thead>
                                            <tr>
                                                <th>Etüt Adı</th>
                                                <th>Etüt Yeri</th>
                                                <th>Etüt Tarihi</th>
                                                <th>Etüt Süresi</th>
                                                <th>Etüt Konuları</th>
                                                <th>Öğrenci Katılım Listesi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="u in ETUTDETAYLISTE">
                                                <td>{{u.ETUT}}</td>
                                                <td>{{u.YER}}</td>
                                                <td>{{u.ETUT_TARIH}}</td>
                                                <td>{{u.SURE}}</td>
                                                <td>
                                                    <p style="margin: 5px 0;" v-for="k in u.EU">
                                                        {{k.UNITE}}
                                                    </p>
                                                </td>
                                                <td>
                                                    <a @click="EtutOgrenciKatilimListesi(u)" href="javascript:;" class="btn btn-outline btn-circle btn-sm green"><i class="fa fa-mail-forward"></i>Detay</a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="tab_1_2">
                            <div class="form-group">
                                <a href="#tab_1_1" data-toggle="tab" class="btn btn-circle btn-outline btn-sm yellow" style="float: right;margin-right: 20px;"><i class="fa fa-mail-reply"></i>Geri</a>
                                <div class="row col-md-12">
                                    <table id="tablobaslik" class="table table-striped table-bordered table-checkable" style="margin-bottom:0px; color:#111; margin:10px!important">
                                        <thead>
                                            <tr>
                                                <th>Öğrenci <br /> Ad Soyad</th>
                                                <th style="text-align: center;">Katılım</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="u in ETUTDETAYOGRENCILISTE">
                                                <td>{{u.ADSOYAD}}</td>
                                                <td style="text-align: center;">
                                                    <i class="fa fa-check" v-if="u.KATILDI"></i>
                                                    <i class="fa fa-times" v-if="!u.KATILDI"></i>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" style="float:right" data-dismiss="modal"> Kapat </button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../../../VueComponents/SinavFiltreleri.js?v=5"></script>
<script src="../../../VueComponents/SinavIstatistikFiltreleri.js?v=5"></script>
<script src="../../VueComponents/Degerlendirme/Filtreler.js?v=5"></script>
<script>
    var vue = new Vue({
        el: "#app",
        name: "EtutOgretmenRapor.html",

        data: {
            divAc: 0,
            tcogretmen: "",
            ID_SUBE: 0,
            ID_KADEME: 0,
            ITEM: { BASLANGIC: "", BITIS: "" },
            etutOgretmen: [],
            ETUTDETAYLISTE: [],
            ETUTOGRENCILISTE: [],
            ETUTDETAYOGRENCILISTE: [],
            LISTE: [],
        },

        mounted() {
            $('.TarihSecici').each(function () {
                $(this).datepicker({
                    format: 'dd.mm.yyyy',
                    language: 'tr'
                }).on(
                    'changeDate', () => {
                        var day1 = $(this).datepicker('getDate').getDate();
                        var month1 = $(this).datepicker('getDate').getMonth() + 1;
                        var year1 = $(this).datepicker('getDate').getFullYear();
                        var fullDate = (day1 < 10 ? '0' + day1 : day1) + "." + (month1 < 10 ? '0' + month1 : month1) + "." + year1;

                        var tur = $(this).attr('id');

                        if (tur == 'bas') {
                            vue.ITEM.BASLANGIC = fullDate;
                        } else if (tur == 'bit') {
                            vue.ITEM.BITIS = fullDate;
                        }
                    }
                );
            });
        },

        methods: {
            SubeSelected(item) {
                this.ID_SUBE = item;
                this.tcogretmen = "";
                this.divAc = 0;
            },
            IdKademeSelected(item) {
                this.ID_KADEME = item;
                this.divAc= 0;
            },
            TcPersonelSelected(item) {
                this.tcogretmen = item;
                this.divAc= 0;
            },
            SubeOgretmenSelected(item) {
                this.tcogretmen = item;
                this.divAc = 0;
            },

            Raporla() {
                this.divAc = 0;

                if (this.ITEM.BASLANGIC == "")
                    this.ITEM.BASLANGIC = dateToStr(new Date());
                if (this.ITEM.BITIS == "")
                    this.ITEM.BITIS = dateToStr(new Date());

                var basTar = (strToDate(vue.ITEM.BASLANGIC));
                var bitTar = (strToDate(vue.ITEM.BITIS));

                if (basTar > bitTar) {
                    Alert_Warning("Tarih Seçimini Kontrol Ediniz...");
                    return;
                }

                if (this.tcogretmen != "") {
                    this.divAc = 1;

                    var p = {
                        TCKIMLIKNO: session.TCKIMLIKNO,
                        OTURUM: session.OTURUM,
                        TC_OGRETMENs: JSON.stringify( this.tcogretmen),
                        BASLANGIC_TARIH: this.ITEM.BASLANGIC,
                        BITIS_TARIH: this.ITEM.BITIS,
                        ID_SUBE: this.ID_SUBE,
                    };
                    WebPost(this, "EtutOgretmenRapor", "OgretmenSinifSureListele", p, "#app", "Yükleniyor...", function (data, parent) {
                        if (data != null) {
                            parent.LISTE = JSON.parse(data)[0].LISTE;
                            $('#filters').collapse();
                        } else {
                            Alert_Warning("Sınıf Bulunamadı..!");
                        }
                    });
                }
                else {
                    Alert_Warning("Lütfen Sınıf Seçimi Yapınız.")
                    this.divAc = 0;
                }
            },
            EtutDetay(item) {

                $("#tab_1_1").attr("class", "tab-pane fade active in");
                $("#tab_1_2").attr("class", "tab-pane");
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    ID_SINIF: item.ID_SINIF,
                    BASLANGIC_TARIH: this.ITEM.BASLANGIC,
                    BITIS_TARIH: this.ITEM.BITIS,
                    TC_OGRETMEN: item.TCKIMLIKNO
                };
                WebPost(this, "EtutOgretmenRapor", "OgretmenSinifDetayListele", p, "#app", "Yükleniyor...", function (data, parent) {
                    if (data != null) {
                        parent.ETUTDETAYLISTE = JSON.parse(data)[0].UNITELISTE;
                        parent.ETUTOGRENCILISTE = JSON.parse(data)[0].OGRENCILISTE;
                        parent.etutOgretmen = item;
                        $("#ModalEtutDetay").modal();
                    } else {
                        Alert_Warning("Sınıf Bulunamadı..!");
                    }
                });

            },
            EtutOgrenciKatilimListesi(item) {

                $("#tab_1_1").attr("class", "tab-pane");
                $("#tab_1_2").attr("class", "tab-pane fade active in");

                this.ETUTDETAYOGRENCILISTE = $.grep(this.ETUTOGRENCILISTE, function (el, j) {
                    return el.ID_ETUT == item.ID_ETUT;
                })[0].EO;

            },
        },
    });
</script>
<script src="../../../Scripts/PublicMethods.js?v=1.0.0"></script>
<script src="../../../assets/fixed-table/js/jquery.stickyheader.js"></script>