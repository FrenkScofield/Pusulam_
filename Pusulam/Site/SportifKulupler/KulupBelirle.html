<head>
    <script src="/Scripts/Tools.js"></script>
    <script src="../../../assets/global/plugins/nouislider/jquery.nouislider.js"></script>
</head>

<div class="page-head">
    <div class="page-title col-md-12">
        <h1>
            Sportif Kulüpler <small>Kulüp Belirleme</small>
            <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
</div>

<div class="row" id="app" style="margin-top:0px!important;">
    <div class="col-sm-12" v-if="!UYARI">
        <div class="row note note-success" style="border-left: 5px solid rgb(187, 219, 161); margin-top: 2em !important;">
            <h4>
                Yetenek ve Kulüp için aynı anda ikisini birden seçemezsiniz.
            </h4>
        </div>
    </div>

    <div class="col-md-6" v-if="ID_KULLANICITIPI ==5">
        <div class="portlet box blue-hoki dd-item" style="border:none">
            <div class="portlet-title dd-handle" data-toggle='collapse'>
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Öğrenci Seçimi </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form collapse in" id="filters">
                <form role="form" style="padding:12px 20px">
                    <div class="row">
                        <c-ogrenci-veli controller="YG_Secim"
                                        :tc="TCKIMLIKNO"
                                        @OnChange="OgrenciVeliSelected">
                        </c-ogrenci-veli>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="col-md-6" v-if="UYARI && KULUPSECSINMI">
        <div class="portlet box blue-hoki dd-item" style="border:none">
            <div class="portlet-title dd-handle" data-toggle='collapse'>
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Kulüp Belirle </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form collapse in" id="filters">
                <form role="form" style="padding:12px 20px">
                    <div class="row">
                        <label class="control-label col-md-3">
                            Kulüp
                        </label>
                        <c-kulup :controller="controller"
                                 @OnChange="KulupSelected"
                                 :kotali="true"
                                 :ogrenci_tc="TC_OGRENCI" />
                    </div>
                    <div class="row">
                        <div class="form-group" style="margin-top:10px;">
                            <div class="col-md-12 text-right">
                                <button type="button" class="btn green" @click="KulupEkle()">KAYDET</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="col-md-6" v-if="UYARI && KULUBEUYEMI">
        <div class="portlet box blue-hoki dd-item" style="border:none">
            <div class="portlet-title " data-toggle='collapse'>
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Kulüp Listesi </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form">
                <form role="form">
                    <div class="portlet light bordered">
                        <div class="portlet-body">
                            <table class="table table-striped table-bordered table-hover table-checkable order-column" id="tblListe">
                                <tbody>
                                    <tr class="odd gradeX" v-for="u in LISTE">
                                        <td>{{u.KULUPADI}}</td>
                                        <td><button @click="KuluptenAyril(u.KULUPPERIYOT)" class="btn btn-danger" :disabled="BUTONPASIF">Kulüpten Ayrıl</button></td>
                                        <td><button @click="modalKulupDuzenle(u.KULUPPERIYOT, u.ID_KULUP, u.KULUPADI)" class="btn btn-default" :disabled="BUTONPASIF">Kulüp Değiştir</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="modalDuzenle" class="modal fade in" tabindex="-1" data-replace="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body" style="padding-bottom:0px;" id="modal-body">
                    <div class="row">
                        <label class="control-label col-md-3">
                            Kulüp
                        </label>
                        <div class="col-md-9">
                            <c-kulup :controller="controller"
                                     @OnChange="KulupDuzenleSelected"
                                     :kotali="true"
                                     :id_kulup="ID_KULUP"
                                     :ogrenci_tc="TC_OGRENCI"  />
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn green" @click="KulupDuzenle()">Kulüp Düzenle</button>
                    <button type="button" class="btn default" data-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/VueComponents/SinavIstatistikFiltreleri.js?v=3"></script>
<!--<script src="VueComponents/SinavFiltreleri.js?v=4"></script>-->
<script src="VueComponents/KulupFiltreleri.js?v=3"></script>
<script>
    var vue = new Vue({
        el: "#app",
        name: "KulupBelirle",

        data: {
            controller: 'KulupBelirle',
            TCKIMLIKNO: '',
            OTURUM: '',
            LISTE: [],
            ID_KULUPKOTA: 0,
            ID_KULUP: 0,
            ID_SUBE: 0,
            KOTA: 0,
            DUZENLEKOTA: 0,
            KULUPADI: '',
            KULUPSECSINMI: false,
            KULUBEUYEMI: false,
            BUTONPASIF: false,
            UYARI: false,
            ListKullaniciTipi: [],
            TC_OGRENCI: '',
            ID_KULLANICITIPI: 0,
            

        },
        mounted() {
            this.YetkiKontrol();
            if (this.ID_KULLANICITIPI != 5) {
                this.TC_OGRENCI = session.TCKIMLIKNO
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    OGRENCI_TC: session.TCKIMLIKNO
                }

                WebPost(this, this.controller, "YetenekKulupKontrol", p, '', '', function (data, parent) {
                    parent.UYARI = JSON.parse(data).SONUC;
                    console.log(parent.UYARI);
                    if (parent.UYARI === true) {
                        parent.Listele();
                    }
                });
            }

        },
        methods: {
            OgrenciVeliSelected(tc) {
                this.TC_OGRENCI = tc
                this.deneme();
            },
            deneme() {
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    OGRENCI_TC: this.TC_OGRENCI
                }

                WebPost(this, this.controller, "YetenekKulupKontrol", p, '', '', function (data, parent) {
                    parent.UYARI = JSON.parse(data).SONUC;
                    console.log(parent.UYARI);
                    if (parent.UYARI === true) {
                        parent.Listele();
                    }
                });
            },
            YetkiKontrol() {
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM
                };
                var list = [];
                WebPost(this, "YG_Secim", "KullaniciTipiGetir", p, "#app", "Yükleniyor...", function (data, parent) {
                    if (data != null) {
                        $.each(data, function (j, el) {
                            list.push(this.ID_KULLANICITIPI)
                        });
                        parent.ListKullaniciTipi = list;
                        if (list.indexOf(5) > -1)
                            parent.ID_KULLANICITIPI = 5;

                    } else {
                        Alert_Warning("Kullanıcı Bulunamadı..!");
                    }
                });
            },
            SubeSelected(item) {
                this.ID_SUBE = item;
            },
            KulupSelected(item) {
                this.ID_KULUP = item;
            },
            KulupDuzenleSelected(item) {
                this.ID_KULUP = item;
            },
            Listele() {
                var TC = session.TCKIMLIKNO;
                if (this.ID_KULLANICITIPI == 5) {
                    TC = this.TC_OGRENCI;
                }

                p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    OGRENCI_TC: TC
                };

                WebPost(this, this.controller, "KulupKontrol", p, '', '', function (data, parent) {
                    var d = JSON.parse(data);
                    console.log(data)

                    parent.LISTE = JSON.parse(data);
                    if (d.length == 0) {
                        parent.KULUBEUYEMI = false;
                        parent.KULUPSECSINMI = true;
                        parent.BUTONPASIF = false;
                    }
                    else {
                        if (d[0].KULUPADI == "YOK") {
                            parent.KULUPSECSINMI = true;
                            parent.KULUBEUYEMI = false;
                            parent.BUTONPASIF = false;
                        } else {
                            parent.KULUPSECSINMI = false;
                            parent.KULUBEUYEMI = true;
                            parent.BUTONPASIF = false;
                        }

                        if (d[0].KULUPPERIYOT == 0) {
                            parent.KULUPSECSINMI = false;
                            parent.KULUBEUYEMI = true;
                            parent.BUTONPASIF = true;
                            Alert_Error("KULÜPLERE BAŞVURULAR ŞUAN ALINAMAMAKTADIR");
                        }
                    }

                    ListeOlustur('tblListe');
                })

            },
            KulupEkle() {
                if (this.ID_KULUP > 0) {
                    var TC = session.TCKIMLIKNO;
                    if (this.ID_KULLANICITIPI == 5) {
                        TC = this.TC_OGRENCI;
                    }
                    var p = {
                        TCKIMLIKNO: session.TCKIMLIKNO,
                        OTURUM: session.OTURUM,
                        ID_KULUP: this.ID_KULUP,
                        OGRENCI_TC: TC
                    }

                    WebPost(this, this.controller, "KulupEkle", p, '', '', function (data, parent) {
                        if (data) {
                            console.log(data);
                            vue.Listele();
                            Alert_Info("Kulüp başarılı bir şekilde kaydedildi.")
                        } else {
                            Alert_Warning("Kulüp eklenirken bir hata oluştu.");
                        }
                    });
                }
                else {
                    Alert_Warning("Kulüp seçiniz.");
                }

            },
            KulupDuzenle() {
                var TC = session.TCKIMLIKNO;
                if (this.ID_KULLANICITIPI == 5) {
                    TC = this.TC_OGRENCI;
                }
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    ID_KULUP: this.ID_KULUP,
                    OGRENCI_TC: TC
                };
                WebPost(this, this.controller, "KulupDuzenle", p, '', '', function (data, parent) {
                    vue.Listele();
                    Alert_Info("Kulüp başarılı bir şekilde güncellendi.")
                    $('#modalDuzenle').modal("hide")
                });
            },
            modalKulupDuzenle(Kulupperiyot, kulupId, kulupAdi) {
                vue = this;
                this.ID_KULUPPERIYOT = Kulupperiyot;
                this.ID_KULUP = kulupId;
                this.KULUPADI = kulupAdi;

                var TC = session.TCKIMLIKNO;
                if (this.ID_KULLANICITIPI == 5) {
                    TC = this.TC_OGRENCI;
                }
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    KOTALI: "true",
                    OGRENCI_TC: TC
                };

                WebPost(this, this.controller, "KulupListele", p, '', '', function (data, parent) {
                    console.log(data)
                    if (data != null && data != undefined && data != "") {
                        parent.Liste = data;
                        $('#modalDuzenle').modal();
                    } else {
                        Alert_Info("Seçebileceğiniz uygun bir kulüp yoktur.");
                    }
                });
            },
            KuluptenAyril(Kulupperiyot) {
                var TC = session.TCKIMLIKNO;
                if (this.ID_KULLANICITIPI == 5) {
                    TC = this.TC_OGRENCI;
                }
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    OGRENCI_TC: TC,
                    ID_KULUPPERIYOT: Kulupperiyot
                }
                Alert_Confirm("Kulüpten Ayrılma", "Kulüpten ayrılmak istediğinize emin misiniz ?", function () {
                    WebPost(vue, "KulupBelirle", "KuluptenAyril", p, '', '', function (data, parent) {
                        if (data) {
                            Alert_Info("Kulüpten ayrıldınız.");
                            parent.Listele();
                        } else {
                            Alert_Warning("İşlem sırasında bir sorunla karşılaşıldı. Bu durumu lütfen destek birimine bildiriniz.");
                        }
                    });
                })
            }
        },
    });
</script>
<script src="Scripts/PublicMethods.js"></script>