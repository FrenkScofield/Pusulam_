<style>
    .optionGroup {
        font-weight: bold;
        font-style: italic;
    }

    .optionChild {
        margin-left: 15px !important;
    }

    .divider {
        background: #337ab7 !important;
        margin: 0px !important;
    }

    .dropdown-header {
        padding: 0px !important;
    }
</style>

<div class="page-head">
    <div class="page-title col-md-12">
        <h1>
            Yetenek Gelişim Seçim
            <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
</div>


<div class="row" id="app">
    <div class="col-md-12" v-if="ListKullaniciTipi.indexOf(5)>-1">
        <div class="portlet box green-haze dd-item" style="border:none">
            <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
                <div class="caption">
                    <i class="icon-note"></i>
                    <span class="caption-subject bold uppercase">  </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form collapse in" id="filters">
                <form role="form" style="padding:12px 20px">
                    <div class="form-body form-group-lg form-horizontal row" style="padding: 0px;margin-top: 0px !important;">

                        <div class="portlet light  col-md-12" id="FiltreDivVeli" style="margin:0px; border-bottom-style: solid;border-bottom-width: 3px;border-bottom-color: rgb(0, 173, 239);"
                             v-if="ListKullaniciTipi.indexOf(5)>-1">
                            <div class="portlet-body">
                                <div class="form-inline">
                                    <c-ogrenci-veli controller="YG_Secim"
                                                    :tc="TCKIMLIKNO"
                                                    @OnChange="OgrenciVeliSelected">
                                    </c-ogrenci-veli>
                                </div>
                            </div>
                        </div>
                        <!--<div class="portlet light col-md-12" id="FiltreDivOgrenci" style="margin:0px; border-bottom-style: solid;border-bottom-width: 3px;border-bottom-color: rgb(0, 173, 239);"
                             v-if="ListKullaniciTipi.indexOf(4)>-1 || divOgrenci==1">
                            <div class="portlet-body">
                                <div class="form-inline">

                                    <div class="col-md-6">
                                        <c-yetenek-ders-secilebilir controller="YG_Secim"
                                                                    :tcogrenci="TC_OGRENCI"
                                                                    :idset="ID_KATEGORI"
                                                    @OnChange="YetenekDersSelected">
                                        </c-yetenek-ders-secilebilir>
                                    </div>

                                    <input style="float:right;margin: 10px;" type="button" class="btn btn-success" v-on:click="Kaydet" value="Kaydet">

                                </div>
                            </div>
                        </div>-->
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="portlet light col-md-12" style="min-height: 100px;padding:0px;"  v-if="UYARI">

        <table class="table table-striped table-bordered table-hover table-checkable" style="font-size:x-small; ">
            <thead>
                <tr>
                    <th>Yetenek</th>
                    <th>Açıklama</th>
                    <th>Yetenek Seç</th>
                    <th v-if="TARIH_ARALIK_MI">Yetenek Çık</th>
                </tr>
            </thead> 
            <tbody>
                <tr v-for="u in KATEGORILIST">
                    <td v-bind:style="[u.SECILI ? {color:'red'} : {}]">
                        {{u.AD}}
                        <div v-if="u.SECILI==1">
                            (Seçmiş Olduğunuz Yetenek)
                        </div>
                    </td>
                    <td v-bind:style="[u.SECILI ? {color:'red'} : {}]"> {{u.ACIKLAMA}} </td>
                    <td>
                        <input style="float:right;margin: 10px;" type="button" class="btn btn-success" v-on:click="Kaydet(u.ID_KATEGORI)" :value="[u.SECILI==1 ? 'SEÇİLEN  YETENEK' : 'SEÇ']" :disabled="u.SECILI==1">
                    </td>
                    <td v-if="TARIH_ARALIK_MI">
                        <button type="button" v-if="u.SECILI==1" class="btn btn-danger" v-on:click="Cik()">Yetenek İptal Et</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="row note note-success" style="border-left: 5px solid rgb(187, 219, 161); margin-top: 2em !important;" v-if="!UYARI">
        <h4>
            Yetenek Gelişim ve Kulüp için aynı anda ikisini birden seçemezsiniz.
        </h4>
    </div>
</div>

<script src="/VueComponents/SinavIstatistikFiltreleri.js?v=3"></script>
<script src="../../VueComponents/YetenekGelisim/Filtreler.js"></script>
<script>
    var vue = new Vue({
        el: "#app",
        name: "YG_Secim.html",

        data: {
            ID_KATEGORI: undefined,
            TC_OGRENCI: undefined,
            ListKullaniciTipi: [],
            divOgrenci: 0,
            KATEGORILIST: [],
            UYARI: false,
            TARIH_ARALIK_MI: false,
        },
        mounted() {


        

            var p = {
                TCKIMLIKNO: session.TCKIMLIKNO,
                OTURUM: session.OTURUM
            };
            var list = [];
            WebPost(this, "YG_Secim", "KullaniciTipiGetir", p, "#app", "Yükleniyor...", function (data, parent) {
                if (data != null) {
                    $.each(data, function (j, el) {
                        list.push(this.ID_KULLANICITIPI)
                    });
                    parent.ListKullaniciTipi = list;
                    if (list.indexOf(4) > -1)
                        parent.TC_OGRENCI = session.TCKIMLIKNO;

                    parent.Kontrol();
                } else {
                    Alert_Warning("Kullanıcı Bulunamadı..!");
                }
            });


        },
        methods: {
            YetenekDersSelected(val) {
                this.ID_KATEGORI = val;
            },

            OgrenciVeliSelected(val) {
                this.TC_OGRENCI = val;
                this.divOgrenci = 1;
                this.ID_KATEGORI = undefined;
                this.KategoriListe();
            },

            Kaydet(idKategori) {

                if (idKategori == 0 || idKategori == undefined) {
                    Alert_Warning("Yetenek Dersi Seçiniz.");
                    return;
                }
                else if (this.TC_OGRENCI == '' || this.TC_OGRENCI == undefined) {
                    Alert_Warning("Öğrencinizi Seçiniz.");
                    return;
                }
                else {
                    var p = {
                        TCKIMLIKNO: session.TCKIMLIKNO,
                        OTURUM: session.OTURUM,
                        TC_OGRENCI: this.TC_OGRENCI,
                        ID_KATEGORI: idKategori,
                    };

                    WebPost(this, "YG_Secim", "YetenekDersSec", p, "", "Yükleniyor...", function (data, parent) {
                        if (data) {
                            console.log(data);
                         
                                Alert_Info("Kayıt İşlemi Yapıldı");
                                parent.KategoriListe();
                               //Alert_Info("Aynı dönemde Kulüp ve Yetenek Gelişimin ikisini birden seçemezsiniz.");
                        } else {
                            Alert_Warning("Kayıt İşlemi Yapılamadı..!");
                        }
                    });
                }

            },

            Cik() {
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    TC_OGRENCI: this.TC_OGRENCI,
                };

                WebPost(this, "YG_Secim", "YetenekDersCik", p, "", "Yükleniyor...", function (data, parent) {
                    if (data) {
                        Alert_Info("Yetenek başarıyla iptal edildi.");
                        parent.KategoriListe();
                    } else {
                        Alert_Warning("Yetenek iptel edilemedi..!");
                    }
                });
            },

            KategoriListe() {
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    TC_OGRENCI: this.TC_OGRENCI,
                };

                WebPost(this, "YG_Secim", "SecilebilirYetenekListesi", p, "", "Yükleniyor...", function (data, parent) {

                    var SECIMTARIH = JSON.parse(data)[0].SECIM[0].SECIMTARIH;
                    var YETENEKDERS = JSON.parse(data)[0].SECIM[0].YETENEKDERS;
                    parent.TARIH_ARALIK_MI = SECIMTARIH;
                    parent.KATEGORILIST = JSON.parse(data)[0].LIST;

                    if (!SECIMTARIH && YETENEKDERS != null) {
                        Alert_Warning('Yerleştiğiniz yetenek  "' + YETENEKDERS + '". Yetenek ders seçme tarihlerinde olmadığınız için değiştiremiyoruz.');
                    }
                    else if (!SECIMTARIH && YETENEKDERS == null) {
                        Alert_Warning("Yerleştiğiniz yetenek bulunamamıştır. Yetenek ders seçme tarihlerinde olmadığınız için değiştiremiyoruz.");
                    }
                });
            },

            Kontrol() {
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    TC_OGRENCI: this.TC_OGRENCI,
                };

                WebPost(this, "YG_Secim", "YetenekKlupKontrol", p, "", "Yükleniyor...", function (data, parent) {
                    parent.UYARI = JSON.parse(data).SONUC;
                    if (parent.UYARI === true)
                        parent.KategoriListe();
                });
            }

        },
    });
</script>
<script src="../../../Scripts/PublicMethods.js"></script>
