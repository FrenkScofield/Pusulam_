<style>
    td {
        vertical-align: middle !important;
    }

    .row {
        margin-top: 10px !important;
    }
</style>
<div class="page-head">
    <!-- BEGIN PAGE TITLE -->
    <div class="page-title col-md-12">
        <h1>
            Zümre Çalışmaları <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
    <!-- END PAGE TITLE -->
</div>

<div class="row" id="app">
    <div class="col-md-12">
        <div class="portlet box blue-hoki dd-item" style="border:none">
            <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
                <div class="caption">
                    <i class="icon-list"></i>
                    <span class="caption-subject bold uppercase"> Filtreler </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <!-- BEGIN PORTLET-->
            <div class="portlet-body form collapse in" id="filters">
                <form role="form" style="padding:12px 20px">
                    <div class="row">
                        <c-donem :controller="CONTROLLER"
                                 @OnChange="DonemSelected" />
                    </div>
                    <div class="row">
                        <c-sube-tumu :controller="CONTROLLER"
                                @OnChange="SubeSelected" />
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-12">
        <div class="portlet light">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-list font-green"></i>
                    <span class="caption-subject bold font-green uppercase"> Zümre Çalışma Listesi </span>
                    <span class="caption-helper"></span>
                </div>
                <div class="tools" style="color:#32c5d2!important; line-height:34px;">
                    <span style="cursor:pointer;float:right;" @click="EkleModal">Zümre Çalışması Ekle<i class="fa fa-lg fa-plus-circle" style="margin-left:4px;" /></span>
                </div>
            </div>
            <!-- BEGIN PORTLET-->
            <div class="portlet-body form">
                <form role="form">
                    <div class="portlet light bordered">
                        <div class="portlet-body">
                            <div style="overflow-x:auto">
                                <table class="table table-striped table-bordered table-hover table-checkable" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>Ad</th>
                                            <th>Eğitimci</th>
                                            <th>Şube</th>
                                            <th>Mekan</th>
                                            <th>Tarih</th>
                                            <th>Saat</th>
                                            <th>Kota</th>
                                            <th>Onay</th>
                                            <th style="width:120px!important;">İŞLEM</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="odd gradeX" v-for="(u, index) in LISTE">
                                            <td>{{u.AD}}</td>
                                            <td>{{u.EGITIMCI}}</td>
                                            <td>{{u.SUBE}}</td>
                                            <td>{{u.MEKAN}}</td>
                                            <td>{{u.TARIH}}</td>
                                            <td>{{u.SAAT}}</td>
                                            <td>{{u.KOTA}}</td>
                                            <td>
                                                <i v-if="u.ONAY" class="fa fa-lg fa-check" style="color:#32c5d2;"></i>
                                                <i v-else class="fa fa-lg fa-close" style="color:red;"></i>
                                            </td>
                                            <td style="width:120px!important;">
                                                <button style='width:100%;' @click='KatilimBelgesi(u.ID_ZUMRECALISMA)' :disabled="!u.KATILIM_DURUM" class='btn btn-sm blue'>
                                                    KATILIM BELGESİ <i class='fa fa-list'></i>
                                                </button>
                                                <a style='width:100%; margin-top:10px;' @click='DuzenleModal(u)' class='btn btn-sm yellow'> DETAY GÖR <i class='fa fa-pencil'></i></a>
                                                <a style='width:100%; margin-top:10px;' @click='Sil(u.ID_ZUMRECALISMA)' class='btn btn-sm red'> SİL <i class='fa fa-trash'></i></a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <!-- END PORTLET-->
        </div>
    </div>

    <div id="ekle_modal" class="modal fade in" tabindex="-1" data-replace="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title">Zümre Çalışması Ekle</h4>
                </div>

                <div class="modal-body" style="padding-bottom:0px;" v-show="ITEM!=null">
                    <div class="form-body form-horizontal">
                        <div class="row" style="margin:0px;">
                            <c-donem :controller="CONTROLLER"
                                     :idset="DONEM"
                                     disabled="true"
                                     @OnChange="ItemDonemSelected" />
                        </div>
                        <div class="row" style="margin:0px;">
                            <div class="form-md-line-input">
                                <label class="control-label col-md-3" style="vertical-align:middle;">Adı </label>
                                <div class="col-md-9">
                                    <input class="form-control" type="text" v-model="ITEM.AD" />
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin:0px;">
                            <div class="form-md-line-input">
                                <label class="control-label col-md-3" style="vertical-align:middle;">Eğitimci </label>
                                <div class="col-md-9">
                                    <input class="form-control" type="text" v-model="ITEM.EGITIMCI" />
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin:0px;">
                            <c-sube :controller="CONTROLLER"
                                    :idset="ITEMSET.ID_SUBE"
                                    disabled="true"
                                    @OnChange="ItemSubeSelected" />
                        </div>
                        <div class="row" style="margin:0px;">
                            <div class="form-md-line-input">
                                <label class="control-label col-md-3" style="vertical-align:middle;">Mekan </label>
                                <div class="col-md-9">
                                    <input class="form-control" type="text" v-model="ITEM.MEKAN" />
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin:0px;">
                            <c-tarih-turkish tarihid="t_zumre"
                                             label="Tarih"
                                             gun="0"
                                             :idset="ITEMSET.TARIH"
                                             @change-date="TarihSelected">
                            </c-tarih-turkish>
                        </div>
                        <div class="row" style="margin:0px;">
                            <c-saat id="s_zumre"
                                    label="Saat"
                                    :idset="ITEMSET.SAAT"
                                    @change-time="SaatSelected">
                            </c-saat>
                        </div>
                        <div class="row" style="margin:0px;">
                            <div class="form-md-line-input">
                                <label class="control-label col-md-3" style="vertical-align:middle;">Kota </label>
                                <div class="col-md-9">
                                    <input class="form-control" type="text" v-model="ITEM.KOTA" onkeypress='return event.charCode >= 44 && event.charCode <= 57' />
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin:0px;">
                            <div class="form-md-line-input">
                                <label class="control-label col-md-3" style="vertical-align:middle;">Onay </label>
                                <div class="col-md-9">
                                    <div class="md-checkbox" style="width:20px!important; display:block;" @click="OnayDegis(ITEM)">
                                        <input type="checkbox" v-model="ITEM.ONAY" class="md-check" v-bind:true-value="true" v-bind:false-value="false" />
                                        <label>
                                            <span></span>
                                            <span class="check"></span>
                                            <span class="box"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin:0px;">
                            <div class="form-md-line-input">
                                <label class="control-label col-md-3" style="vertical-align:middle;">Yazılı Link </label>
                                <div class="col-md-9">
                                    <input class="form-control" type="text" v-model="ITEM.YAZILILINK" />
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin:0px;">
                            <div class="form-md-line-input">
                                <label class="control-label col-md-3" style="vertical-align:middle;">Detay </label>
                                <div class="col-md-9">
                                    <textarea class="form-control" rows="3" v-model="ITEM.DETAY" style="resize:vertical" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn green" @click="Ekle" v-if="ITEM.ID_ZUMRECALISMA==undefined||ITEM.ID_ZUMRECALISMA==0">EKLE</button>
                    <button type="button" class="btn green" @click="Guncelle" v-if="ITEM.ID_ZUMRECALISMA>0">GÜNCELLE</button>
                    <button type="button" class="btn default" data-dismiss="modal">KAPAT</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="VueComponents/Filtre.js?v=001"></script>
<script src="VueComponents/FiltreEk.js?v=001"></script>
<script>
    var vue = new Vue({

        el: "#app",
        name: "Tanimla.html",

        data: {
            CONTROLLER: 'ZumreCalismaTanimlama',
            LISTE: [],
            ITEM: {},
            ITEMSET: {},
            DONEM: null,
            ID_SUBE: null,
        },

        mounted() {
        },

        methods: {
            DonemSelected(item) {
                this.DONEM = item;
                if (this.ID_SUBE > 0) {
                    this.Listele();
                }
            },

            SubeSelected(item) {
                this.ID_SUBE = item;
                if (this.DONEM!=null) {
                    this.Listele();
                }                
            },

            ItemDonemSelected(item) {
                this.ITEM.DONEM = item;
            },

            ItemSubeSelected(item) {
                this.ITEM.ID_SUBE = item;
            },

            TarihSelected(item) {
                this.ITEM.TARIH = item;
            },

            SaatSelected(item) {
                this.ITEM.SAAT = item;
            },

            Ekle() {
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    SQLJSON: JSON.stringify(this.ITEM)
                };

                WebPost(this, this.CONTROLLER, "ZumreCalismaEkle", p, '', '', function (data, parent) {
                    if (data) {
                        vue.Listele();
                        $('#ekle_modal').modal('hide');
                    }
                    else {
                        Alert_Warning("Kaydetme işlemi sırasında bir sorun oluştu! Daha sonra tekrar deneyiniz...");
                    }
                });
            },

            Guncelle() {
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    ID_ZUMRECALISMA: this.ITEM.ID_ZUMRECALISMA,
                    SQLJSON: JSON.stringify(this.ITEM)
                };

                WebPost(this, this.CONTROLLER, "ZumreCalismaGuncelle", p, '', '', function (data, parent) {
                    if (data) {
                        vue.Listele();
                        $('#ekle_modal').modal('hide');
                    }
                    else {
                        Alert_Warning("Güncelle işlemi sırasında bir sorun oluştu! Daha sonra tekrar deneyiniz...");
                    }
                });
            },

            Sil(ID) {
                Alert_Confirm("Emin misiniz?", "Zümre çalışması silinecek.", function () {
                    var p = {
                        TCKIMLIKNO: session.TCKIMLIKNO,
                        OTURUM: session.OTURUM,
                        ID_ZUMRECALISMA: ID
                    };

                    WebPost(vue, vue.CONTROLLER, "ZumreCalismaSil", p, '', '', function (data, parent) {
                        if (data) {
                            vue.Listele();
                            $('#ekle_modal').modal('hide');
                        }
                        else {
                            Alert_Warning("Silme işlemi sırasında bir sorun oluştu! Daha sonra tekrar deneyiniz...");
                        }
                    });
                });
            },

            Listele() {
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    DONEM: this.DONEM,
                    ID_SUBE: this.ID_SUBE
                };

                WebPost(this, this.CONTROLLER, "ZumreCalismaListele", p, '', '', function (data, parent) {
                    if (data != null && data.length > 0) {
                        vue.LISTE = JSON.parse(data);
                    }
                    else {
                        vue.LISTE = [];
                    }
                });
            },

            EkleModal() {
                if (this.ID_SUBE > 0) {
                    this.ITEM = new Object();
                    this.ITEM.AD = '';
                    this.ITEM.ID_ZUMRECALISMA = 0;
                    this.ITEM.DONEM = this.DONEM;
                    this.ITEM.ID_SUBE = this.ID_SUBE;
                    this.ITEM.ONAY = false;
                    $('#ekle_modal').modal();
                } else {
                    Alert_Warning("Şube seçimi zorunludur!");
                }
            },

            DuzenleModal(item) {
                this.ITEM = JSON.parse(JSON.stringify(item));
                this.ITEMSET = JSON.parse(JSON.stringify(item));
                $('#ekle_modal').modal();
            },


            OnayDegis(item) {
                item.ONAY = !item.ONAY;
                vue.$forceUpdate();
            },

            
            KatilimBelgesi(ID_ZUMRECALISMA) {
    
                window.open("Rapor.aspx?raporTur=PDF&rapor=ZumreCalisma.KatilimBelgesi&p="
                    + session.TCKIMLIKNO + ";"
                    + session.OTURUM + ";"
                    + ID_ZUMRECALISMA + ";"
                    + 1239 + ";"
                    + 0
                );
            }
        }
    });
</script>
<script src="Scripts/PublicMethods.js"></script>
<script src="assets/global/plugins/icheck/icheck.min.js"></script>