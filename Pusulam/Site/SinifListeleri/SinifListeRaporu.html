<style>
    table {
        font-family: 'Open Sans', sans-serif;
        width: 100%;
        border-collapse: collapse;
        border: 3px solid #44475C;
        margin: 10px 10px 0 10px;
    }

        table th {
            text-transform: uppercase;
            text-align: left;
            background: #44475C;
            color: #FFF;
            padding: 8px;
            min-width: 30px;
            text-align: center;
        }

        table td {
            text-align: left;
            padding: 8px;
            border-right: 2px solid #7D82A8;
            font-size: 10px !important;
            cursor: default !important;
            color: #000;
            font-weight: 700;
            text-align: center;
        }

            table td:last-child {
                border-right: none;
            }

        table tbody tr:nth-child(2n) td {
            background: #D4D8F9;
        }

    .badge-danger {
        background-color: #F34C59;
        font-size: 9px !important;
    }
</style>

<div class="page-head">
    <!-- BEGIN PAGE TITLE -->
    <div class="page-title col-md-12">
        <h1>
            Sınıf Liste Raporu  <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
    <!-- END PAGE TITLE -->
</div>

<div class="row" id="app">
    <div class="col-md-12">
        <div class="portlet box green-haze dd-item" style="border:none; margin-bottom:0px!important;">
            <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Filtreler </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form collapse in" id="filters">

                <div class="portlet light col-md-12" style="margin:0px; border-bottom-style: solid;border-bottom-width: 3px;border-bottom-color: rgb(0, 173, 239);">
                    <div class="portlet-body">
                        <div class="form-inline">
                            <div class="row">
                                <div class="col-md-12 row">
                                    <c-sube-multi :controller="controller"
                                                  @OnChange="SubeSelected">
                                    </c-sube-multi>
                                </div>

                                <div class="col-md-12 row">
                                    <c-kademe3-multi :controller="controller"
                                                     :idsubelist="SUBELER"
                                                     @OnChange="Kademe3Selected">
                                    </c-kademe3-multi>
                                </div>
                                <div class="col-md-12 row">
                                    <c-sinif-multi :controller="controller"
                                                   :idsubelist="SUBELER"
                                                   :idkademe3list="ID_KADEME3LIST"
                                                   @OnChange="SinifSelected">
                                    </c-sinif-multi>
                                </div>

                                <div class="col-md-12 row">
                                    <div class="form-md-line-input">
                                        <div class="col-md-3"></div>
                                        <div class="col-md-9">
                                            <button type="button" class="btn yellow" @click="RaporOlustur" v-if="SINIFLAR.length==1 ||(SINIFLAR.length==2 && SINIFLAR.indexOf(0)>-1)">Listele</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12 row">
                                    <div class="col-md-3">Öğrenci Listesi</div>
                                    <div class="col-md-9" style=" margin-left: -20px;">
                                        <c-rapor-tur-buton colmd="3" @Yazdir="Yazdir"> </c-rapor-tur-buton>
                                    </div>
                                </div>
                                <div class="col-md-12 row">
                                    <div class="col-md-3">Veli Listesi</div>
                                    <div class="col-md-9" style=" margin-left: -20px;">
                                        <c-rapor-tur-buton colmd="3" @Yazdir="YazdirVeli"> </c-rapor-tur-buton>
                                    </div>
                                </div>
                                <div class="col-md-12 row">
                                    <div class="col-md-3">Danişman Öğretmen Listesi</div>
                                    <div class="col-md-9" style=" margin-left: -20px;">
                                        <c-rapor-tur-buton colmd="3" @Yazdir="YazdirDanismanOgretmen"> </c-rapor-tur-buton>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-12" v-if="SINIFLISTE.length>0">
        <div class="portlet light">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-list font-green"></i>
                    <span class="caption-subject bold font-green uppercase">Sınıf Listesi </span>
                    <span class="caption-helper"></span>
                </div>
            </div>
            <!-- BEGIN PORTLET-->

            <div class="portlet-body form">
                <form role="form">
                    <div class="portlet light bordered">
                        <div class="portlet-body">
                            <table class="table table-striped table-bordered table-hover table-checkable" id="table_arama">
                                <thead>
                                    <tr>
                                        <th>Fotoğraf</th>
                                        <th>Şube Ad</th>
                                        <th>Sınıf </th>
                                        <th>TCKIMLIKNO</th>
                                        <th style="text-align:left;">AD SOYAD</th>
                                        <th>Kayıt Tarihi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="odd gradeX" v-for="u in SINIFLISTE">
                                        <td v-if="u.FOTOGRAF==''">
                                            <img src="../../../img/okyanus_image.jpg" class='img-rounded' height="60" width="60" style="position:center" />
                                        </td>
                                        <td v-else>
                                            <img :src='"data:image/png;base64,"+ u.FOTOGRAF' class='img-rounded' height="60" width="60" style="position:center" />
                                        </td>
                                        <td>{{u.SUBEAD}}</td>
                                        <td>{{u.SINIF}}</td>
                                        <td>{{u.TCKIMLIKNO}}</td>
                                        <td style="text-align:left;">{{u.ADSOYAD}}</td>
                                        <td style="text-align:left;">{{u.KAYIT_TARIH}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <!-- END PORTLET-->
    </div>
</div>

<script src="/VueComponents/Genel.js?v=3"></script>
<script src="../../VueComponents/Filtre.js?v=001"></script>
<script>
    var vue = new Vue({
        el: "#app",
        name: "SinifListeRaporu.html",

        data: {
            controller: 'SinifListeRapor',
            TCKIMLIKNO: session.TCKIMLIKNO,
            OTURUM: session.OTURUM,
            ID_KADEME3LIST: [],
            SINIFLAR: [],
            SUBELER: [],
            SINIFLISTE: [],
        },

        methods: {
            SubeSelected(val) {
                this.SUBELER = val;
                this.SINIFLISTE = [];
            },

            Kademe3Selected(val) {
                this.ID_KADEME3LIST = val;
                this.SINIFLISTE = [];
            },

            SinifSelected(val) {
                this.SINIFLAR = val;
                this.SINIFLISTE = [];
            },

            RaporOlustur() {
                this.SINIFLISTE = [];

                var p = {
                    TCKIMLIKNO: this.TCKIMLIKNO,
                    OTURUM: this.OTURUM,
                    ID_SUBELER: JSON.stringify(this.SUBELER),
                    ID_SINIFLAR: JSON.stringify(this.SINIFLAR)
                };

                WebPost(this, this.controller, "SinifListeRaporuFotografli", p, '', '', function (data, parent) {
                    if (data != '[]') {
                        parent.SINIFLISTE = JSON.parse(data);
                    }
                    else {
                        Alert_Warning("Sınıf Listesi Bulunamadı");
                    }
                });
            },

            Yazdir(ciktiTuru) {
                if (ciktiTuru == "") {
                    Alert_Warning("Çıktı Türünü Seçiniz.");
                    return;
                }

                if ((this.SINIFLAR.length == 0 && this.ID_KADEME3LIST.length > 0) || this.SUBELER.length == 0) {
                    Alert_Warning("Şube,Grup ve Sınıf Seçimlerini yapmanız gerekmektedir.");
                } else {


                    var params = 'SinifListesi.SinifListeRaporu' +
                        '@' + ciktiTuru +
                        '@' + session.TCKIMLIKNO +
                        '@' + session.OTURUM +
                        '@' + JSON.stringify(this.SINIFLAR) +
                        '@' + JSON.stringify(this.SUBELER) +
                        '@' + 0;

                    var xForm = document.createElement("form");
                    xForm.target = "rapor";
                    xForm.method = "POST";
                    xForm.action = "../RaporPost.aspx";

                    var xInput = document.createElement("input");
                    xInput.type = "text";
                    xInput.name = "p";
                    xInput.value = params;
                    xForm.appendChild(xInput);
                    xForm.hidden = "hidden";
                    document.body.appendChild(xForm);

                    map = window.open("", "rapor", "");

                    if (map) {
                        xForm.submit();
                    } else {
                        Alert_Error('Açılır sekmelere izin veriniz.');
                    }


                    //window.open('../Rapor.aspx?rapor=SinifListesi.SinifListeRaporu&raporTur=' + ciktiTuru + '&p='
                    //    + this.TCKIMLIKNO + ';'
                    //    + this.OTURUM + ';'
                    //    + (this.SINIFLAR.indexOf(0) > -1 ? '[0]' : JSON.stringify(this.SINIFLAR)) + ';'
                    //    + JSON.stringify(this.SUBELER) + ';0'
                    //    , '_blank');
                }
            },
            YazdirDanismanOgretmen(ciktiTuru) {
                if (ciktiTuru == "") {
                    Alert_Warning("Çıktı Türünü Seçiniz.");
                    return;
                }
                if (this.SINIFLAR.length == 0 || this.SUBELER.length == 0) {
                    Alert_Warning("Şube,Grup ve Sınıf Seçimlerini yapmanız gerekmektedir.");
                } else {
                    var params = 'SinifListesi.SinifListeRaporu' +
                        '@' + ciktiTuru +
                        '@' + session.TCKIMLIKNO +
                        '@' + session.OTURUM +
                        '@' + JSON.stringify(this.SINIFLAR) +
                        '@' + JSON.stringify(this.SUBELER) +
                        '@' + 2;

                    var xForm = document.createElement("form");
                    xForm.target = "rapor";
                    xForm.method = "POST";
                    xForm.action = "../RaporPost.aspx";

                    var xInput = document.createElement("input");
                    xInput.type = "text";
                    xInput.name = "p";
                    xInput.value = params;
                    xForm.appendChild(xInput);
                    xForm.hidden = "hidden";
                    document.body.appendChild(xForm);

                    map = window.open("", "rapor", "");

                    if (map) {
                        xForm.submit();
                    } else {
                        Alert_Error('Açılır sekmelere izin veriniz.');
                    }
                    //window.open('../Rapor.aspx?rapor=SinifListesi.SinifListeRaporu&raporTur=' + ciktiTuru + '&p=' + this.TCKIMLIKNO + ';' + this.OTURUM + ';' + JSON.stringify(this.SINIFLAR) + ';' + JSON.stringify(this.SUBELER) + ';1', '_blank');
                }
            },

            YazdirVeli(ciktiTuru) {
                if (ciktiTuru == "") {
                    Alert_Warning("Çıktı Türünü Seçiniz.");
                    return;
                }

                if (this.SINIFLAR.length == 0 || this.SUBELER.length == 0) {
                    Alert_Warning("Şube,Grup ve Sınıf Seçimlerini yapmanız gerekmektedir.");
                } else {
                    var params = 'SinifListesi.SinifListeRaporu' +
                        '@' + ciktiTuru +
                        '@' + session.TCKIMLIKNO +
                        '@' + session.OTURUM +
                        '@' + JSON.stringify(this.SINIFLAR) +
                        '@' + JSON.stringify(this.SUBELER) +
                        '@' + 1;

                    var xForm = document.createElement("form");
                    xForm.target = "rapor";
                    xForm.method = "POST";
                    xForm.action = "../RaporPost.aspx";

                    var xInput = document.createElement("input");
                    xInput.type = "text";
                    xInput.name = "p";
                    xInput.value = params;
                    xForm.appendChild(xInput);
                    xForm.hidden = "hidden";
                    document.body.appendChild(xForm);

                    map = window.open("", "rapor", "");

                    if (map) {
                        xForm.submit();
                    } else {
                        Alert_Error('Açılır sekmelere izin veriniz.');
                    }
                    //window.open('../Rapor.aspx?rapor=SinifListesi.SinifListeRaporu&raporTur=' + ciktiTuru + '&p=' + this.TCKIMLIKNO + ';' + this.OTURUM + ';' + JSON.stringify(this.SINIFLAR) + ';' + JSON.stringify(this.SUBELER) + ';1', '_blank');
                }
            },
        },
    });
</script>
<script src="Scripts/PublicMethods.js"></script>
