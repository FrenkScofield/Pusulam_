<style>
    table td, th {
        font-size: 10px !important;
    }
    .TarihSecici  {
        cursor: pointer;
        text-align: left;
        width: 100%;
        background: transparent;
        border: none;
        padding-left: 14px;
        padding-right: 14px;
        padding-top: 8px;
        padding-bottom: 7px;
    }
    .BitTarih {
        cursor: pointer;
        text-align: left;
        width: 100%;
        background: transparent;
        border: none;
        padding-left: 14px;
        padding-right: 14px;
        padding-top: 8px;
        padding-bottom: 7px;
    }
</style>

<div class="page-head">
    <div class="page-title col-md-12">
        <h1>
            Viu Raporlar <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
</div>

<div class="row" id="app">
    <div class="col-md-12">
        <div class="portlet box green-haze dd-item" style="border:none">
            <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Filtreler </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form collapse in" id="filters">
                <div class="form-body">
                    <div class="portlet-body">
                        <form role="form">

                            <div class="row">
                                <c-rehber-danisman-sinif-multi :controller="controller"
                                                               @OnChange="SinifSelected">
                                </c-rehber-danisman-sinif-multi>
                            </div>
                            <!--<div class="row">
        <c-sube-multi :controller="controller"
                      @OnChange="SubeSelected">
        </c-sube-multi>
    </div>

    <div class="row">
        <c-kademe3 :controller="controller"
                   :idsubelist="ID_SUBELIST"
                   @OnChange="Kademe3Selected">
        </c-kademe3>
    </div>
    <div class="row">
        <c-sinif-multi :controller="controller"
                       :idsubelist="ID_SUBELIST"
                       :idkademe3="ID_KADEME3"
                       @OnChange="SinifSelected">
        </c-sinif-multi>
    </div>-->
                            <div class="row">
                                <div class="form-md-line-input">
                                    <label class="control-label col-md-3" style="vertical-align:middle;">Başlangıç Tarihi </label>
                                    <div class="col-md-9">
                                        <div class="dropdown-toggle btn grey-cararra" data-toggle="dropdown" role="button" title="Yoklama Başlangıç Tarihi Seçiniz.." style="width:100%; padding:0px;">
                                            <input type="text" id="bas" v-model="BASLANGICTARIH" class="TarihSecici" readonly placeholder="Yoklama Başlangıç Tarihi Seçiniz..">
                                            <span class="bs-caret" style="position:absolute; right:12px; top:5px;">
                                                <span class="caret"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-md-line-input">
                                    <label class="control-label col-md-3" style="vertical-align:middle;">Bitiş Tarihi </label>
                                    <div class="col-md-9">
                                        <div class="dropdown-toggle btn grey-cararra" data-toggle="dropdown" role="button" title="Yoklama Bitiş Tarihi Seçiniz.." style="width:100%; padding:0px;">
                                            <input type="text" id="bit" v-model="BITISTARIH" class="BitTarih" readonly placeholder="Yoklama Bitiş Tarihi Seçiniz..">
                                            <span class="bs-caret" style="position:absolute; right:12px; top:5px;">
                                                <span class="caret"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group" style="margin-top:10px;">
                                    <div class="col-md-12 text-right" style="padding-right:15px;">
                                        <button class="btn blue" @click="OgrenciYoklamaListele" style="margin-right:10px;">LİSTELE</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12" v-if="LISTE.length>0">
        <div class="portlet light">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-list font-green"></i>
                    <span class="caption-subject bold font-green uppercase"> Öğrenci Yoklama Listesi </span>
                    <span class="caption-helper"></span>
                </div>
            </div>
            <div class="portlet-body form">
                <form role="form">
                    <div class="portlet light bordered">
                        <div class="portlet-body">
                            <div class="table-responsive sticky-table sticky-headers sticky-ltr-cells">
                                <table class="table table-bordered" id="table_Yoklama">
                                    <thead>
                                        <tr class="sticky-header">
                                            <th class="sticky-cell" style=" background-color: #8B9DC3; color: white;">Tarih</th>
                                            <th class="sticky-cell" style=" background-color: #8B9DC3; color: white;">Kampüs</th>
                                            <th class="sticky-cell" style=" background-color: #8B9DC3; color: white;">Sınıf</th>
                                            <th class="sticky-cell" style=" background-color: #3B5998; color: white;">Ad Soyad</th>
                                            <th style="background-color: #8B9DC3; color: white;" v-for="u in LISTE[0].YOKLAMALISTE"> {{u.BASSAAT +' - '+ u.BITSAAT}} </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="u in LISTE">
                                            <td class="sticky-cell" style="background-color: #F7F7F7;">{{u.TARIH}}</td>
                                            <td class="sticky-cell" style="background-color: #F7F7F7;">{{u.SUBEAD}}</td>
                                            <td class="sticky-cell" style="background-color: #F7F7F7;">{{u.SINIF}}</td>
                                            <td class="sticky-cell" style="background-color: #DFE3EE;">{{u.AD}} {{u.SOYAD}}</td>
                                            <td v-for="y in u.YOKLAMALISTE">
                                                <div v-if="y.GELDI==null">
                                                    {{y.GELDI}}
                                                </div>
                                                <div v-else>

                                                    <img width="27" height="27" src="../../../img/tick.png" v-if="y.GELDI">
                                                    <img width="27" height="27" src="../../../img/wrong.png" v-if="!y.GELDI" />
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="/VueComponents/Filtre.js?v=6"></script>
<script src="/VueComponents/Viu/Filtreler.js?v=6"></script>
<script src="/VueComponents/Genel.js?v=6"></script>
<script>

    var vue = new Vue({
        el: "#app",
        name: "RehberDanismanYoklama",

        data: {
            controller: 'RehberDanismanYoklama',

            ID_SUBELIST: [],
            ID_KADEME3: 0,
            ID_SINIFLIST: [],
            LISTE: [],
            YOKLAMATARIH: "",
            BASLANGICTARIH: "",
            BITISTARIH: ""
        },

        mounted() {
            this.$nextTick(function () {
                $('.TarihSecici').each(function () {
                    $(this).datepicker({
                        format: 'dd.mm.yyyy',
                        language: 'tr'
                    }).on(
                        'changeDate', () => {
                            var day1 = $(this).datepicker('getDate').getDate();
                            var month1 = $(this).datepicker('getDate').getMonth() + 1;
                            var year1 = $(this).datepicker('getDate').getFullYear();
                            var fullDate = (day1 < 10 ? '0' + day1 : day1) + "." + (month1 < 10 ? '0' + month1 : month1) + "." + year1;
                            var tur = $(this).attr('id');
                            vue.BASLANGICTARIH = fullDate;
                        }
                    );
                });
                $('.BitTarih').each(function () {
                    $(this).datepicker({
                        format: 'dd.mm.yyyy',
                        language: 'tr'
                    }).on(
                        'changeDate', () => {
                            var day1 = $(this).datepicker('getDate').getDate();
                            var month1 = $(this).datepicker('getDate').getMonth() + 1;
                            var year1 = $(this).datepicker('getDate').getFullYear();
                            var fullDate = (day1 < 10 ? '0' + day1 : day1) + "." + (month1 < 10 ? '0' + month1 : month1) + "." + year1;
                            var tur = $(this).attr('id');
                            vue.BITISTARIH = fullDate;
                        }
                    );
                });
                
            });
        },

        methods: {
            SubeSelected(item) {
                this.ID_SUBELIST = item;
            },
            Kademe3Selected(item) {
                this.ID_KADEME3 = item;
            },
            SinifSelected(item) {
                this.ID_SINIFLIST = item;
            },


            OgrenciYoklamaListele() {
                if (this.BASLANGICTARIH == "" && this.BITISTARIH == "") {
                    this.BASLANGICTARIH = dateToStr(new Date());
                    this.BITISTARIH = dateToStr(new Date());

                };
                console.log(this.BASLANGICTARIH)
                console.log(this.BITISTARIH)
                ListeTemizle(this.LISTE);
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    ID_SINIFLIST: JSON.stringify(this.ID_SINIFLIST),
                    BASLANGICTARIH: dateToStr(strToDateTurkish(vue.BASLANGICTARIH), 'yyyy-mm-dd'),
                    BITISTARIH: dateToStr(strToDateTurkish(vue.BITISTARIH), 'yyyy-mm-dd'),

                };

                WebPost(this, this.controller, "OgrenciYoklamaListele", p, '', '', function (data, parent) {
                    if (data != null || data != undefined) {
                        parent.LISTE = JSON.parse(data);
                        $(document).trigger("stickyTable");
                        //ListeOlustur("table_Yoklama", [[0, 'asc'], [1, 'asc'], [2, 'asc'], [3, 'asc']]);
                    }
                });
            },
        },
    });
</script>
<script src="../../../Scripts/PublicMethods.js?v=1.0.0"></script>