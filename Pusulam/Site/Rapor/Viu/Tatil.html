<!--<div class="page-head">

    <div class="page-title col-md-12">
        <h1>
           Tatil <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>

</div>-->

<div class="row" id="app">
    <div class="col-md-12">
        <div class="portlet box green-haze dd-item" style="border:none; margin-bottom:0px!important;">
            <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Tatil Ekle </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form collapse in" id="filters">
                <div class="portlet light col-md-12" style="margin:0px; border-bottom-style: solid;border-bottom-width: 3px;border-bottom-color: rgb(0, 173, 239);">
                    <div class="portlet-body">
                        <div class="form-inline">
                            <div class="row">
                                <div class="form-group">
                                    <label class="control-label col-md-3">
                                        Tatil Adı
                                    </label>
                                    <div class="col-md-9">
                                        <input type="text" placeholder="Tatil Adı" class="form-control form-control-inline" v-model="tatilAdi">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3">
                                        Başlangıç Tarihi
                                    </label>
                                    <div class="col-md-9">
                                        <input type="text" id="dpBasTarih" data-date-format="dd-mm-yyyy" placeholder="Başlangıç Tarihi" class="form-control form-control-inline date-picker">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-3">
                                        Bitiş Tarihi
                                    </label>
                                    <div class="col-md-9">
                                        <input type="text" id="dpBitTarih" data-date-format="dd-mm-yyyy" placeholder="Bitiş Tarihi" class="form-control form-control-inline date-picker">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <button type="button" class="btn btn-success" @click="TatilEkle()" style="margin-left:10px; margin-right:10px;">Tatil Ekle</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12" v-show="tatilListesi.length>0">
        <div class="portlet light">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-list font-green"></i>
                    <span class="caption-subject bold font-green uppercase"> Tatil Listesi </span>
                    <span class="caption-helper"></span>
                </div>
            </div>
            <!-- BEGIN PORTLET-->
            <div class="portlet-body form">
                <form role="form">
                    <div class="portlet light bordered">
                        <div class="portlet-body">
                            <table class="table table-striped table-bordered table-hover table-checkable order-column" id="sample_1">
                                <thead>
                                    <tr>
                                        <th>Tatilin Adı</th>
                                        <th>Başlangıç Tarih</th>
                                        <th>Bitiş Tarihi</th>
                                        <th>Sil</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="odd gradeX" v-for="u in tatilListesi">
                                        <td>{{u.ADI}}</td>
                                        <td>{{u.BASLANGIC_TARIH}}</td>
                                        <td>{{u.BITIS_TARIH}}</td>
                                        <td><button @click="Sil(u.ID)" class="btn btn-danger">Sil</button></td>
                                        <!--<td>{{u.ID}}</td>-->
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
            <!-- END PORTLET-->
        </div>
    </div>
</div>

<script>
    var tblTatil = null;
    var vue = new Vue({
        el: "#app",
        name: "Tatil.html",

        data: {
            tatilAdi: '',
            tatilListesi: [],
            controller: 'Tatil'
        },

        mounted() {
            $('#dpBasTarih').datepicker({
                format: 'dd.mm.yyyy',
                language: 'tr'
            });

            $('#dpBitTarih').datepicker({
                format: 'dd.mm.yyyy',
                language: 'tr'
            });

            var p = {
                TCKIMLIKNO: session.TCKIMLIKNO,
                OTURUM: session.OTURUM,
            };
            WebPost(this, this.controller, "TatilListele", p, '', '', function (data, parent) {
                if (data != null) {
                    parent.tatilListesi = data;
                    //DOM update olmasını bekleyip update olunca listeyi oluşturuyor.
                    $("#sample_1").DataTable().destroy();
                    Vue.nextTick(function () {
                        tblTatil = $('#sample_1').DataTable(
                 {
                     language: {
                         "url": "./Utility/dil.json"
                     }
                 })
                    })
                }
                else {
                    Alert_Warning("Liste Bulunamadı!");
                }
            }
          )

        },
        methods: {
            TatilListele() {
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                };
                WebPost(this, this.controller, "TatilListele", p, '', '', function (data, parent) {
                    if (data != null) {
                        parent.tatilListesi = data;
                        //DOM update olmasını bekleyip update olunca listeyi oluşturuyor.
                        $("#sample_1").DataTable().destroy();
                        Vue.nextTick(function () {
                            tblTatil = $('#sample_1').DataTable(
                     {
                         language: {
                             "url": "./Utility/dil.json"
                         }
                     })
                        })
                    }
                    else {
                        Alert_Warning("Liste Bulunamadı!");
                    }
                }
              )
            },
            TatilEkle() {
                vue = this;
                var basTarih = $("#dpBasTarih").val();
                var bitTarih = $("#dpBitTarih").val();
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    BAS_TARIH: basTarih,
                    BIT_TARIH: bitTarih,
                    AD: this.tatilAdi
                };
                WebPost(this, this.controller, "TatilEkle", p, '', '', function (data, parent) {
                    if (data) {
                        parent.TatilListele();
                    } else {
                        Alert_Warning("Bir sorun oluştu. Daha sonra tekrar deneyiniz...");
                    }
                });
            },
            Sil(Id) {
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    ID_TATIL:Id
                }
                WebPost(this, this.controller, "TatilSil", p, '', '', function (data, parent) {
                    if (data) {
                        Alert_Info("Silindi");
                        parent.TatilListele();
                    } else {
                        Alert_Warning("Bir hata oluştu!");
                    }
                });
            }
        }
    });
</script>