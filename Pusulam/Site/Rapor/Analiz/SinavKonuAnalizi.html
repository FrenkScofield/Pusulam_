<head>
    <script src="Scripts/Rapor/amcharts.js"></script>
    <script src="Scripts/Rapor/jquery.easypiechart.js"></script>
    <script src="Scripts/Rapor/light.js"></script>
    <script src="Scripts/Rapor/serial.js"></script>
</head>

<style>
    #chartdiv {
        width: 100%;
        height: 500px;
        font-size: 11px;
    }

    #chartdiv2 {
        width: 100%;
        height: 500px;
        font-size: 11px;
    }

    .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        font-size: 11px;
    }


    .table-hover > tbody > tr:hover, .table-hover > tbody > tr:hover > td {
        color: black !important;
    }

    .turuncu {
        background-color: #EA5702 !important;
        color: white !important;
        font-size: 12px !important;
    }

    .fontsize12 {
        font-size: 12px !important;
    }

    .koyumavi {
        background-color: #0E3170;
        color: white;
    }

    .acikmavi {
        background-color: #2786C3;
        color: white;
    }

    .bordermavi {
        border: #2786C3 1px solid;
        text-align: center;
        color: black;
    }

    .bordersag {
        border-right: #b4d2e6 1px solid;
        text-align: center;
    }

    .analizbaslik {
        background-color: #FFA500 !important;
    }

    .fixed-table-body {
        overflow-x: hidden !important;
    }

    .red {
        color: red;
    }
</style>

<link href="assets/fixed-table/css/component.css?v=4" rel="stylesheet" />

<div class="page-head">
    <div class="page-title col-md-12">
        <h1>
            Konu Analizi
             <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
</div>

<div id="app">
    <div class="portlet box green-haze dd-item" style="border:none">
        <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
            <div class="caption">
                <i class="icon-magnifier"></i>
                <span class="caption-subject bold uppercase"> Filtreler </span>
                <span class="caption-helper"></span>
            </div>
            <div class='actions'>
                <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                    <i class='fa fa-chevron-down'></i>
                </a>
            </div>
        </div>
        <div class="portlet-body form collapse in" id="filters">
            <form role="form" style="padding:12px 20px">
                <div class="row">
                    <c-donem controller="SinavKonuAnalizi"
                             @OnChange="DonemSelected">
                    </c-donem>
                    <c-sube-multi controller="SinavKonuAnalizi"
                                  @OnChange="SubeSelected">
                    </c-sube-multi>
                    <c-kademe3 controller="SinavKonuAnalizi"
                               :idsubelist="idsubelist"
                               @OnChange="Kademe3Selected">
                    </c-kademe3>
                    <c-sinif-alan-multi controller="SinavKonuAnalizi"
                                        @OnChange="SinifAlanSelected">
                    </c-sinif-alan-multi>
                    <c-sinif-donem-alan-multi controller="SinavKonuAnalizi"
                                              :idsubelist="idsubelist"
                                              :idkademe3="idkademe3"
                                              :donem="donem"
                                              :sinifalan="sinifAlanList"
                                              @OnChange="SinifSelected">
                    </c-sinif-donem-alan-multi>
                </div>

                <div class="row">
                    <c-donem controller="SinavKonuAnalizi"
                             @OnChange="SinavDonemSelected">
                    </c-donem>
                    <c-sinav-turu-tc-multi controller="SinavKonuAnalizi"
                                           :donem="donemSinav"
                                           :ogrencidonem="donem"
                                           :idkademe3="idkademe3"
                                           @OnChange="SinavTuruSelected">
                    </c-sinav-turu-tc-multi>
                    <c-sinav-multi-multitur controller="SinavKonuAnalizi"
                                            :idsinavturu="idsinavturu"
                                            :donem="donemSinav"
                                            :ogrencidonem="donem"
                                            :idkademe3="idkademe3"
                                            @OnChange="SinavSelected">
                    </c-sinav-multi-multitur>
                    <c-ders-multi-multitur controller="SinavKonuAnalizi"
                                           :idkademe3="idkademe3"
                                           :idsinavturu="idsinavturu"
                                           @OnChange="DersSelected">
                    </c-ders-multi-multitur>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        Gruplama Türü:
                        <div class="row">
                            <div class="col-md-12">
                                <div class="md-radio">
                                    <input type="radio" id="radio1" name="rd" class="md-radiobtn" v-model="GRUPLAMATURU" value="3">
                                    <label for="radio1">
                                        <span></span>
                                        <span class="check"></span>
                                        <span class="box"></span> Ünite
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="md-radio">
                                    <input type="radio" id="radio2" name="rd" class="md-radiobtn" v-model="GRUPLAMATURU" value="2">
                                    <label for="radio2">
                                        <span></span>
                                        <span class="check"></span>
                                        <span class="box"></span> Konu
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="md-radio">
                                    <input type="radio" id="radio3" name="rd" class="md-radiobtn" v-model="GRUPLAMATURU" value="1">
                                    <label for="radio3">
                                        <span></span>
                                        <span class="check"></span>
                                        <span class="box"></span> Alt Konu (Kazanım)
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <input type="button" class="btn btn-success" v-on:click="Raporla" value="Raporla">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <c-rapor-tur-buton @Yazdir="Yazdir" />
                </div>
            </form>
        </div>
    </div>

    <div class="portlet light col-md-12" id="Tablodiv" style="min-height:100px;padding:0px;" v-if="divAc==1">
        <div class="comp-table" style="padding-bottom:0px;">
            <table class="table">
                <thead>
                    <tr>
                        <th>Sınav Adı</th>
                        <th>Tarih</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="sinav in TblSinavList">
                        <td>{{sinav.SINAVAD}}</td>
                        <td>{{sinav.SINAVTARIH}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="comp-table" id="divFixedTable" style="padding-top:0px;">
            <table id="tablobaslik"
                   class="overflow-y fixed-table">
                <thead id="thead"></thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>
        <div id="YuzdeListDiv">
        </div>
    </div>
</div>

<script src="assets/global/plugins/bootstrap-select/js/i18n/defaults-tr_TR.js"></script>
<script src="VueComponents/Genel.js?v=3"></script>
<script src="VueComponents/GenelSinavRaporuFiltreleri.js?v=18"></script>
<script>


    var vue = new Vue({
        el: "#app",
        name: "SinavKonuAnalizi.html",

        data: {
            GRUPLAMATURU: 1,
            donem: '',
            donemSinav: '',
            idkademe3: 0,
            idsinavturu: [],
            idsinav: 0,
            idsinavlist: [],
            idsubelist: [],
            idsiniflist: [],
            idderslist: [],
            TblVeri: [],
            TblDersList: [],
            TblSinavList: [],
            sinifAlanList: [],
            t3: [],
            t4: [],
            dersGenel: [],
            puanGenel: [],
            dersler: [],
            puanlar: [],
            subeler: [],
            subeler2: [],
            secim: 0,
            tcGorunsun: false,
            toplamSoru: 0,
            dID_SINAVPUANTURU: 0,
            TCKIMLIKNO: '',
            LISTE: [],
            kitapcikList: [],
            sinavAdi: '',
            sinavTarihi: '',
            divAc: 0,
            tcogrenci: '',
            idkullanicitur: 0,
            ListKullaniciTipi: [],
            divOgrenci: 1,
            kurGorunsun: false
        },

        methods: {
            DonemSelected(item) {
                this.donem = item;
                this.divAc = 0;
                this.divOgrenci = 0;
            },
            SinavDonemSelected(item) {
                this.donemSinav = item;
                this.divOgrenci = 0;
            },
            SubeSelected(item) {
                this.idsubelist = item;
                this.divAc = 0;
                this.divOgrenci = 0;
                ListeTemizle(this.sinifAlanList);
            },
            Kademe3Selected(item) {
                this.idkademe3 = item;
                this.divAc = 0;
                this.divOgrenci = 0;
                ListeTemizle(this.sinifAlanList);
            },
            SinifAlanSelected(item) {
                this.sinifAlanList = item;
                this.divAc = 0;
            },
            SinifSelected(item) {
                this.idsiniflist = item;
                this.divAc = 0;
                if (item.length > 0)
                    this.divOgrenci = 1;
            },
            SinavTuruSelected(item) {
                this.idsinavturu = item;
                this.idsinav = 0;
                this.divAc = 0;
                this.kurGorunsun = false;
            },
            SinavSelected(item) {
                this.idsinavlist = item;
                this.divAc = 0;
            },
            DersSelected(item) {
                this.idderslist = item;
                this.divAc = 0;
            },

            Yazdir(ciktiTuru) {
                if (ciktiTuru == "") {
                    Alert_Warning("Rapor Türünü Seçiniz.");
                    return;
                }

                if (this.idkademe3 != 0
                       && (this.idsinavlist.length > 0 || this.idsinavlist != undefined)
                       && (this.idderslist.length > 0 || this.idderslist != undefined)
                       && (this.idsubelist.length > 0 || this.idsubelist != undefined)) {
                    window.open('/Rapor.aspx?rapor=Sinav.Analiz.SinavKonuAnalizi&raporTur=' + ciktiTuru + '&p=' + session.TCKIMLIKNO + ';' + session.OTURUM + ';' + this.donem + ";" + JSON.stringify(this.idsinavlist) + ";" + JSON.stringify(this.idsubelist) + ";" + JSON.stringify(this.idsiniflist) + ";" + JSON.stringify(this.idderslist) + ";" + this.GRUPLAMATURU, '_blank');

                }
                else {
                    Alert_Warning("Lütfen Gerekli Seçimleri Yapınız ..!");
                    return;
                }
            },

            Raporla() {
                var _this = this;
                if (this.idkademe3 != 0
                    && (this.idsinavlist.length > 0 || this.idsinavlist != undefined)
                    && (this.idderslist.length > 0 || this.idderslist != undefined)
                    && (this.idsubelist.length > 0 || this.idsubelist != undefined)) {
                    this.divAc = 1;
                    var idderslist = JSON.stringify(this.idderslist);
                    var idsubelist = JSON.stringify(this.idsubelist);
                    var idsinavlist = JSON.stringify(this.idsinavlist);
                    var idsiniflist = JSON.stringify(this.idsiniflist);

                    $('#filters').collapse('hide');
                    var p = {
                        TCKIMLIKNO: session.TCKIMLIKNO,
                        OTURUM: session.OTURUM,
                        OGRENCIDONEM: this.donem,
                        ID_SINAVs: idsinavlist,
                        ID_SUBEs: idsubelist,
                        ID_DERSs: idderslist,
                        ID_SINIFs: idsiniflist,
                        GRUPLAMATURU: this.GRUPLAMATURU
                    };

                    WebPost(this, "SinavKonuAnalizi", "SinavKonuAnalizi", p, "#app", "Yükleniyor...", function (data, parent) {
                        if (data != "[{}]") {
                            _this.TblVeri = JSON.parse(data)[0].TblVeri;
                            _this.TblDersList = JSON.parse(data)[0].TblDersList;
                            _this.TblSinavList = JSON.parse(data)[0].TblSinavList;
                            parent.Listele();
                        } else {
                            Alert_Warning("Sınav Bulunamadı..!");
                            _this.divAc = 0;
                        }
                    });
                }
                else {
                    Alert_Warning("Lütfen Gerekli Seçimleri Yapınız")
                    _this.divAc = 0;
                }
            },

            Listele() {
                if (this.TblVeri == undefined) {
                    $("#thead").html("");
                    $("#tbody").html("");
                    Alert_Warning("Kayıt Bulunamadı..");
                    return;
                }

                divFixedTableClear();
                this.$nextTick(() => {
                    this.Baslik();
                    this.Icerik();
                    fixedTableCreate()
                });
            },

            Baslik() {
                var _this = this;
                var TblVeri = this.TblVeri;
                var TblDersList = this.TblDersList;

                var html = '';
                html += '<tr>';
                html += '<th>SIRA</th>';
                html += '<th>ÜNİTE ADI</th>';
                html += this.GRUPLAMATURU == 1 || this.GRUPLAMATURU == 2 ? '<th>KONU ADI</th>' : '';
                html += this.GRUPLAMATURU == 1 ? '<th>ALT KONU (KAZANIM)</th>' : '';
                html += '<th>SORU <br> SAYISI</th>';
                html += '<th>DOĞRU <br> YÜZDESİ</th>';
                html += '<th>YANLIŞ <br> YÜZDESİ</th>';
                html += '<th>BOŞ <br> YÜZDESİ</th>';
                html += '</tr>';
                $("#thead").html(html);
            },

            Icerik() {
                var _this = this;
                var TblVeri = this.TblVeri;
                var TblDersList = this.TblDersList;
                var kitapcikSayisi = _this.kitapcikList.length == undefined ? 1 : (_this.kitapcikList.length + 1);
                var html = '';
                $.each(TblDersList, function (k, ders) {
                    html += '<tr>';
                    html += '<td colspan="' + (8 + (this.GRUPLAMATURU == 1 ? 2 : this.GRUPLAMATURU == 2 ? 1 : 0)) + '" class="acikmavi">' + ders.DERSAD + '</td>';
                    html += '</tr>';
                    var sira = 1;
                    var result = $.grep(TblVeri, function (el, i) { return el.DERSAD == ders.DERSAD; });
                    $.each(result, function (j, konu) {
                        html += '<tr>';
                        html += '<td>' + sira + '</td>';
                        html += '<td>' + konu.UNITE + '</td>';
                        html += _this.GRUPLAMATURU == 1 || _this.GRUPLAMATURU == 2 ? '<td>' + konu.KONU + '</td>' : '';
                        html += _this.GRUPLAMATURU == 1 ? '<td>' + konu.KAZANIM + '</td>' : '';
                        html += '<td>' + konu.SORUSAYISI + '</td>';
                        html += '<td>' + konu.DOGRUYUZDESI + '</td>';
                        html += '<td>' + konu.YANLISYUZDESI + '</td>';
                        html += '<td>' + konu.BOSYUZDESI + '</td>';
                        sira++;
                        html += '</tr>';
                    });
                });
                $("#tbody").html(html);
            },
        },
    });
</script>
<script src="../../../Scripts/PublicMethods.js"></script>
<script src="../../../assets/fixed-table/js/jquery.stickyheader.js?v=4"></script>
