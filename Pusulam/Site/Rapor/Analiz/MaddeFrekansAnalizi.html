<head>
    <script src="../../../Scripts/Rapor/amcharts.js"></script>
    <script src="../../../Scripts/Rapor/jquery.easypiechart.js"></script>
    <script src="../../../Scripts/Rapor/light.js"></script>
    <script src="../../../Scripts/Rapor/serial.js"></script>
</head>

<style>
    #chartdiv {
        width: 100%;
        height: 500px;
        font-size: 11px;
    }

    #chartdiv2 {
        width: 100%;
        height: 500px;
        font-size: 11px;
    }

    .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        font-size: 11px;
    }


    .table-hover > tbody > tr:hover, .table-hover > tbody > tr:hover > td {
        color: black !important;
    }

    .turuncu {
        background-color: #EA5702 !important;
        color: white !important;
        font-size: 12px !important;
    }

    .fontsize12 {
        font-size: 12px !important;
    }

    .koyumavi {
        background-color: #0E3170;
        color: white;
    }

    .acikmavi {
        background-color: #2786C3;
        color: white;
    }

    .bordermavi {
        border: #2786C3 1px solid;
        text-align: center;
        color: black;
    }

    .bordersag {
        border-right: #b4d2e6 1px solid;
        text-align: center;
    }

    .analizbaslik {
        background-color: #FFA500 !important;
    }

    .fixed-table-body {
        overflow-x: hidden !important;
    }

    .red {
        color: red;
    }
</style>

<link href="../../../assets/fixed-table/css/component.css?v=4?v=1" rel="stylesheet" />

<div class="page-head">
    <div class="page-title col-md-12">
        <h1>
            Madde Frekans Analizi
             <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
</div>

<div class="row" id="app">
    <div class="col-md-12">
        <div class="portlet box green-haze dd-item" style="border:none">
            <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Filtreler </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form collapse in" id="filters">
                <div class="form-body form-group-lg form-horizontal">
                    <div id="FiltreDiv">
                        <div class="portlet-body">
                            <div class="form-inline list-group-item row">
                                <c-donem controller="MaddeFrekansAnalizi"
                                         @OnChange="DonemSelected">
                                </c-donem>
                                <c-sube-multi controller="MaddeFrekansAnalizi"
                                              @OnChange="SubeSelected">
                                </c-sube-multi>
                                <c-kademe3 controller="MaddeFrekansAnalizi"
                                           :idsubelist="idsubelist"
                                           @OnChange="Kademe3Selected">
                                </c-kademe3>
                                <div class="col-md-2">
                                    <select v-model="icDisOgrenci" @change="OgrenciGrubuSelected" class="selectpicker form-control" title="Öğrenci Grubunu Seçiniz..">
                                        <option value="0"> Tüm Öğrenciler </option>
                                        <option value="1"> Sadece Okyanus Öğrencileri</option>
                                        <option value="2"> Sadece Okyanus Dışı Öğrenciler</option>
                                    </select>
                                </div>
                                <div v-if="icDisOgrenci==1">
                                    <c-sinif-alan-multi controller="MaddeFrekansAnalizi"
                                                        @OnChange="SinifAlanSelected">
                                    </c-sinif-alan-multi>

                                </div>

                            </div>
                            <div class="form-inline list-group-item row">


                                <c-donem controller="SinifMaddeAnalizi"
                                         @OnChange="SinavDonemSelected">
                                </c-donem>

                                <c-sinav-turu-tc controller="SinifMaddeAnalizi"
                                                 :donem="donemSinav"
                                                 :ogrencidonem="donem"
                                                 :idkademe3="idkademe3"
                                                 @OnChange="SinavTuruSelected">
                                </c-sinav-turu-tc>



                                <c-sinav controller="SinifMaddeAnalizi"
                                         :idsinavturu="idsinavturu"
                                         :donem="donemSinav"
                                         :ogrencidonem="donem"
                                         :idkademe3="idkademe3"
                                         @OnChange="SinavSelected">
                                </c-sinav>
                                <!--<c-sinav-turu-tc controller="MaddeFrekansAnalizi"
                                                :tc="tcogrenci"
                                                :idkademe3="idkademe3"
                                                :donem="donem"
                                                @OnChange="SinavTuruSelected">
                                </c-sinav-turu-tc>
                                    <c-sinav controller="MaddeFrekansAnalizi"
                                            :idsinavturu="idsinavturu"
                                            :donem="donem"
                                            :idkademe3="idkademe3"
                                            @OnChange="SinavSelected">
                                </c-sinav>-->

                                <c-ders-multi controller="MaddeFrekansAnalizi"
                                              :idkademe3="idkademe3"
                                              :idsinavturu="idsinavturu"
                                              @OnChange="DersSelected">
                                </c-ders-multi>
                                <input style="float:right;" type="button" class="btn btn-success" v-on:click="Raporla" value="Raporla">
                            </div>
                            <div class="form-inline list-group-item row">
                                <c-rapor-tur-buton @Yazdir="Yazdir"> </c-rapor-tur-buton>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-12 portlet light" id="Tablodiv" style="min-height:100px;padding:0px;" v-if="divAc==1">

        <div class="col-md-12" style="height: 75px;padding: 25px; font-size: x-large; ">
            <div class="col-md-8"> Okyanus Kolejleri Ölçme ve Değerlendirme Birimi </div>
            <div class="col-md-4" style="font-size: medium; "> Rapor Tarihi : {{bugunTarih}}</div>
        </div>

        <div class="col-md-12 portlet light" style="background: steelblue;color:  white;text-align: center;font-size: large;">
            Madde Frekans Analizi
        </div>
        <div v-if="TblSinavOzellik.length>0 && TblSinavOzellik!=[]">
            <div class="col-md-12">
                <div class="col-md-2" style="text-align: right; font-weight: bold;"> Test Adı :</div>
                <div class="col-md-2"> {{TblSinavOzellik[0].SINAVAD}}</div>

                <div class="col-md-2" style="text-align: right; font-weight: bold;"> Tarih :</div>
                <div class="col-md-2"> {{TblSinavOzellik[0].SINAVTARIH}}</div>

                <div class="col-md-2" style="text-align: right; font-weight: bold;"> Katılım :</div>
                <div class="col-md-2"> {{TblSinavOzellik[0].SINAVKATILIM}}</div>
            </div>
            <div class="col-md-12">
                <div class="col-md-2" style="text-align: right; font-weight: bold;"> Soru Sayısı :</div>
                <div class="col-md-2"> {{TblSinavOzellik[0].TOPLAMSORUSAYISI}}</div>

                <div class="col-md-2" style="text-align: right; font-weight: bold;"> Ortalama Doğru Yanıt :</div>
                <div class="col-md-2"> {{TblSinavOzellik[0].ORTALAMADOGRU}}</div>

                <div class="col-md-2" style="text-align: right; font-weight: bold;"> KR-20 :</div>
                <div class="col-md-2"> {{TblSinavOzellik[0].KR20}}</div>
            </div>
        </div>
        <div class="col-md-12" v-for="ders in TblVeri">
            <div class="col-md-12" style="background: lightgrey;height: 50px;padding: 15px;">
                <div class="col-md-8">{{ders.BOLUMNO}} - {{ders.DERSAD}} </div>
                <div class="col-md-4">Soru Sayısı : {{ders.SORUSAYISI}} </div>
            </div>
            <div class="col-md-12 portlet light" v-for="soru in ders.SORULIST" style="margin:0px; border-bottom-style: solid;border-bottom-width: 3px;border-bottom-color: rgb(0, 173, 239);">
                <div class="col-md-8">
                    <div class="col-md-12">
                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Soru No : </div>
                        <div class="col-md-2"> {{soru.SORUNO_A}}</div>

                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Ayırıcılık : </div>
                        <div class="col-md-2"> {{soru.AYIRICILIK}}</div>

                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Kod : </div>
                        <div class="col-md-2"> {{soru.KOD}}</div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Toplam Yanıt :</div>
                        <div class="col-md-2"> {{soru.TOPLAMYANIT}}</div>

                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Zorluk :</div>
                        <div class="col-md-2"> {{soru.ZORLUKDERECESI}}</div>

                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Üst :</div>
                        <div class="col-md-2"> {{soru.USTKISISAYISI}}</div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Doğru Yanıt :</div>
                        <div class="col-md-2"> {{soru.DOGRUSAYISI}}</div>

                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Madde Güvenirlik :</div>
                        <div class="col-md-2"> {{soru.MADDEGUVENILIRLIK}}</div>

                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> ALT :</div>
                        <div class="col-md-2"> {{soru.ALTKISISAYISI}}</div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Yanlış Yanıt :</div>
                        <div class="col-md-2"> {{soru.YANLISSAYISI}}</div>

                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Varyans :</div>
                        <div class="col-md-2"> {{soru.VARYANS}}</div>

                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Doğru Cevap :</div>
                        <div class="col-md-2"> {{soru.DOGRUCEVAP}}</div>
                    </div>

                    <div class="col-md-12">
                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Boş Yanıt :</div>
                        <div class="col-md-2"> {{soru.BOSSAYISI}}</div>

                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Sapma :</div>
                        <div class="col-md-2"> {{soru.SAPMA}}</div>

                        <div class="col-md-2" style="text-align: right; font-weight: bold;"> Kalite :</div>
                        <div class="col-md-2"> {{soru.KALITE}}</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="col-md-12" :id='"chartdiv-"+ders.BOLUMNO+"-"+soru.SORUNO_A' style="height:100px;">
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

<script src="../../../VueComponents/Genel.js?v=3"></script>
<script src="../../../VueComponents/GenelSinavRaporuFiltreleri.js?v=17"></script>
<script>


    var vue = new Vue({
        el: "#app",
        name: "MaddeFrekansAnalizi.html",

        data: {
            donem: '',
            donemSinav: '',
            idkademe3: 0,
            idsinavturu: 0,
            idsinav: 0,
            idsinavlist: [],
            idsubelist: [],
            idsiniflist: [],
            sinifAlanList: [],
            idderslist: [],
            TblVeri: [],
            TblSinavOzellik: [],
            TblAltList: [],
            TblDersList: [],
            t4: [],
            dersGenel: [],
            puanGenel: [],
            dersler: [],
            puanlar: [],
            subeler: [],
            subeler2: [],
            secim: 0,
            sinavKatilim: 0,
            bugunTarih: '',

            tcGorunsun: false,
            toplamSoru: 0,
            dID_SINAVPUANTURU: 0,
            TCKIMLIKNO: '',
            LISTE: [],
            kitapcikList: [],

            sinavAdi: '',
            sinavTarihi: '',

            divAc: 0,
            tcogrenci: '',
            idkullanicitur: 0,
            ListKullaniciTipi: [],
            divOgrenci: 1,
            kurGorunsun: false,
            icDisOgrenci: 0



        },

        methods: {


            SinifAlanSelected(item) {

                this.sinifAlanList = item;
                //this.divAc = 0;
            },
            DonemSelected(item) {
                this.donem = item;
                //this.divAc = 0;
                this.divOgrenci = 0;
            },
            SinavDonemSelected(item) {
                this.donemSinav = item;
                //this.divAc = 0;
                this.divOgrenci = 0;
            },
            SubeSelected(item) {
                this.idsubelist = item;
                this.idsinif = 0;
                this.divAc = 0;
                this.divOgrenci = 0;
            },
            Kademe3Selected(item) {
                this.idkademe3 = item;
                this.divAc = 0;
                this.divOgrenci = 0;
            },
            SinifSelected(item) {
                this.idsiniflist = item;
                this.divAc = 0;
                if (item.length > 0)
                    this.divOgrenci = 1;
            },
            SinavTuruSelected(item) {
                this.idsinavturu = item;
                this.idsinav = 0;
                this.divAc = 0;
                this.kurGorunsun = false;

            },
            SinavSelected(item) {
                this.idsinavlist = [];
                this.idsinavlist.push(item);
                this.divAc = 0;
            },
            DersSelected(item) {
                this.idderslist = item;
                this.divAc = 0;
            },

            Yazdir(ciktiTuru) {

                if (ciktiTuru == "") {
                    Alert_Warning("Rapor Türünü Seçiniz.");
                    return;
                }
                if (this.idkademe3 != 0
                    && (this.idsinavlist.length > 0 || this.idsinavlist != undefined)
                    && (this.idderslist.length > 0 || this.idderslist != undefined)
                    && (this.idsubelist.length > 0 || this.idsubelist != undefined)) {
                    // window.open('/Rapor.aspx?rapor=Sinav.Analiz.MaddeFrekansAnalizi&raporTur=' + ciktiTuru + '&p=' + session.TCKIMLIKNO + ';' + session.OTURUM + ';' + this.donem + ";" + this.idkademe3 + ";" + this.idsinavturu + ";" + JSON.stringify(this.idsinavlist) + ";" + JSON.stringify(this.idsubelist) + ";" +/* JSON.stringify(this.idsiniflist) + ";" +*/ JSON.stringify(this.idderslist), '_blank');
                    window.open('/Rapor.aspx?rapor=Sinav.Analiz.MaddeFrekansAnalizi&raporTur=' + ciktiTuru + '&p='
                        + session.TCKIMLIKNO + ';'
                        + session.OTURUM + ';'
                        + this.donem + ";"
                        + this.idkademe3 + ";"
                        + JSON.stringify(this.idsinavlist) + ";"
                        + JSON.stringify(this.idsubelist) + ";"
                        + JSON.stringify(this.idderslist) + ";"
                        + JSON.stringify(this.sinifAlanList) + ";"
                        + this.icDisOgrenci, '_blank');
                }
                else {
                    Alert_Warning("Lütfen Gerekli Seçimleri Yapınız ..!");
                    return;
                }
            },

            Raporla() {

                var fullDate = new Date();
                var twoDigitMonth = fullDate.getMonth() + 1 + ""; if (twoDigitMonth.length == 1) twoDigitMonth = "0" + twoDigitMonth;
                var twoDigitDate = fullDate.getDate() + ""; if (twoDigitDate.length == 1) twoDigitDate = "0" + twoDigitDate;
                var currentDate = twoDigitDate + "/" + twoDigitMonth + "/" + fullDate.getFullYear();

                this.bugunTarih = currentDate;

                var _this = this;
                if (this.idkademe3 != 0
                    && (this.idsinavlist.length > 0 || this.idsinavlist != undefined)
                    && (this.idderslist.length > 0 || this.idderslist != undefined)
                    && (this.idsubelist.length > 0 || this.idsubelist != undefined)) {
                    this.divAc = 1;
                    var idderslist = JSON.stringify(this.idderslist);
                    var idsubelist = JSON.stringify(this.idsubelist);
                    var idsinavlist = JSON.stringify(this.idsinavlist);
                    var idsiniflist = JSON.stringify(this.idsiniflist);

                    $('#filters').collapse('hide');
                    var p = {
                        TCKIMLIKNO: session.TCKIMLIKNO,
                        OTURUM: session.OTURUM,
                        OGRENCIDONEM: this.donem,
                        ID_KADEME3: this.idkademe3,
                        ID_SINAVs: idsinavlist,
                        ID_SUBEs: idsubelist,
                        ID_DERSs: idderslist,
                        ICDISOGRENCI: this.icDisOgrenci,
                        SINIFALANLIST: JSON.stringify(this.sinifAlanList)
                    };
                    WebPost(this, "MaddeFrekansAnalizi", "MaddeFrekansAnalizi", p, "#app", "Yükleniyor...", function (data, parent) {
                        if (data != "[{}]") {
                            _this.TblVeri = JSON.parse(data)[0].TblVeri;
                            _this.TblSinavOzellik = JSON.parse(data)[0].TblSinavOzellik;
                            _this.TblDersList = JSON.parse(data)[0].TblDersList;

                            if (_this.TblVeri == undefined) {
                                Alert_Warning("Kayıt Bulunamadı..");
                                return;
                            } else {
                                parent.Grafik();
                            }


                        } else {
                            Alert_Warning("Sınav Bulunamadı..!");
                            _this.divAc = 0;
                        }
                    });
                }
                else {
                    Alert_Warning("Lütfen Gerekli Seçimleri Yapınız")
                    this.divAc = 0;
                }
                //this.$nextTick(() => { });
            },

            Grafik() {
                var _this = this;
                var siklar = ["A", "B", "C", "D", "E"];

                _this.$nextTick(() => {
                    $.each(getDistinct(_this.TblVeri, "BOLUMNO"), function (j, bolumNo) {
                        var bolum = $.grep(_this.TblVeri, function (el, i) { return el.BOLUMNO == bolumNo });
                        $.each(bolum[0].SORULIST, function (j, soruList) {
                            var datapro = [];
                            var max = 0;
                            $.each(siklar, function (i, sel) {
                                var eleman = {
                                    "yuzde": parseFloat(soruList.CEVAPLIST[sel]),
                                    "sinav": sel,
                                    "balloonTextField": soruList.CEVAPLIST[sel],
                                };
                                datapro.push(eleman);
                                max = max < parseFloat(soruList.CEVAPLIST[sel]) ? parseFloat(soruList.CEVAPLIST[sel]) : max;
                            });
                            _this.$nextTick(() => {
                                AmchartOlustur("chartdiv-" + bolumNo + "-" + soruList.SORUNO_A, datapro, max, "yuzde", "sinav", undefined, "", true);
                            });
                        });
                    });
                });
            },

        },
    });
</script>
<script src="../../../Scripts/PublicMethods.js"></script>
<script src="../../../assets/fixed-table/js/jquery.stickyheader.js?v=4"></script>
