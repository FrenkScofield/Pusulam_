<head>
    <script src="../../../Scripts/Rapor/amcharts.js"></script>
    <script src="../../../Scripts/Rapor/jquery.easypiechart.js"></script>
    <script src="../../../Scripts/Rapor/light.js"></script>
    <script src="../../../Scripts/Rapor/serial.js"></script>
</head>

<style>
    #chartdiv {
        width: 100%;
        height: 500px;
        font-size: 11px;
    }
    
    #chartdiv2 {
        width: 100%;
        height: 500px;
        font-size: 11px;
    }

    .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        font-size: 11px;
    }

    
    .table-hover>tbody>tr:hover, .table-hover>tbody>tr:hover>td {color: black !important; }

    .turuncu {
        background-color: #EA5702 !important;
        color: white !important;
        font-size: 12px !important;
    }

    .fontsize12 {
        font-size: 12px !important;
    }

    .koyumavi {
        background-color: #0E3170;
        color: white;
    }

    .acikmavi {
        background-color: #2786C3;
        color: white;
    }

    .bordermavi {
        border: #2786C3 1px solid;
        text-align: center;
        color: black;
    }

    .bordersag {
        border-right: #b4d2e6 1px solid;
        text-align: center;
    }

    .analizbaslik {
        background-color: #FFA500 !important;
    }

    .fixed-table-body {
        overflow-x: hidden !important;
    }

    .red {
        color: red;
    }
</style>

<link href="../../../assets/fixed-table/css/component.css?v=4" rel="stylesheet" />

<div class="page-head">
    <div class="page-title col-md-12">
        <h1>
            Genel Soru Analizi
             <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
</div>

<div class="row" id="app">
    <div class="col-md-12">
	    <div class="portlet box green-haze dd-item" style="border:none">
		    <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
			    <div class="caption">
				    <i class="icon-magnifier"></i>
				    <span class="caption-subject bold uppercase"> Filtreler </span>
				    <span class="caption-helper"></span>
			    </div>
			    <div class='actions'>
				    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
					    <i class='fa fa-chevron-down'></i>
				    </a>
			    </div>
		    </div>
		    <div class="portlet-body form collapse in" id="filters">
				<div class="form-body form-group-lg form-horizontal">				
                    <div id="FiltreDiv">
                        <div class="portlet-body">
                            <div class="form-inline list-group-item row">
                                <c-donem controller="GenelSoruAnalizi"
                                            @OnChange="DonemSelected">
                                </c-donem>
                                <c-sube-multi controller="GenelSoruAnalizi"
                                        @OnChange="SubeSelected">
                                </c-sube-multi>
                                <c-kademe3 controller="GenelSoruAnalizi"
                                            :idsubelist="idsubelist"
                                            @OnChange="Kademe3Selected">
                                </c-kademe3>
                                <c-sinif-alan-multi
                                            controller  = "GenelSoruAnalizi"
                                            @OnChange   = "SinifAlanSelected">
                                </c-sinif-alan-multi>
                                <c-sinif-donem-alan-multi 
                                            controller="GenelSoruAnalizi"
                                            :idsubelist="idsubelist"
                                            :idkademe3="idkademe3"
                                            :donem="donem"
                                            :sinifalan="sinifAlanList"
                                            @OnChange="SinifSelected">
                                </c-sinif-donem-alan-multi> 
                                
                                <!--<c-sinif-multi-donem controller="GenelSoruAnalizi"
                                                :idsubelist="idsubelist"
                                                :idkademe3="idkademe3"
                                                :donem="donem"
                                                @OnChange="SinifSelected">
                                </c-sinif-multi-donem>--> 
                                
                            </div>
                            <div class="form-inline list-group-item row">
                                   
                                <c-donem controller="GenelSoruAnalizi"
                                            @OnChange="SinavDonemSelected">
                                </c-donem>
                                   <c-sinav-turu-tc controller="GenelSoruAnalizi"
                                                  :donem="donemSinav"
                                                  :ogrencidonem="donem"
                                                  :idkademe3="idkademe3"
			                                      @OnChange="SinavTuruSelected">
                                    </c-sinav-turu-tc>


                                
                                    <c-sinav controller="GenelSoruAnalizi"
                                             :idsinavturu="idsinavturu"
                                             :donem="donemSinav"
                                             :ogrencidonem="donem"
                                             :idkademe3="idkademe3"
                                             @OnChange="SinavSelected">
                                    </c-sinav>   

                                <!--<c-sinav-turu-tc controller="GenelSoruAnalizi"
			                                    :tc="tcogrenci"
			                                    :idkademe3="idkademe3"
			                                    :donem="donem"
			                                    @OnChange="SinavTuruSelected">
                                </c-sinav-turu-tc>
                                    <c-sinav controller="GenelSoruAnalizi"
                                            :idsinavturu="idsinavturu"
                                            :donem="donem"
                                            :idkademe3="idkademe3"
                                            @OnChange="SinavSelected">
                                </c-sinav>-->
                                    
                                <c-ders-multi controller="GenelSoruAnalizi"
                                                :idkademe3="idkademe3"
                                                :idsinavturu="idsinavturu"
                                                @OnChange="DersSelected">
                                </c-ders-multi>
                                    <input style="float:right;" type="button" class="btn btn-success" v-on:click="Raporla" value="Raporla">                                     
                            </div>
                            <div class="form-inline list-group-item row" >
                                <c-rapor-tur-buton @Yazdir="Yazdir"> </c-rapor-tur-buton>                                 
                            </div>
                        </div>
                    </div>
    	    </div>
		    </div>
	    </div>
    </div>

    <div class="portlet light col-md-12" id="Tablodiv" style="min-height:100px;padding:0px;" v-if="divAc==1">
      <div class="comp-table" v-show="sinavAdi!=''">
          <div class="col-md-4 koyumavi" style="height: 50px;font-size: 15px;padding: inherit;text-align: center;border: 1px solid #fff !important;">SINAV ADI </div>
          <div class="col-md-8 acikmavi" style="height: 50px;font-size: 15px;padding: inherit;text-align: center;border: 1px solid #fff !important;" v-html="sinavAdi"></div>
          <div class="col-md-4 koyumavi" style="height: 50px;font-size: 15px;padding: inherit;text-align: center;border: 1px solid #fff !important;">SINAV TARİHİ </div>
          <div class="col-md-8 acikmavi" style="height: 50px;font-size: 15px;padding: inherit;text-align: center;border: 1px solid #fff !important;" v-html="sinavTarihi"></div>
      </div>
        <div class="comp-table" id="divFixedTable" >
	        <table id="tablobaslik" class="overflow-y fixed-table">
		        <thead id="thead"></thead>
		        <tbody id="tbody"></tbody>
	        </table>
        </div>
                
        <div id="YuzdeListDiv">

        </div>
            
    </div>
</div>

<script src="../../assets/global/plugins/bootstrap-select/js/i18n/defaults-tr_TR.js"></script>
<script src="../../../VueComponents/Genel.js?v=3"></script>
<script src="../../../VueComponents/GenelSinavRaporuFiltreleri.js?v=17"></script>
<script>


    var vue = new Vue({
        el: "#app",
        name: "GenelSoruAnalizi.html",

        data: {

            donem: '',
            donemSinav: '',
            idkademe3: 0,
            idsinavturu: 0,
            idsinav: 0,
            idsinavlist: [],
            idsubelist: [],
            idsiniflist: [],
            idderslist: [],
            TblVeri: [],
            TblSoruKarsilik: [],
            sinifAlanList: [],
            t3: [],
            t4: [],
            dersGenel: [],
            puanGenel: [],
            dersler: [],
            puanlar: [],
            subeler:[],
            subeler2: [],
            secim:0,

            tcGorunsun: false,
            toplamSoru: 0,
            dID_SINAVPUANTURU: 0,
            TCKIMLIKNO: '',      
            LISTE: [],
            kitapcikList:[],

            sinavAdi: '',
            sinavTarihi:'',

            divAc: 1, // 0 olacak
            tcogrenci: '',
            idkullanicitur: 0,
            ListKullaniciTipi: [],
            divOgrenci: 1,
            kurGorunsun: false



        },

        methods: {

            
            DonemSelected(item) {
                this.donem = item;
                //this.divAc = 0;
                this.divOgrenci = 0;
            },
            SinavDonemSelected(item) {
                this.donemSinav = item;
                //this.divAc = 0;
                this.divOgrenci = 0;
            },
            SubeSelected(item) {
                this.idsubelist = item;
                this.divAc = 0;
                this.divOgrenci = 0;
                ListeTemizle(this.sinifAlanList);
                ListeTemizle(this.idsiniflist);
            },
            Kademe3Selected(item) {
                this.idkademe3 = item;
                this.divAc = 0;
                this.divOgrenci = 0;
                ListeTemizle(this.sinifAlanList);
            },
            SinifAlanSelected(item) {
                //this.sinifAlanList = $.grep(item, function (el,i) { return el!='Tümü' });
                this.sinifAlanList = item;
                this.divAc = 0;
            },
            SinifSelected(item) {
                this.idsiniflist = item;
                this.divAc = 0;
                if (item.length>0)                 
                    this.divOgrenci = 1;
            },
            SinavTuruSelected(item) {
                this.idsinavturu = item;
                this.idsinav = 0;
                this.divAc = 0;
                this.kurGorunsun = false;
                
            },
            SinavSelected(item) {
                this.idsinavlist = [];
                this.idsinavlist.push(item);
                this.divAc = 0;
            },
            DersSelected(item) {
                this.idderslist = item;
                this.divAc = 0;
            },

            Yazdir(ciktiTuru) {

                if (ciktiTuru == "") {
                    Alert_Warning("Rapor Türünü Seçiniz.");
                    return;
                }
                if (this.idkademe3 != 0
                       && (this.idsinavlist.length > 0 || this.idsinavlist != undefined)
                       && (this.idderslist.length > 0 || this.idderslist != undefined)
                       && (this.idsubelist.length > 0 || this.idsubelist != undefined)) {
                    //window.open('/Rapor.aspx?rapor=Sinav.Analiz.GenelSoruAnalizi&raporTur=' + ciktiTuru + '&p=' + session.TCKIMLIKNO + ';' + session.OTURUM + ';' + this.donem + ";" + this.idkademe3 + ";" + this.idsinavturu + ";" + JSON.stringify(this.idsinavlist) + ";" + JSON.stringify(this.idsubelist) + ";" + JSON.stringify(this.idsiniflist) + ";" + JSON.stringify(this.idderslist), '_blank');
                    window.open('/Rapor.aspx?rapor=Sinav.Analiz.GenelSoruAnalizi&raporTur=' + ciktiTuru + '&p=' + session.TCKIMLIKNO + ';' + session.OTURUM + ';' + this.donem + ";"  + JSON.stringify(this.idsinavlist) + ";" + JSON.stringify(this.idsubelist) + ";" + JSON.stringify(this.idsiniflist) + ";" + JSON.stringify(this.idderslist), '_blank');
                }
                else {
                    Alert_Warning("Lütfen Gerekli Seçimleri Yapınız ..!");
                    return;
                }
            },

            Raporla: function (event) {
                this.Getir();
            },
            
            distinct(data,key){
                var distList = [];
                $.each(data, function (j,item) {
                    if (distList.indexOf(item[key]) == -1) {
                        distList.push(item[key]);
                    }
                });
                return distList;
            },

            Getir() {
                    var _this = this;
                    if (    this.idkademe3 != 0
                        && (this.idsinavlist.length > 0 || this.idsinavlist != undefined)
                        && (this.idderslist.length > 0 || this.idderslist != undefined)
                        && (this.idsubelist.length > 0 || this.idsubelist != undefined))
                    {
                        this.divAc = 1;
                        var idderslist = JSON.stringify(this.idderslist);
                        var idsubelist = JSON.stringify(this.idsubelist);
                        var idsinavlist = JSON.stringify(this.idsinavlist);
                        var idsiniflist = JSON.stringify(this.idsiniflist);

                        $('#filters').collapse('hide');
                        var p = {
                            TCKIMLIKNO: session.TCKIMLIKNO,
                            OTURUM: session.OTURUM,
                            OGRENCIDONEM: this.donem,
                            ID_SINAVs: idsinavlist,
                            ID_SUBEs: idsubelist,
                            ID_DERSs: idderslist,
                            ID_SINIFs: idsiniflist,
                        };
                        WebPost(this, "GenelSoruAnalizi", "GenelSoruAnalizi", p, "#app", "Yükleniyor...", function (data, parent) {
                            if (data != "[{}]") {
                                _this.TblVeri = JSON.parse(data)[0].TblVeri;
                                _this.TblSoruKarsilik = JSON.parse(data)[0].TblSoruKarsilik;

                                _this.sinavAdi = _this.TblVeri[0]["SINAVAD"];
                                _this.sinavTarihi = _this.TblVeri[0]["SINAVTARIH"];

                                _this.kitapcikList = _this.distinct(_this.TblSoruKarsilik, "KITAPCIK");
                          
                                parent.Listele();

                            } else {
                                Alert_Warning("Sınav Bulunamadı..!");
                                _this.divAc = 0;
                            }
                        });
                    }
                    else {
                        Alert_Warning("Lütfen Gerekli Seçimleri Yapınız")
                        this.divAc = 0;
                    }
                //this.$nextTick(() => { });
            },
            
            Listele() {

                if (this.TblVeri == undefined) {
                    $("#thead").html("");
                    $("#tbody").html("");
                    Alert_Warning("Kayıt Bulunamadı..");
                    return;
                }

                divFixedTableClear();
                this.$nextTick(() => {
                    this.Baslik();
                    this.Icerik();
                    fixedTableCreate()
                });
            },

            Baslik() {
                var _this = this;
                var TblVeri = this.TblVeri;
                var TblSoruKarsilik = this.TblSoruKarsilik;
                var kitapcikSayisi = _this.kitapcikList.length == undefined ? 1 : (_this.kitapcikList.length + 1);


                var html = '';
                html+='<tr>';
                html+='<th rowspan="2">DERS</th>';
                html += '<th rowspan="2">(A)</th>';
                $.each(_this.kitapcikList, function (j, kitapcik) {                    
                    html += '<th rowspan="2">(' + kitapcik + ')</th>';
                });
                html += '<th rowspan="2">KAZANIM</th>';

                html += '<th colspan="2">A</th>';
                html += '<th colspan="2">B</th>';
                html += '<th colspan="2">C</th>';
                html += '<th colspan="2">D</th>';
                html += '<th colspan="2">E</th>';
                html += '<th colspan="2">BOŞ</th>';
                html += '<th colspan="3">DOĞRU</th>';
                html += '</tr>';
                html += '<tr>';
                for (var i = 0; i < 6; i++) {
                    html += '<th>Cevap<br>Sayısı</th>';
                    html += '<th>Yüzde<br>%</th>';
                }
                
                html += '<th>Cevap<br>Sayısı</th>';
                html += '<th>Yüzde<br>%</th>';
                html += '<th>Cevap</th>';                

                html += '</tr>';

                $("#thead").html(html);
                
            },

            Icerik() {

                var _this = this;
                var TblVeri = this.TblVeri;
                var TblSoruKarsilik = this.TblSoruKarsilik;
                var kitapcikSayisi = _this.kitapcikList.length == undefined ? 1 : (_this.kitapcikList.length + 1);
               

                var html = '';
               
                $.each(TblVeri, function (k, soru) {
                    html += '<tr>';
                    html += '<th>' + soru.DERSAD + '</th>';
                    html += '<th>' + soru.SORUNO_A + '</th>';
                    $.each(_this.kitapcikList, function (j, kitapcik) {

                        var result = $.grep(TblSoruKarsilik, function (el, i) { return el.SORUNO_A == soru.SORUNO_A; });                        
                        html += '<th>' + result[0].SORUNO + '</th>';

                    });                    
                    html += '<th>' + soru.KAZANIM + '</th>';

                    html += '<td>' + soru.A + '</td>'; html += '<td>' + soru.AYUZDE + '</td>';
                    html += '<td>' + soru.B + '</td>'; html += '<td>' + soru.BYUZDE + '</td>';
                    html += '<td>' + soru.C + '</td>'; html += '<td>' + soru.CYUZDE + '</td>';
                    html += '<td>' + soru.D + '</td>'; html += '<td>' + soru.DYUZDE + '</td>';
                    html += '<td>' + soru.E + '</td>'; html += '<td>' + soru.EYUZDE + '</td>';
                    html += '<td>' + soru.BOS + '</td>'; html += '<td>' + soru.BOSYUZDE + '</td>';

                    var dogruCevap = soru.DOGRUCEVAP;
                    html += '<td>' + soru[soru.DOGRUCEVAP] + '</td>';

                    var stil = "";
                    var dogruYuzde = soru[soru.DOGRUCEVAP + "YUZDE"];
                    if (dogruYuzde == '-') { stil = 'style=" background: white   !important;;color: black;"'; }
                    else if (parseInt(dogruYuzde) == 0) { stil = 'style=" background: #f8696b !important;;color: black;"' }
                    else if (parseInt(dogruYuzde) < 11) { stil = 'style=" background: #f98370 !important;;color: black;"' }
                    else if (parseInt(dogruYuzde) < 21) { stil = 'style=" background: #fa9d75 !important;;color: black;"' }
                    else if (parseInt(dogruYuzde) < 31) { stil = 'style=" background: #fcb77a !important;;color: black;"' }
                    else if (parseInt(dogruYuzde) < 41) { stil = 'style=" background: #fdd17f !important;;color: black;"' }
                    else if (parseInt(dogruYuzde) < 51) { stil = 'style=" background: #ffeb84 !important;;color: black;"' }
                    else if (parseInt(dogruYuzde) < 61) { stil = 'style=" background: #e0e383 !important;;color: black;"' }
                    else if (parseInt(dogruYuzde) < 71) { stil = 'style=" background: #c1da81 !important;;color: black;"' }
                    else if (parseInt(dogruYuzde) < 81) { stil = 'style=" background: #a2d07f !important;;color: black;"' }
                    else if (parseInt(dogruYuzde) < 91) { stil = 'style=" background: #83c77d !important;;color: black;"' }
                    else if (parseInt(dogruYuzde) < 101) { stil = 'style=" background: #63be7b !important;;color: black;"' }
                    html += '<td ' + stil + '>' + dogruYuzde + '   </td>   ';
                   
                    html += '<td>' + soru.DOGRUCEVAP + '</td>';

                   
                    html += '</tr>';
                });

                    $("#tbody").html(html);

                var dersler = _this.distinct(_this.TblVeri, "DERSAD");
                var htmlBY = "";
                $.each(dersler, function (j, ders) {

                    htmlBY += '<div class="col-md-12 light portlet">';
                    htmlBY += '<table class="table table-striped table-bordered table-checkable" style="margin-bottom:0px; color:#111; margin:0px!important"><thead><tr>';
                    htmlBY += '<th class="turuncu" colspan="2">' + ders + ' Yüzde Başarı Dağılımı</th>';

                    htmlBY += '</thead><tbody>';
                    htmlBY += '<tr>';
                    var result = $.grep(TblVeri, function (el, i) { return el.DERSAD == ders && (parseInt(el[el.DOGRUCEVAP + "YUZDE"]) > 0 && parseInt(el[el.DOGRUCEVAP + "YUZDE"]) <= 10); });
                    var sonuc = result.length == undefined ? '00' : result.length;
                    htmlBY += '<td style="width: 20% !important" class="koyumavi"> %00 - 10 (' + sonuc + ')</td>';
                    htmlBY += '<td class="acikmavi">';
                    $.each(result, function (i, r) {
                        htmlBY += r.SORUNO_A;
                        if (result.length!=i+1) {htmlBY += ' , ';}
                    });
                    htmlBY += '</td>';
                    htmlBY += '</tr>';

                    htmlBY += '<tr>';
                    var result = $.grep(TblVeri, function (el, i) { return el.DERSAD == ders && (parseInt(el[el.DOGRUCEVAP+"YUZDE"]) > 10 && parseInt(el[el.DOGRUCEVAP+"YUZDE"]) <= 30); });
                    var sonuc = result.length == undefined ? '00' : result.length;
                    htmlBY += '<td class="koyumavi"> %10 - 30 (' + sonuc + ')</td>';
                    htmlBY += '<td class="acikmavi">';
                    $.each(result, function (i, r) {
                        htmlBY += r.SORUNO_A;
                        if (result.length != i + 1) { htmlBY += ' , '; }
                    });
                    htmlBY += '</td>';
                    htmlBY += '</tr>';

                    htmlBY += '<tr>';
                    var result = $.grep(TblVeri, function (el, i) { return el.DERSAD == ders && (parseInt(el[el.DOGRUCEVAP+"YUZDE"]) > 30 && parseInt(el[el.DOGRUCEVAP+"YUZDE"]) <= 50); });
                    var sonuc = result.length == undefined ? '00' : result.length;
                    htmlBY += '<td class="koyumavi"> %30 - 50 (' + sonuc + ')</td>';
                    htmlBY += '<td class="acikmavi">';
                    $.each(result, function (i, r) {
                        htmlBY += r.SORUNO_A;
                        if (result.length != i + 1) { htmlBY += ' , '; }
                    });
                    htmlBY += '</td>';
                    htmlBY += '</tr>';

                    htmlBY += '<tr>';
                    var result = $.grep(TblVeri, function (el, i) { return el.DERSAD == ders && (parseInt(el[el.DOGRUCEVAP+"YUZDE"]) > 50 && parseInt(el[el.DOGRUCEVAP+"YUZDE"]) <= 70); });
                    var sonuc = result.length == undefined ? '00' : result.length;
                    htmlBY += '<td class="koyumavi"> %50 - 70 (' + sonuc + ')</td>';
                    htmlBY += '<td class="acikmavi">';
                    $.each(result, function (i, r) {
                        htmlBY += r.SORUNO_A;
                        if (result.length != i + 1) { htmlBY += ' , '; }
                    });
                    htmlBY += '</td>';
                    htmlBY += '</tr>';

                    htmlBY += '<tr>';
                    var result = $.grep(TblVeri, function (el, i) { return el.DERSAD == ders && (parseInt(el[el.DOGRUCEVAP+"YUZDE"]) > 70 && parseInt(el[el.DOGRUCEVAP+"YUZDE"]) <= 90); });
                    var sonuc = result.length == undefined ? '00' : result.length;
                    htmlBY += '<td class="koyumavi"> %70 - 90 (' + sonuc + ')</td>';
                    htmlBY += '<td class="acikmavi">';
                    $.each(result, function (i, r) {
                        htmlBY += r.SORUNO_A;
                        if (result.length != i + 1) { htmlBY += ' , '; }
                    });
                    htmlBY += '</td>';
                    htmlBY += '</tr>';

                    htmlBY += '<tr>';
                    var result = $.grep(TblVeri, function (el, i) { return el.DERSAD == ders && (parseInt(el[el.DOGRUCEVAP+"YUZDE"]) > 90 && parseInt(el[el.DOGRUCEVAP+"YUZDE"]) <= 100); });
                    var sonuc = result.length == undefined ? '00' : result.length;
                    htmlBY += '<td class="koyumavi"> %90 - 100 (' + sonuc + ')</td>';
                    htmlBY += '<td class="acikmavi">';
                    $.each(result, function (i, r) {
                        htmlBY += r.SORUNO_A;
                        if (result.length != i + 1) { htmlBY += ' , '; }
                    });
                    htmlBY += '</td>';
                    htmlBY += '</tr>';


                    htmlBY += '</tbody></table></div>';
                });
                $("#YuzdeListDiv").html(htmlBY);



            },

        },
    });
</script>
<script src="../../../Scripts/PublicMethods.js"></script>
<script src="../../../assets/fixed-table/js/jquery.stickyheader.js?v=4"></script>
