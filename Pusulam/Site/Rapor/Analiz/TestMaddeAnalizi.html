<head>
    <script src="../../../Scripts/Rapor/amcharts.js"></script>
    <script src="../../../Scripts/Rapor/jquery.easypiechart.js"></script>
    <script src="../../../Scripts/Rapor/light.js"></script>
    <script src="../../../Scripts/Rapor/serial.js"></script>
</head>

<style>
    #chartdiv {
        width: 100%;
        height: 500px;
        font-size: 11px;
    }

    #chartdiv2 {
        width: 100%;
        height: 500px;
        font-size: 11px;
    }

    .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        font-size: 11px;
    }


    .table-hover > tbody > tr:hover, .table-hover > tbody > tr:hover > td {
        color: black !important;
    }

    .turuncu {
        background-color: #EA5702 !important;
        color: white !important;
        font-size: 12px !important;
    }

    .fontsize12 {
        font-size: 12px !important;
    }

    .koyumavi {
        background-color: #0E3170;
        color: white;
    }

    .acikmavi {
        background-color: #2786C3;
        color: white;
    }

    .bordermavi {
        border: #2786C3 1px solid;
        text-align: center;
        color: black;
    }

    .bordersag {
        border-right: #b4d2e6 1px solid;
        text-align: center;
    }

    .analizbaslik {
        background-color: #FFA500 !important;
    }

    .fixed-table-body {
        overflow-x: hidden !important;
    }

    .red {
        color: red;
    }
</style>

<link href="../../../assets/fixed-table/css/component.css?v=4" rel="stylesheet" />

<div class="page-head">
    <div class="page-title col-md-12">
        <h1>
            Test Madde Analizi
             <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
</div>

<div class="row" id="app">
    <div class="col-md-12">
        <div class="portlet box green-haze dd-item" style="border:none">
            <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Filtreler </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body collapse in" id="filters">
                <div id="FiltreDiv">
                    <div class="portlet-body">
                        <div class="form-inline list-group-item row">
                            <c-donem controller="TestMaddeAnalizi"
                                     @OnChange="DonemSelected">
                            </c-donem>
                            <c-sube-multi controller="TestMaddeAnalizi"
                                          @OnChange="SubeSelected">
                            </c-sube-multi>
                            <c-kademe3 controller="TestMaddeAnalizi"
                                       :idsubelist="idsubelist"
                                       @OnChange="Kademe3Selected">
                            </c-kademe3>
                            <div class="col-md-2">
                                <select v-model="icDisOgrenci" @change="OgrenciGrubuSelected" class="selectpicker form-control" title="Öğrenci Grubunu Seçiniz..">
                                    <option value="0"> Tüm Öğrenciler </option>
                                    <option value="1"> Sadece Okyanus Öğrencileri</option>
                                    <option value="2"> Sadece Okyanus Dışı Öğrenciler</option>
                                </select>
                            </div>
                            <div v-if="icDisOgrenci==1">
                                <c-sinif-alan-multi controller="TestMaddeAnalizi"
                                                    @OnChange="SinifAlanSelected">
                                </c-sinif-alan-multi>
                            </div>
                        </div>
                        <div class="form-inline list-group-item row">
                            <c-donem controller="TestMaddeAnalizi"
                                     @OnChange="SinavDonemSelected">
                            </c-donem>
                            <c-sinav-turu-tc controller="TestMaddeAnalizi"
                                             :donem="donemSinav"
                                             :ogrencidonem="donem"
                                             :idkademe3="idkademe3"
                                             @OnChange="SinavTuruSelected">
                            </c-sinav-turu-tc>
                            <c-sinav controller="TestMaddeAnalizi"
                                     :idsinavturu="idsinavturu"
                                     :donem="donemSinav"
                                     :ogrencidonem="donem"
                                     :idkademe3="idkademe3"
                                     @OnChange="SinavSelected">
                            </c-sinav>
                            <c-ders-multi controller="TestMaddeAnalizi"
                                          :idkademe3="idkademe3"
                                          :idsinavturu="idsinavturu"
                                          @OnChange="DersSelected">
                            </c-ders-multi>
                            <input style="float:right;" type="button" class="btn btn-success" v-on:click="Raporla" value="Raporla">
                        </div>
                        <div class="form-inline list-group-item row">
                            <c-rapor-tur-buton @Yazdir="Yazdir"> </c-rapor-tur-buton>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-12">
        <div class="portlet light" id="Tablodiv" style="min-height:100px;" v-if="divAc==1">
            <div class="row">
                <div class="comp-table" v-show="sinavAdi!=''">
                    <div class="col-md-4 koyumavi" style="height: 50px;font-size: 15px;padding: inherit;text-align: center;border: 1px solid #fff !important;">SINAV ADI </div>
                    <div class="col-md-8 acikmavi" style="height: 50px;font-size: 15px;padding: inherit;text-align: center;border: 1px solid #fff !important;" v-html="sinavAdi"></div>
                    <div class="col-md-4 koyumavi" style="height: 50px;font-size: 15px;padding: inherit;text-align: center;border: 1px solid #fff !important;">SINAV TARİHİ </div>
                    <div class="col-md-8 acikmavi" style="height: 50px;font-size: 15px;padding: inherit;text-align: center;border: 1px solid #fff !important;" v-html="sinavTarihi"></div>
                </div>
                <div class="comp-table" id="divFixedTable">
                    <table id="tablobaslik" class="overflow-y fixed-table">
                        <thead id="thead"></thead>
                        <tbody id="tbody"></tbody>
                    </table>
                </div>
            </div>

            <div class="row" v-if="TblGrup.length>0">
                <div class="col-md-6">
                    <table class="table table-striped table-bordered  table-checkable" data-width="100%" style="margin-bottom:0px; color:#111; width:100%; ">
                        <thead>
                            <tr>
                                <th colspan="3">ZORLUK DERECESİ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>0.00 - 0.19</td>
                                <td>Çok Zor</td>
                                <td>{{TblGrup[0].ZORLUK_CZ}}</td>
                            </tr>
                            <tr>
                                <td>0.20 - 0.34</td>
                                <td>Zor</td>
                                <td>{{TblGrup[0].ZORLUK_Z}}</td>
                            </tr>
                            <tr>
                                <td>0.35 - 0.64</td>
                                <td>Önerilen</td>
                                <td>{{TblGrup[0].ZORLUK_O}}</td>
                            </tr>
                            <tr>
                                <td>0.65 - 0.79</td>
                                <td>Kolay</td>
                                <td>{{TblGrup[0].ZORLUK_K}}</td>
                            </tr>
                            <tr>
                                <td>0.80 - 1.00</td>
                                <td>Çok Kolay</td>
                                <td>{{TblGrup[0].ZORLUK_CK}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-md-6">
                    <table class="table table-striped table-bordered  table-checkable" data-width="100%" style="margin-bottom:0px; color:#111; width:100%;">
                        <thead>
                            <tr>
                                <th colspan="3">AYIRICILIK GÜCÜ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>0.00 - 0.19</td>
                                <td>Zayıf</td>
                                <td>{{TblGrup[0].AYIRICILIK_Z}}</td>
                            </tr>
                            <tr>
                                <td>0.20 - 0.29</td>
                                <td>Sınırda</td>
                                <td>{{TblGrup[0].AYIRICILIK_S}}</td>
                            </tr>
                            <tr>
                                <td>0.30 - 0.39</td>
                                <td>İyi</td>
                                <td>{{TblGrup[0].AYIRICILIK_I}}</td>
                            </tr>
                            <tr>
                                <td>> 0.40</td>
                                <td>Çok İyi</td>
                                <td>{{TblGrup[0].AYIRICILIK_CI}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="row" v-if="TblBilgiBilisselSurec.length>0">
                <div class="col-md-12">
                    <table class="table table-striped table-bordered  table-checkable" data-width="100%" style="margin-bottom:0px; color:#111; width:100%;">
                        <thead>
                            <tr>
                                <th>BİLGİ - BİLİŞSEL SÜREÇ</th>
                                <th>Hatırlama</th>
                                <th>Anlama</th>
                                <th>Uygulama</th>
                                <th>Çözümleme</th>
                                <th>Değerlendirme</th>
                                <th>Yaratma</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in TblBilgiBilisselSurec">
                                <td>{{item['BİLGİ - BİLİŞSEL SÜREÇ']}}</td>
                                <td>{{item['Hatırlama']}}</td>
                                <td>{{item['Anlama']}}</td>
                                <td>{{item['Uygulama']}}</td>
                                <td>{{item['Çözümleme']}}</td>
                                <td>{{item['Değerlendirme']}}</td>
                                <td>{{item['Yaratma']}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="../../../VueComponents/Genel.js?v=3"></script>
<script src="../../../VueComponents/GenelSinavRaporuFiltreleri.js?v=17"></script>
<script>
    var vue = new Vue({
        el: "#app",
        name: "TestMaddeAnalizi.html",

        data: {
            donem: '',
            donemSinav: '',
            idkademe3: 0,
            idsinavturu: 0,
            idsinav: 0,
            sinifAlanList: [],
            idsinavlist: [],
            idsubelist: [],
            idsiniflist: [],
            idderslist: [],
            TblVeri: [],
            TblUstList: [],
            TblAltList: [],
            TblDersList: [],
            TblGrup: [],
            TblBilgiBilisselSurec: [],
            t4: [],
            dersGenel: [],
            puanGenel: [],
            dersler: [],
            puanlar: [],
            subeler: [],
            subeler2: [],
            secim: 0,
            tcGorunsun: false,
            toplamSoru: 0,
            dID_SINAVPUANTURU: 0,
            TCKIMLIKNO: '',
            LISTE: [],
            kitapcikList: [],
            sinavAdi: '',
            sinavTarihi: '',
            divAc: 0,
            tcogrenci: '',
            idkullanicitur: 0,
            ListKullaniciTipi: [],
            kurGorunsun: false,
            icDisOgrenci: 0
        },

        methods: {
            SinifAlanSelected(item) {
                this.sinifAlanList = item;
            },
            DonemSelected(item) {
                this.donem = item;
            },
            SinavDonemSelected(item) {
                this.donemSinav = item;
            },
            SubeSelected(item) {
                this.idsubelist = item;
                this.idsinif = 0;
                this.divAc = 0;
            },
            Kademe3Selected(item) {
                this.idkademe3 = item;
                this.divAc = 0;
            },
            SinifSelected(item) {
                this.idsiniflist = item;
                this.divAc = 0;
            },
            SinavTuruSelected(item) {
                this.idsinavturu = item;
                this.idsinav = 0;
                this.divAc = 0;
                this.kurGorunsun = false;
            },
            SinavSelected(item) {
                this.idsinavlist = [];
                this.idsinavlist.push(item);
                this.divAc = 0;
            },
            DersSelected(item) {
                this.idderslist = item;
                this.divAc = 0;
            },

            Yazdir(ciktiTuru) {
                if (ciktiTuru == "") {
                    Alert_Warning("Rapor Türünü Seçiniz.");
                    return;
                }
                if (this.idkademe3 != 0
                    && (this.idsinavlist.length > 0 || this.idsinavlist != undefined)
                    && (this.idderslist.length > 0 || this.idderslist != undefined)
                    && (this.idsubelist.length > 0 || this.idsubelist != undefined)) {
                    window.open('/Rapor.aspx?rapor=Sinav.Analiz.TestMaddeAnalizi&raporTur=' + ciktiTuru + '&p='
                        + session.TCKIMLIKNO + ';'
                        + session.OTURUM + ';'
                        + this.donem + ";"
                        + this.idkademe3 + ";"
                        + JSON.stringify(this.idsinavlist) + ";"
                        + JSON.stringify(this.idsubelist) + ";"
                        + JSON.stringify(this.idderslist) + ";"
                        + JSON.stringify(this.sinifAlanList) + ";"
                        + this.icDisOgrenci, '_blank');
                }
                else {
                    Alert_Warning("Lütfen Gerekli Seçimleri Yapınız ..!");
                    return;
                }
            },

            Raporla() {
                var _this = this;
                if (this.idkademe3 != 0
                    && (this.idsinavlist.length > 0 || this.idsinavlist != undefined)
                    && (this.idderslist.length > 0 || this.idderslist != undefined)
                    && (this.idsubelist.length > 0 || this.idsubelist != undefined)) {
                    this.divAc = 1;
                    var idderslist = JSON.stringify(this.idderslist);
                    var idsubelist = JSON.stringify(this.idsubelist);
                    var idsinavlist = JSON.stringify(this.idsinavlist);

                    $('#filters').collapse('hide');
                    var p = {
                        TCKIMLIKNO: session.TCKIMLIKNO,
                        OTURUM: session.OTURUM,
                        OGRENCIDONEM: this.donem,
                        ID_SINAVs: idsinavlist,
                        ID_SUBEs: idsubelist,
                        ID_DERSs: idderslist,
                        ICDISOGRENCI: this.icDisOgrenci,
                        SINIFALANLIST: JSON.stringify(this.sinifAlanList)
                    };

                    WebPost(this, "TestMaddeAnalizi", "TestMaddeAnalizi", p, "#app", "Yükleniyor...", function (data, parent) {
                        if (data != "[{}]") {
                            _this.TblVeri = JSON.parse(data)[0].TblVeri;
                            _this.TblUstList = JSON.parse(data)[0].TblUstList;
                            _this.TblAltList = JSON.parse(data)[0].TblAltList;
                            _this.TblDersList = JSON.parse(data)[0].TblDersList;
                            _this.TblGrup = JSON.parse(data)[0].TblGrup;
                            _this.TblBilgiBilisselSurec = JSON.parse(data)[0].BilgiBilisselSurec;

                            _this.sinavAdi = JSON.parse(data)[0].TblSinavOzellik[0]["SINAVAD"];
                            _this.sinavTarihi = JSON.parse(data)[0].TblSinavOzellik[0]["SINAVTARIH"];

                            parent.Listele();

                        } else {
                            Alert_Warning("Sınav Bulunamadı..!");
                            _this.divAc = 0;
                        }
                    });
                }
                else {
                    Alert_Warning("Lütfen Gerekli Seçimleri Yapınız")
                    this.divAc = 0;
                }
            },

            Listele() {
                if (this.TblVeri == undefined) {
                    $("#thead").html("");
                    $("#tbody").html("");
                    Alert_Warning("Kayıt Bulunamadı..");
                    return;
                }

                divFixedTableClear();
                this.$nextTick(() => {
                    this.Baslik();
                    this.Icerik();
                    fixedTableCreate()
                });
            },

            Baslik() {
                var _this = this;
                var TblVeri = this.TblVeri;

                var html = '';
                html += '<tr>';
                html += '<th >SORU <br> NO</th>';
                html += '<th>ÜST GRUP <br> ALT GRUP</th>';
                html += '<th>DOĞRU <br> CEVAP</th>';
                html += '<th>DOĞRU <BR> CEVAP <br> SAYISI</th>';
                html += '<th>CEVAPLAYAN <br> ÖĞRENCİ <br> SAYISI</th>';
                html += '<th>A</th>';
                html += '<th>B</th>';
                html += '<th>C</th>';
                html += '<th>D</th>';
                html += '<th>E</th>';
                html += '<th>BOŞ</th>';
                html += '<th>ZORLUK <BR> DERECESİ</th>';
                html += '<th>ZORLUK<BR> AÇIKLAMASI</th>';
                html += '<th>AYIRICILIK<BR> GÜCÜ</th>';
                html += '<th>AYIRICILIK<BR> AÇIKLAMASI</th>';
                html += '<th>VARYANS</th>';
                html += '<th>BİLGİ</th>';
                html += '<th>BİLİŞSEL SÜREÇ</th>';
                html += '</tr>';

                $("#thead").html(html);
            },

            Icerik() {
                var _this = this;
                var TblVeri = this.TblVeri;
                var TblUstList = this.TblUstList;
                var TblAltList = this.TblAltList;
                var TblDersList = this.TblDersList;

                var html = '';

                $.each(TblDersList, function (k, ders) {
                    html += '<tr>';
                    html += '<td colspan="15" style="border: white;border-style: solid;" class="acikmavi">' + ders.DERSAD + '</td>';
                    html += '<td colspan="3"  style="border: white;border-style: solid;" class="acikmavi"> Sınava Giren Öğrenci Sayısı : ' + ders.SINAVKATILIM + '</td>';
                    html += '</tr>';

                    html += '<tr>';
                    html += '<td colspan="2" style="border: white;border-style: solid;" class="acikmavi">Soru Sayısı</td>';
                    html += '<td colspan="2" style="border: white;border-style: solid;" class="acikmavi">Ortalama</td>';
                    html += '<td colspan="2" style="border: white;border-style: solid;" class="acikmavi">Standart Sapma</td>';
                    html += '<td colspan="2" style="border: white;border-style: solid;" class="acikmavi">Medyan</td>';
                    html += '<td colspan="2" style="border: white;border-style: solid;" class="acikmavi">Zorluk Derecesi</td>';
                    html += '<td colspan="2" style="border: white;border-style: solid;" class="acikmavi">Ayırıcılık Gücü</td>';
                    html += '<td colspan="3" style="border: white;border-style: solid;" class="acikmavi">Ranj</td>';
                    html += '<td colspan="3" style="border: white;border-style: solid;" class="acikmavi">Güvenirlik (KR-20)</td>';
                    html += '</tr>';

                    html += '<tr>';
                    html += '<td colspan="2" style="border: white;border-style: solid;" class="acikmavi">' + ders.SORUSAYISI + '</td>';
                    html += '<td colspan="2" style="border: white;border-style: solid;" class="acikmavi">' + ders.ORTALAMA + '</td>';
                    html += '<td colspan="2" style="border: white;border-style: solid;" class="acikmavi">' + ders.SAPMA + '</td>';
                    html += '<td colspan="2" style="border: white;border-style: solid;" class="acikmavi">' + ders.MEDYAN + '</td>';
                    html += '<td colspan="2" style="border: white;border-style: solid;" class="acikmavi">' + ders.ZORLUK + '</td>';
                    html += '<td colspan="2" style="border: white;border-style: solid;" class="acikmavi">' + ders.AYIRICILIK + '</td>';
                    html += '<td colspan="3" style="border: white;border-style: solid;" class="acikmavi">' + ders.RANJ + '</td>';
                    html += '<td colspan="3" style="border: white;border-style: solid;" class="acikmavi">' + ders.KR20 + '</td>';
                    html += '</tr>';

                    var sira = 1;
                    var result = $.grep(TblVeri, function (el, i) { return el.BOLUMNO == ders.BOLUMNO; });
                    $.each(result, function (j, veri) {
                        html += '<tr>';
                        html += '<td>' + veri.SORUNO_A + '</td>';
                        html += '<td>ÜST GRUP <br> ALT GRUP</td>';
                        html += '<td>' + veri.DOGRUCEVAP + '</td>';
                        html += '<td>' + veri.DOGRUSAYISI + '</td>';
                        html += '<td>' + veri.CEVAPLAYANSAYISI + '</td>';

                        var ust = $.grep(TblUstList, function (sel, i) { return sel.BOLUMNO == ders.BOLUMNO && sel.SORUNO_A == veri.SORUNO_A; });
                        var alt = $.grep(TblAltList, function (sel, i) { return sel.BOLUMNO == ders.BOLUMNO && sel.SORUNO_A == veri.SORUNO_A; });

                        var stil = ' style="color: red;" ';
                        html += '<td ' + (veri["DOGRUCEVAP"] == "A" ? stil : "") + '>' + ust[0].A + '<br>' + alt[0].A + '</td>';
                        html += '<td ' + (veri["DOGRUCEVAP"] == "B" ? stil : "") + '>' + ust[0].B + '<br>' + alt[0].B + '</td>';
                        html += '<td ' + (veri["DOGRUCEVAP"] == "C" ? stil : "") + '>' + ust[0].C + '<br>' + alt[0].C + '</td>';
                        html += '<td ' + (veri["DOGRUCEVAP"] == "D" ? stil : "") + '>' + ust[0].D + '<br>' + alt[0].D + '</td>';
                        html += '<td ' + (veri["DOGRUCEVAP"] == "E" ? stil : "") + '>' + ust[0].E + '<br>' + alt[0].E + '</td>';
                        html += '<td>' + ust[0].BOS + '<br>' + alt[0].BOS + '</td>';

                        html += '<td>' + veri.ZORLUKDERECESI + '</td>';
                        html += '<td>' + veri.ZORLUKACIKLAMA + '</td>';
                        html += '<td>' + veri.AYIRICILIK + '</td>';
                        html += '<td>' + veri.AYIRICILIKACIKLAMA + '</td>';
                        html += '<td>' + veri.VARYANS + '</td>';
                        html += '<td>' + veri.BILGI + '</td>';
                        html += '<td>' + veri.BILISSELSUREC + '</td>';

                        sira++;
                        html += '</tr>';
                    });

                });

                $("#tbody").html(html);
            },

            OgrenciGrubuSelected() {
                this.divAc = 0;
            },
        },
    });
</script>
<script src="../../../Scripts/PublicMethods.js"></script>
<script src="../../../assets/fixed-table/js/jquery.stickyheader.js?v=4"></script>
