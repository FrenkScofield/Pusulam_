<head>
    <script src="../../../Scripts/Rapor/amcharts.js"></script>
    <script src="../../../Scripts/Rapor/jquery.easypiechart.js"></script>
    <script src="../../../Scripts/Rapor/light.js"></script>
    <script src="../../../Scripts/Rapor/serial.js"></script>
</head>

<style>
    .chartdiv {
        width: 100%;
        height: 250px !important;
        font-size: 11px;
    }

    #chartdiv2 {
        width: 100%;
        height: 500px;
        font-size: 11px;
    }

    .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        font-size: 11px;
    }


    .table-hover > tbody > tr:hover, .table-hover > tbody > tr:hover > td {
        color: black !important;
    }

    .turuncu {
        background-color: #EA5702 !important;
        color: white !important;
        font-size: 12px !important;
    }

    .fontsize12 {
        font-size: 12px !important;
    }

    .koyumavi {
        background-color: #0E3170;
        color: white;
    }

    .acikmavi {
        background-color: #2786C3;
        color: white;
    }

    .bordermavi {
        border: #2786C3 1px solid;
        text-align: center;
        color: black;
    }

    .bordersag {
        border-right: #b4d2e6 1px solid;
        text-align: center;
    }

    .analizbaslik {
        background-color: #FFA500 !important;
    }

    .fixed-table-body {
        overflow-x: hidden !important;
    }

    .red {
        color: red;
    }
</style>

<link href="../../../assets/fixed-table/css/component.css?v=4?v=1" rel="stylesheet" />

<div class="page-head">
    <div class="page-title col-md-12">
        <h1>
            Sınıf Ders Analizi
             <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
</div>

<div id="app">
    <div class="portlet box green-haze dd-item" style="border:none">
        <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
            <div class="caption">
                <i class="icon-magnifier"></i>
                <span class="caption-subject bold uppercase"> Filtreler </span>
                <span class="caption-helper"></span>
            </div>
            <div class='actions'>
                <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                    <i class='fa fa-chevron-down'></i>
                </a>
            </div>
        </div>
        <div class="portlet-body form collapse in" id="filters">
            <form role="form" style="padding:12px 20px">
                <div class="row">
                    <c-donem controller="SinifDersAnalizi"
                             @OnChange="DonemSelected">
                    </c-donem>
                    <c-sube-multi controller="SinifDersAnalizi"
                                  @OnChange="SubeSelected">
                    </c-sube-multi>
                    <c-kademe3 controller="SinifDersAnalizi"
                               :idsubelist="idsubelist"
                               @OnChange="Kademe3Selected">
                    </c-kademe3>
                    <c-sinif-multi-donem controller="SinifDersAnalizi"
                                         :idsubelist="idsubelist"
                                         :idkademe3="idkademe3"
                                         :donem="donem"
                                         @OnChange="SinifSelected">
                    </c-sinif-multi-donem>
                </div>
                <div class="row">
                    <c-donem controller="SinifDersAnalizi"
                             @OnChange="SinavDonemSelected">
                    </c-donem>
                    <c-sinav-turu-tc-multi controller="SinifDersAnalizi"
                                           :donem="donemSinav"
                                           :ogrencidonem="donem"
                                           :idkademe3="idkademe3"
                                           @OnChange="SinavTuruSelected">
                    </c-sinav-turu-tc-multi>
                    <c-sinav-multi-multitur controller="SinifDersAnalizi"
                                            :idsinavturu="idsinavturu"
                                            :donem="donemSinav"
                                            :ogrencidonem="donem"
                                            :idkademe3="idkademe3"
                                            @OnChange="SinavSelected">
                    </c-sinav-multi-multitur>
                    <c-ders-multi-multitur controller="SinifDersAnalizi"
                                           :idkademe3="idkademe3"
                                           :idsinavturu="idsinavturu"
                                           @OnChange="DersSelected">
                    </c-ders-multi-multitur>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        Gruplama Türü:
                        <div class="row">
                            <div class="col-md-12">
                                <div class="md-radio">
                                    <input type="radio" id="radio1" name="rd" class="md-radiobtn" v-model="GRUPLAMATURU" value="3">
                                    <label for="radio1">
                                        <span></span>
                                        <span class="check"></span>
                                        <span class="box"></span> Ünite
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="md-radio">
                                    <input type="radio" id="radio2" name="rd" class="md-radiobtn" v-model="GRUPLAMATURU" value="2">
                                    <label for="radio2">
                                        <span></span>
                                        <span class="check"></span>
                                        <span class="box"></span> Konu
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="md-radio">
                                    <input type="radio" id="radio3" name="rd" class="md-radiobtn" v-model="GRUPLAMATURU" value="1">
                                    <label for="radio3">
                                        <span></span>
                                        <span class="check"></span>
                                        <span class="box"></span> Alt Konu (Kazanım)
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <input type="button" class="btn btn-success" v-on:click="Raporla" value="Raporla">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <c-rapor-tur-buton @Yazdir="Yazdir"> </c-rapor-tur-buton>
                </div>
            </form>
        </div>
    </div>

    <div class="col-md-12 portlet light" id="Tablodiv" style="min-height:100px; padding:0px;" v-if="divAc==1">
        <div class="col-md-12">
            <div class="row" style="padding-top: 10px; padding-bottom: 10px; line-height: 50px;">
                <div class="col-md-8" style="font-size: x-large;"> Okyanus Kolejleri Ölçme ve Değerlendirme Birimi </div>
                <div class="col-md-4" style="font-size: medium; text-align:right;"> Rapor Tarihi : {{bugunTarih}}</div>
            </div>
        </div>
        <div class="col-md-12 portlet light" style="background: #EA5702 !important;color:  white;text-align: center;font-size: large;">
            Sınıf Ders Analizi
        </div>
        <div v-for="sinif in TblVeri" class="col-md-12 portlet light" style="margin:0px; border-bottom-style: solid; border-bottom-width: 3px; border-bottom-color: #EA5702;">
            <div class="col-md-12 portlet-title  light">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Test</th>
                            <th>Tarih</th>
                            <th>Katılım</th>
                            <th>Şube</th>
                            <th>Sınıf</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="sinav in sinif.SINAVLIST">
                            <td>{{sinav.SINAVAD}}</td>
                            <td>{{sinav.SINAVTARIH}}</td>
                            <td>{{sinav.SINAVKATILIM}}</td>
                            <td>{{sinif.SUBEAD}}</td>
                            <td>{{sinif.SINIFAD}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="row">
                <div class="col-md-12 portlet-body light">
                    <div class="row">
                        <div class="col-md-12" style="padding-top:10px; padding-bottom:10px;">
                            <div style="background: steelblue; color: white; text-align: center; font-size: large;">Ders Yüzde Başarı Grafiği</div>
                        </div>
                        <div class="col-md-6 light">
                            <table data-height="700" class="table table-striped table-bordered table-checkable" data-width="100%" style="margin-bottom:0px; color:#111; width:100%;">
                                <thead>
                                    <tr>
                                        <th style="text-align:center" class="koyumavi">Ders</th>
                                        <th style="text-align:center" class="koyumavi">% Başarı</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="ders in sinif.DERSLIST">
                                        <td class="acikmavi">{{ders.DERSAD}}</td>
                                        <td class="acikmavi">{{ders.BOLUMYUZDESI}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-6 light" id="chartdivDersYuzde">
                            <div class="col-md-12 chartdiv" :id='"chartdiv-"+sinif.ID_SINIF' style="height:250px;"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 light">
                            <div style="background: steelblue; color: white; text-align: center; font-size: large;">Sınıf Kazanım Analizi</div>
                        </div>
                        <div class="col-md-12 light" style="margin-top:10px;">
                            <table data-height="700" class="table table-striped table-bordered table-checkable" data-width="100%" style="margin-bottom:0px; color:#111; width:100%; ">
                                <thead>
                                    <tr>
                                        <th style="text-align:center" class="koyumavi">Ders</th>
                                        <th style="text-align:center" class="koyumavi">Unite</th>
                                        <th v-if="GRUPLAMATURU == 1 || GRUPLAMATURU == 2" style="text-align:center" class="koyumavi">Konu</th>
                                        <th v-if="GRUPLAMATURU == 1" style="text-align:center" class="koyumavi">Kazanım (Alt Konu)</th>
                                        <th style="text-align:center" class="koyumavi">Doğru Cevaplayan öğr. Sayısı</th>
                                        <th style="text-align:center" class="koyumavi">Yanlış Cevaplayan Öğr. Sayısı</th>
                                        <th style="text-align:center" class="koyumavi">Boş bırakan öğr. Sayısı</th>
                                        <th style="text-align:center" class="koyumavi">% Başarı</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="kazanim in sinif.KAZANIMLIST">
                                        <td class="acikmavi" style="text-align:  left !important;">{{kazanim.DERSAD}}</td>
                                        <td class="acikmavi" style="text-align:  left !important;">{{kazanim.UNITE}}</td>
                                        <td v-if="GRUPLAMATURU == 1 || GRUPLAMATURU == 2" class="acikmavi" style="text-align:  left !important;">{{kazanim.KONU}}</td>
                                        <td v-if="GRUPLAMATURU == 1" class="acikmavi" style="text-align:  left !important;">{{kazanim.KAZANIM}}</td>
                                        <td class="acikmavi">{{kazanim.DOGRUSAYISI}}</td>
                                        <td class="acikmavi">{{kazanim.YANLISSAYISI}}</td>
                                        <td class="acikmavi">{{kazanim.BOSSAYISI}}</td>
                                        <td class="acikmavi">{{kazanim.BASARIYUZDESI}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../../../VueComponents/Genel.js?v=3"></script>
<script src="../../../VueComponents/GenelSinavRaporuFiltreleri.js?v=18"></script>
<script>
    var vue = new Vue({
        el: "#app",
        name: "SinifDersAnalizi.html",

        data: {
            GRUPLAMATURU: 1,
            donem: '',
            donemSinav: '',
            idkademe3: 0,
            idsinavturu: [],
            idsinav: 0,
            idsinavlist: [],
            idsubelist: [],
            idsiniflist: [],
            idderslist: [],
            TblVeri: [],
            TblAltList: [],
            TblBolumList: [],
            t4: [],
            dersGenel: [],
            puanGenel: [],
            dersler: [],
            puanlar: [],
            subeler: [],
            subeler2: [],
            secim: 0,
            sinavKatilim: 0,
            bugunTarih: '',
            tcGorunsun: false,
            toplamSoru: 0,
            dID_SINAVPUANTURU: 0,
            TCKIMLIKNO: '',
            LISTE: [],
            kitapcikList: [],
            sinavAdi: '',
            sinavTarihi: '',
            divAc: 0,
            tcogrenci: '',
            idkullanicitur: 0,
            ListKullaniciTipi: [],
            divOgrenci: 1,
            kurGorunsun: false
        },

        methods: {
            DonemSelected(item) {
                this.donem = item;
                this.divOgrenci = 0;
            },

            SinavDonemSelected(item) {
                this.donemSinav = item;
                this.divOgrenci = 0;
            },

            SubeSelected(item) {
                this.idsubelist = item;
                this.idsinif = 0;
                this.divAc = 0;
                this.divOgrenci = 0;
            },

            Kademe3Selected(item) {
                this.idkademe3 = item;
                this.divAc = 0;
                this.divOgrenci = 0;
            },

            SinifSelected(item) {
                this.idsiniflist = item;
                this.divAc = 0;
                if (item.length > 0)
                    this.divOgrenci = 1;
            },

            SinavTuruSelected(item) {
                this.idsinavturu = item;
                this.idsinav = 0;
                this.divAc = 0;
                this.kurGorunsun = false;
            },

            SinavSelected(item) {
                this.idsinavlist = item;
                this.divAc = 0;
            },

            DersSelected(item) {
                this.idderslist = item;
                this.divAc = 0;
            },

            Yazdir(ciktiTuru) {
                if (ciktiTuru == "") {
                    Alert_Warning("Rapor Türünü Seçiniz.");
                    return;
                }

                if (this.idkademe3 != 0
                    && (this.idsinavlist.length > 0 || this.idsinavlist != undefined)
                    && (this.idderslist.length > 0 || this.idderslist != undefined)
                    && (this.idsubelist.length > 0 || this.idsubelist != undefined)) {
                    window.open('/Rapor.aspx?rapor=Sinav.Analiz.SinifDersAnalizi&raporTur=' + ciktiTuru + '&p=' + session.TCKIMLIKNO + ';' + session.OTURUM + ';' + this.donem + ";" + this.idkademe3 + ";" + JSON.stringify(this.idsinavlist) + ";" + JSON.stringify(this.idsubelist) + ";" + JSON.stringify(this.idsiniflist) + ";" + JSON.stringify(this.idderslist) + ";" + this.GRUPLAMATURU, '_blank');
                } else {
                    Alert_Warning("Lütfen Gerekli Seçimleri Yapınız ..!");
                    return;
                }
            },

            Raporla() {
                var fullDate = new Date();
                var twoDigitMonth = fullDate.getMonth() + 1 + ""; if (twoDigitMonth.length == 1) twoDigitMonth = "0" + twoDigitMonth;
                var twoDigitDate = fullDate.getDate() + ""; if (twoDigitDate.length == 1) twoDigitDate = "0" + twoDigitDate;
                var currentDate = twoDigitDate + "/" + twoDigitMonth + "/" + fullDate.getFullYear();

                this.bugunTarih = currentDate;

                var _this = this;
                if (this.idkademe3 != 0
                    && (this.idsinavlist.length > 0 || this.idsinavlist != undefined)
                    && (this.idderslist.length > 0 || this.idderslist != undefined)
                    && (this.idsubelist.length > 0 || this.idsubelist != undefined)) {
                    this.divAc = 1;
                    var idderslist = JSON.stringify(this.idderslist);
                    var idsubelist = JSON.stringify(this.idsubelist);
                    var idsinavlist = JSON.stringify(this.idsinavlist);
                    var idsiniflist = JSON.stringify(this.idsiniflist);

                    $('#filters').collapse('hide');
                    var p = {
                        TCKIMLIKNO: session.TCKIMLIKNO,
                        OTURUM: session.OTURUM,
                        OGRENCIDONEM: this.donem,
                        ID_SINAVs: idsinavlist,
                        ID_SUBEs: idsubelist,
                        ID_DERSs: idderslist,
                        ID_SINIFs: idsiniflist,
                        GRUPLAMATURU: this.GRUPLAMATURU
                    };

                    WebPost(this, "SinifDersAnalizi", "SinifDersAnalizi", p, "#app", "Yükleniyor...", function (data, parent) {
                        if (data != "[{}]") {
                            _this.TblVeri = JSON.parse(data);

                            if (_this.TblVeri == undefined) {
                                Alert_Warning("Kayıt Bulunamadı..");
                                return;
                            } else {
                                parent.Grafik();
                            }

                        } else {
                            Alert_Warning("Sınav Bulunamadı..!");
                            _this.divAc = 0;
                        }
                    });
                }
                else {
                    Alert_Warning("Lütfen Gerekli Seçimleri Yapınız")
                    this.divAc = 0;
                }
            },

            Grafik() {
                var _this = this;
                _this.$nextTick(() => {
                    $.each(_this.TblVeri, function (j, sinif) {
                        var datapro = [];
                        var max = 0;
                        $.each(sinif.DERSLIST, function (i, ders) {
                            var eleman = {
                                "yuzde": parseFloat(ders.BOLUMYUZDESI),
                                "sinav": ders.DERSAD,
                                "balloonTextField": ders.BOLUMYUZDESI,
                            };
                            datapro.push(eleman);
                            max = max < parseFloat(ders.BOLUMYUZDESI) ? parseFloat(ders.BOLUMYUZDESI) : max;
                        });
                        _this.$nextTick(() => {
                            AmchartOlustur("chartdiv-" + sinif.ID_SINIF, datapro, max, "yuzde", "sinav", undefined, "", true);
                        });
                    });
                });
            },
        },
    });
</script>
<script src="Scripts/PublicMethods.js"></script>
<script src="assets/fixed-table/js/jquery.stickyheader.js?v=4"></script>
