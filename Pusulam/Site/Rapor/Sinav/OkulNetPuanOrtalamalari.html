
<style>
    #chartdiv {
        width: 100%;
        height: 500px;
        font-size: 11px;
    }

    .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        font-size: 11px;
    }

    
    .table-hover>tbody>tr:hover, .table-hover>tbody>tr:hover>td {color: black !important; }

    .turuncu {
        background-color: #EA5702;
        color: white;
        font-size: 12px !important;
    }

    .fontsize12 {
        font-size: 12px !important;
    }

    .koyumavi {
        background-color: #0E3170;
        color: white;
    }

    .acikmavi {
        background-color: #2786C3;
        color: white;
    }

    .bordermavi {
        border: #2786C3 1px solid;
        text-align: center;
        color: black;
    }

    .bordersag {
        border-right: #b4d2e6 1px solid;
        text-align: center;
    }

    .analizbaslik {
        background-color: #FFA500 !important;
    }

    .fixed-table-body {
        overflow-x: hidden !important;
    }

    .red {
        color: red;
    }
</style>


<link href="../../../assets/fixed-table/css/component.css?v=4" rel="stylesheet" />

<div class="page-head">
    <div class="page-title col-md-12">
        <h1>
            Okul Net - Puan Ortalamaları<small>Net - Puan Ortalamaları</small> <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
</div>

<div class="row" id="app">
    <div class="col-md-12">
	<div class="portlet box green-haze dd-item" style="border:none">
		<div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
			<div class="caption">
				<i class="icon-magnifier"></i>
				<span class="caption-subject bold uppercase"> Filtreler </span>
				<span class="caption-helper"></span>
			</div>
			<div class='actions'>
				<a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
					<i class='fa fa-chevron-down'></i>
				</a>
			</div>
		</div>
		<div class="portlet-body form collapse in" id="filters">
			<form role="form" style="padding:12px 20px">
				<div class="form-body form-group-lg form-horizontal row" style="padding: 0px;margin-top: 0px !important;">
                    <div class="portlet light col-md-12" id="FiltreDiv" style="margin:0px; border-bottom-style: solid;border-bottom-width: 3px;border-bottom-color: rgb(0, 173, 239);">
                        <div class="portlet-body">
                            <div class="form-inline">
                                <c-donem controller="OkulNetPuanOrtalamalari"
                                         @OnChange="DonemSelected">
                                </c-donem>
                                <c-sube-multi controller="OkulNetPuanOrtalamalari"
                                            @OnChange="SubeSelected">
                                </c-sube-multi>
                                <c-kademe3 controller="OkulNetPuanOrtalamalari"
                                           :idsubelist="idsubelist"
                                           @OnChange="Kademe3Selected">
                                </c-kademe3>                                
                                <c-sinif-alan-multi
                                            controller  = "OkulNetPuanOrtalamalari"
                                            @OnChange   = "SinifAlanSelected">
                                </c-sinif-alan-multi>
                                <c-sinif-donem-alan-multi 
                                            controller="OkulNetPuanOrtalamalari"
                                            :idsubelist="idsubelist"
                                            :idkademe3="idkademe3"
                                            :donem="donem"
                                            :sinifalan="sinifAlanList"
                                            v-show ="1==0"
                                            @OnChange="SinifSelected">
                                </c-sinif-donem-alan-multi> 
                            </div>
                        </div>
                    </div>
                    <div class="portlet light col-md-12" id="FiltreDiv" style="margin:0px; border-bottom-style: solid;border-bottom-width: 3px;border-bottom-color: rgb(0, 173, 239);">
                        <div class="portlet-body">
                            <div class="form-inline">
                                <c-donem controller="OkulNetPuanOrtalamalari"
                                         @OnChange="SinavDonemSelected">
                                </c-donem>

                                <c-sinav-turu-tc controller="OkulNetPuanOrtalamalari"
                                                :idkademe3="idkademe3"
                                                  :donem="sinavDonem"
                                                  :ogrencidonem="donem"
                                                @OnChange="SinavTuruSelected">
                                </c-sinav-turu-tc>
                                 <c-sinav-multi controller="OkulNetPuanOrtalamalari"
                                                :idsinavturu="idsinavturu"
                                                  :donem="sinavDonem"
                                                  :ogrencidonem="donem"
                                                :idkademe3="idkademe3"
                                         @OnChange="SinavSelected">
                                </c-sinav-multi>




                                 <input style="float:right;margin: 10px;" type="button" class="btn btn-success" v-on:click="Raporla" value="Raporla">   
                            </div>
                        </div>
                    </div>
                </div>
			</form>
		</div>
	</div>
</div>

    <div class="portlet light col-md-12" id="Tablodiv" style="min-height:100px;padding:0px;" v-if="divAc==1">
        <div class="col-md-1" style="float:right;" id="ExcelButon">
            <input style="float:right;margin: 10px;" type="button" class="btn btn-success" onclick="tableToExcel('tablobaslik', 'W3C Example Table')" value="Excel">
           </div> 
        
        <div class="comp-table" id="divFixedTable">
            <table id="tablobaslik" 
                   class="overflow-y fixed-table">
                <thead id="thead"></thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>
    </div>
</div>

<script src="../../../VueComponents/KonuAnaliziFiltreleri.js?v=3"></script>
<script src="../../../VueComponents/GenelSinavRaporuFiltreleri.js?v=17"></script>
<script>
    $("[id$=myButtonControlID]").click(function(e) {
        window.open('data:application/vnd.ms-excel,' + encodeURIComponent( $('div[id$=tablobaslik]').html()));
        e.preventDefault();
    });

    var vue = new Vue({
        el: "#app",
        name: "OkulNetPuanOrtalamalari.html",

        data: {

            donem: '',
            idkademe3: 0,
            idsinavturu: 0,
            idsinav: 0,
            idsinavlist: [],
            idsubelist: [],
            t1: [],
            t2: [],
            t3: [],
            t4: [],
            dersGenel: [],
            puanGenel: [],
            dersler: [],
            puanlar: [],
            subeler:[],
            subeler2: [],
            idsiniflist: [],
            sinifAlanList: [],

            tcGorunsun: false,
            toplamSoru: 0,
            dID_SINAVPUANTURU: 0,
            TCKIMLIKNO: '',      
            LISTE: [],

            divAc: 1, // 0 olacak
            tcogrenci: '',
            idkullanicitur: 0,
            ListKullaniciTipi: [],
            divOgrenci: 1,
            kurGorunsun: false,
            sinavDonem:'',

            asagiOkResim: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABpklEQVQ4jY2RvW7TUBTHfzZ2oFNdC7W1EyQGkJC6WErE0AEpGyxIgGBCPAEPw8wTMPSDhQ3hvUqlSijwAFFUkEttFKsJyfU9DHGuEsdFnO2ec/5f91hU6uPurjR8H6kOgGma8uz83FruOdUlAZ48fbMG/n3L5sv7d2v9NQKsucD3dIBojYiACO6D+zWe6gjKysYj0HpOUhRs6aI21rUEojWiFFIUhmTh7p8ECxU9mTBJEmZ5jrq64ub29n9GKFUuTk7QSpm3Go/rIxwHgRjlJYvLYAO0LA5aLfOU0kH28PFzL9y5U+tksX1vM2D/9VszztILPn/6kFnHQRBZrhvf3X/k3djYIOv3EaVIfg5XlG/vNLEdh829PSZJwo9vX7Pp9E/XAjgKw8h23Xir3fYALk9PKZQyYAFsx8HvdFB5TtrvZ0D31WBwZkIfhWFkuW7sdzoewK9eD10Uc44SPMtzsiUwwMphD8MwshuN2G+3PSmdCNQqm3TVsxw2mytOBK4FA9hVghfD4ZmezbqXvV4GoEajNdsrx6o2FnXQakUCcfmR3Zc1YIC/8jzRCbYNZzUAAAAASUVORK5CYII=',
            yukariOkResim: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB00lEQVQ4jZWSPWhTURiGn/N70yrNHURBFG2sJrSDii6CoEFxcxccBAc7qNS6OYmDiFKR4lA6qIvi4OaiYCFmcXCKXYpOggFxEINwm5zcP4d7Caa5Fnvg43A+vvfh5T2f4F9nmSNAI3/VmaVVNCY3E1+vzvv3ji74Y2q8kff+A5CLr1Vv+NXyDD/dby5NXfGNtA2WRiGySHy1NucfKk+z0n7P2q8vaDwuTl72bWIbPBqGiELxxDQr7Sb9uE9CAgIO+pN0w4AXq886fefq3MoyEUO2c/G7dpNe7IjTiIQUIVKklFT9KVy4zvOPTzuu5+rcoSUGgdXmM9vfmnTjHutxQBAFuMSBgJgIrTTHdhwmCUNefXjZcd1eXXGetbnaTf/EzpN87/5AScWB8n5ef31DEAeE9ElEzNk9p6lM7GPclNg2tp3Krkpp9XPrgmCZdGOy948v8uDTIp42eNpiteHc3jqP3z6EiKzC7NbM/hUkwBKplBKjNFYZrDaUTAYhAu4Oz4/uQQRSZACjNdYYPGMxSmeATfdgABAYpQYuPJ05IdwCQMkcoDVWm605EDlAKYXOQVqpQoAuBABndp/CM1mAJeOhpCwEiJHObdKNXzWoGHgyrPkDdGqej7PMgTEAAAAASUVORK5CYII=',
            

        },

        mounted() {
            //this.Getir();

            var p = {
                TCKIMLIKNO: session.TCKIMLIKNO,
                OTURUM: session.OTURUM
            };
            var list = [];
            WebPost(this, "OkulNetPuanOrtalamalari", "KullaniciTipiGetir", p, "#app", "Yükleniyor...", function (data, parent) {                
                if (data != null) {
                    $.each(data, function (j, el) {
                        list.push(this.ID_KULLANICITIPI)
                    });
                    parent.ListKullaniciTipi = list;
                    if (list.indexOf(4) > -1)
                        parent.tcogrenci = session.TCKIMLIKNO;
                } else {
                    Alert_Warning("Kullanıcı Bulunamadı..!");
                }
            });
        },

        methods: {
                        
            DonemSelected(item) {
                this.donem = item;
                this.divAc = 0;
                this.divOgrenci = 0;
            },
            SinavDonemSelected(item) {
                this.sinavDonem = item;
                this.divAc = 0;
                //this.divOgrenci = 0;
            },
            SubeSelected(item) {
                this.idsubelist = item;
                this.idsinif = 0;
                this.divAc = 0;
                this.divOgrenci = 0;
                ListeTemizle(this.sinifAlanList);
                ListeTemizle(this.idsiniflist);
            },
            Kademe3Selected(item) {
                this.idkademe3 = item;
                this.divAc = 0;
                this.divOgrenci = 0;
                ListeTemizle(this.sinifAlanList);
                ListeTemizle(this.idsiniflist);
            },
            SinifAlanSelected(item) {
                //this.sinifAlanList = $.grep(item, function (el,i) { return el!='Tümü' });
                this.sinifAlanList = item;
                this.divAc = 0;
            },
            SinifSelected(item) {
                this.idsiniflist = item;
                this.divAc = 0;
                if (item.length>0)                 
                    this.divOgrenci = 1;
            },
            SinavTuruSelected(item) {
                this.idsinavturu = item;
                this.idsinav = 0;
                this.divAc = 0;
                this.kurGorunsun = false;
                
            },
            SinavSelected(item) {
                this.idsinavlist = item;
                this.divAc = 0;
            },

            
            Raporla: function (event) {
                this.Getir();
            },
                 

            Getir() {
                var _this = this;
                if (this.idkademe3 != 0 && JSON.stringify(this.idsinavlist)!='[]' ) {
                    this.divAc = 1;
                    var idsubelist = JSON.stringify(this.idsubelist);
                    var idsiniflist = JSON.stringify(this.idsiniflist);
                    var idsinavlist = JSON.stringify(this.idsinavlist);

                    var p = {
                        TCKIMLIKNO: session.TCKIMLIKNO,
                        OTURUM: session.OTURUM,
                        DONEM: this.sinavDonem,
                        ID_KADEME3: this.idkademe3,
                        ID_SINAVTURU: this.idsinavturu,
                        ID_SINAVs: idsinavlist,
                        ID_SINIFs: idsiniflist,
                        ID_SUBEs: idsubelist,
                        OGRENCIDONEM: this.donem
                    };

                    WebPost(this, "OkulNetPuanOrtalamalari", "OkulNetPuanOrtalamalari", p, "#app", "Yükleniyor...", function (data, parent) {                        
                        if (data != null) {
                            _this.t1 = JSON.parse(data)[0].t1;
                            _this.t2 = JSON.parse(data)[0].t2;

                            _this.t3 = JSON.parse(data)[0].t3;
                            _this.t4 = JSON.parse(data)[0].t4;

                            _this.dersGenel = JSON.parse(data)[0].t5;
                            _this.puanGenel = JSON.parse(data)[0].t6;
                            
                            var result = $.grep(_this.t1, function (n, i) {return n.DERSAD != "TOPLAM"; });
                            _this.dersler = getDistinct(result, "DERSAD");
                            _this.dersler.push("TOPLAM");

                            _this.subeler = getDistinct(_this.t1, "SUBEAD");

                            _this.puanlar = getDistinct(_this.t3, "PUANTURU");
                            _this.subeler2 = getDistinct(_this.t3, "SUBEAD");

                            $('#filters').collapse('hide');

                            parent.Listele();

                        } else {
                            Alert_Warning("Sınav Bulunamadı..!");
                        }
                    });
                }
                else {
                    Alert_Warning("Lütfen Gerekli Seçimleri Yapınız")
                    this.divAc = 0;
                }
            },
            
            Listele() {

                if (this.t1 == undefined ) {
                    return;
                }

                divFixedTableClear();
                this.$nextTick(() => {
                    this.Baslik();
                    this.Icerik();
                    fixedTableCreate()
                });
            },

            Baslik() {
                var tt1 = this.t1;
                var tt2 = this.t2; // sınav listesi (ID_SINAV,SINAVAD)
                                
                var tt3 = this.t3;
                var tt4 = this.t4; // sınav listesi (ID_SINAV,SINAVAD)
                var _this = this;
                
                var derscolspan = _this.idsinavlist.length>1 ? (tt2.length+1) :1;
                var puancolspan = _this.idsinavlist.length > 1 ? (tt4.length + 1) : 1;

                
                var puanturleri = this.puanlar;
                if (puanturleri[0] == "") {
                    puanturleri[0] = undefined;
                }

                var html = '<tr>                        ';
                html += '    <th rowspan="2" class="koyumavi"> KAMPÜS </th>    ';//sabit
                $.each(_this.dersler, function (i, ders) {    
                    if (tt2!=undefined)    
                        html += '    <th colspan="'+derscolspan+'"  class="koyumavi">'+ders+' </th>    ';//sınav sayısı +1
                });
                
                // puan
                
                if (puanturleri[0] != undefined) {
                    $.each(_this.puanlar, function (j, pt) {
                        if (tt4 != undefined)
                            html += '<th colspan="' + puancolspan + '" class="turuncu"> ' + pt + ' </th>';
                    });
                }
                html += '  </tr>                    ';
                html += '<tr>';
                //sınavlar
                $.each(_this.dersler, function (i, ders) {                
                    $.each(tt2, function (j, el) {
                        html += '<th  class="acikmavi">' + el.SINAVAD + '</th>';
                    });
                    if (_this.idsinavlist.length > 1) {
                        html += '<th class="acikmavi"> </th>';
                    }                    
                });

                // puan
                if (puanturleri[0] != undefined) {
                    $.each(_this.puanlar, function (j, pt) {
                        $.each(tt4, function (j, sinav) {
                            html += '<th  class="turuncu">' + sinav.SINAVAD + '</th>';
                        });
                        if (tt4 != undefined) {
                            if (_this.idsinavlist.length > 1) {
                                html += '<th class="turuncu"> </th>';
                            }
                        }
                    });
                }
               
                
                html += '</tr>';
                $("#thead").html(html);
                
            },

            Icerik() {

                var html = '';
                var tt1 = this.t1;
                var tt3 = this.t3;

                var dersG = this.dersGenel;
                var puanG = this.puanGenel;

                var sinavlar= this.t2;
                var dersler = this.dersler;
                var subeler = this.subeler;

                var puanturleri = this.puanlar;
                if (puanturleri[0] == "") {
                    puanturleri[0] = undefined;
                }
                var sinavlar2 = this.t4;
                var _this = this;
                
                $.each(subeler, function (k, sube) {
                    html += '<tr>';                    
                    html += '<th class="acikmavi">' +sube+ '</th>';
                    $.each(dersler, function (j, ders) {
                        var girdi=false
                        var kar = '';
                        var sonNet = undefined;
                        $.each(sinavlar, function (k, sinav) {
                            var result = $.grep(tt1, function (veri, i) { return veri.DERSAD == ders && veri.SUBEAD == sube });
                            if (result.length==0) {
                                html += '<td></td>';
                            }
                            $.each(result, function (i, veri) {
                                //if (veri.DERSAD == ders && veri.SUBEAD == sube) {
                                    html += '<td> ' + veri[sinav.SINAVAD] + ' </td>';
                                    girdi = true;

                                    if ( veri[sinav.SINAVAD]== '-') {
                                        kar = '';
                                        sonNet = undefined;                                        
                                    }                                    
                                    else if (parseFloat(sonNet) > parseFloat(veri[sinav.SINAVAD])) {
                                        kar = '<img src="'+_this.asagiOkResim+'" />';
                                        sonNet = veri[sinav.SINAVAD];
                                    }
                                    else if (parseFloat(sonNet) < parseFloat(veri[sinav.SINAVAD])) {
                                        kar = '<img src="'+_this.yukariOkResim+'" />';
                                        sonNet = veri[sinav.SINAVAD];
                                    }
                                    else
                                        sonNet = veri[sinav.SINAVAD];
                                //}
                            });
                        });
                        if (_this.idsinavlist.length > 1) {
                            if (girdi == false) {
                                $.each(sinavlar, function (k, sinav) {
                                    html += '<td></td>';
                                });
                                html += '<td class="acikmavi"></td>';
                            } else {
                                html += '<td class="acikmavi"> ' + kar + ' </td>';
                            }
                        }
                    });
                    if (puanturleri[0]!=undefined) {                    
                        $.each(puanturleri, function (j, pt) {
                            var girdi=false
                            var kar = '';
                            var sonNet = undefined;
                            $.each(sinavlar2, function (k, sinav) {                            
                                $.each(tt3, function (i, veri) {
                                
                                    if (veri.PUANTURU == pt && veri.SUBEAD == sube) {
                                        html += '<td> ' + veri[sinav.SINAVAD] + ' </td>';
                                        girdi = true;
                                    
                                         if ( veri[sinav.SINAVAD]== '-') {
                                            kar = '';
                                            sonNet = undefined;                                        
                                        }                                    
                                        else if (sonNet > veri[sinav.SINAVAD]) {
                                            kar = '<img src="'+_this.asagiOkResim+'" />';
                                            sonNet = veri[sinav.SINAVAD];
                                        }
                                        else if (sonNet<veri[sinav.SINAVAD]) {
                                            kar = '<img src="'+_this.yukariOkResim+'" />';
                                            sonNet = veri[sinav.SINAVAD];
                                        }
                                        else
                                            sonNet = veri[sinav.SINAVAD];
                                    }
                                });
                            });
                            
                            if (_this.idsinavlist.length > 1) {
                                if (girdi == false) {
                                    $.each(sinavlar2, function (k, sinav) {
                                        html += '<td></td>';
                                    });
                                }
                                else {
                                    html += '<td class="turuncu">' + kar + ' </td>';
                                }
                            }
                        });
                    }

                });



                ////////////////////////////////////////////////////////// genel

                html += '<tr><th></th></tr>';

                html += '<tr>';
                html += '<th class="turuncu">Genel Ort.</th>';

                $.each(dersler, function (j, ders) {
                    var kar = '';
                    var sonNet = undefined;
                    $.each(sinavlar, function (k, sinav) {                            
                        $.each(dersG, function (i, veri) {
                                
                            if (veri.DERSAD==ders ) {
                                if (veri[sinav.SINAVAD] == undefined)
                                    html += '<td></td>';                                    
                                else
                                    html += '<td> ' + veri[sinav.SINAVAD] + ' </td>';

                                if ( veri[sinav.SINAVAD]== undefined) {
                                        kar = '';
                                        sonNet = undefined;                                        
                                    }                                    
                                    else if (sonNet > veri[sinav.SINAVAD]) {
                                        kar = '<img src="'+_this.asagiOkResim+'" />';
                                        sonNet = veri[sinav.SINAVAD];
                                    }
                                    else if (sonNet<veri[sinav.SINAVAD]) {
                                        kar = '<img src="'+_this.yukariOkResim+'" />';
                                        sonNet = veri[sinav.SINAVAD];
                                    }
                                    else
                                        sonNet = veri[sinav.SINAVAD];
                            }
                        });
                    });
                    
                    if (_this.idsinavlist.length > 1) {
                        html += '<td class="acikmavi"> ' + kar + ' </td>';
                    }
                });
                

                ////////////////////////////////////////////////////////// puanturleri

                if (puanturleri[0] != undefined ) {
                    $.each(puanturleri, function (j, pt) {
                        var kar = '';
                        var sonNet = undefined;
                        $.each(sinavlar2, function (k, sinav) {
                            $.each(puanG, function (i, veri) {

                                if (veri.PUANTURU == pt) {
                                    if (veri[sinav.SINAVAD] == undefined) {
                                        html += '<td></td>';
                                    }
                                    html += '<td> ' + veri[sinav.SINAVAD] + ' </td>';

                                if ( veri[sinav.SINAVAD]== '-') {
                                        kar = '';
                                        sonNet = undefined;                                        
                                    }                                    
                                    else if (sonNet > veri[sinav.SINAVAD]) {
                                        kar = '<img src="'+_this.asagiOkResim+'" />';
                                        sonNet = veri[sinav.SINAVAD];
                                    }
                                    else if (sonNet<veri[sinav.SINAVAD]) {
                                        kar = '<img src="'+_this.yukariOkResim+'" />';
                                        sonNet = veri[sinav.SINAVAD];
                                    }
                                    else
                                        sonNet = veri[sinav.SINAVAD];
                                }
                            });
                        });
                    if (_this.idsinavlist.length > 1) {
                        html += '<td class="turuncu">' + kar + ' </td>';
                    }
                    });
                }
                html += '</tr>';


                $("#tbody").html(html);
                return;


            },

        },
    });
</script>
<script src="../../../Scripts/PublicMethods.js"></script>

<script src="../../../assets/fixed-table/js/jquery.stickyheader.js?v=4"></script>
