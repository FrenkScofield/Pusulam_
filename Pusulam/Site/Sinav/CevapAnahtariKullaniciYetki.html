
<div class="page-head">
    <!-- BEGIN PAGE TITLE -->
    <div class="page-title col-md-12">
        <h1>
            Kullanıcı Ders Yetkilendirme <small></small> <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
    <!-- END PAGE TITLE -->
</div>

<div class="row" id="app">
    	
	<div class="col-md-12">
		<div class="portlet box green-haze dd-item" style="border:none">
			<div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
				<div class="caption">
					<i class="icon-magnifier"></i>
					<span class="caption-subject bold uppercase"> Filtreler </span>
					<span class="caption-helper"></span>
				</div>
				<div class='actions'>
					<a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
						<i class='fa fa-chevron-down'></i>
					</a>
				</div>
			</div>
			<div class="portlet-body form collapse in" id="filters">
				<form role="form" style="padding:12px 20px">
					<div class="form-body form-horizontal row">
					
                    <div class="form-body form-horizontal">
                        <div class="row">
                            <c-sube controller="CevapAnahtariKullaniciYetki"
                                    @OnChange="SubeSelected">
                            </c-sube>
                        </div>
                        <div class="row">
                            <c-kademe controller="CevapAnahtariKullaniciYetki"
                                    @OnChange="KademeSelected">
                            </c-kademe>
                        </div>
                        <div class="row">
                            <c-kademe3 controller="CevapAnahtariKullaniciYetki"
                                         :id_kademe="ID_KADEME"
                                         @OnChange="Kademe3Selected">
                            </c-kademe3>
                        </div>
                        <div class="row">
                            <c-kullanici-tipi controller="CevapAnahtariKullaniciYetki"
                                              @OnChange="KullaniciTipiSelected">
                            </c-kullanici-tipi>
                        </div>
                        <div class="row">
                            <c-kullanici controller="CevapAnahtariKullaniciYetki"
                                         :id_sube="ID_SUBE"
                                         :id_kademe3="ID_KADEME3"
                                         :idkullanicitipi="ID_KULLANICITIPI"
                                         @OnChange="KullaniciSelected">
                            </c-kullanici>
                        </div>
                    </div>
               	</div>
				</form>
			</div>
		</div>
	</div>
    <div class="col-md-12" v-if="LISTE.length>0">
        <div class="portlet light">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-list font-green"></i>
                    <span class="caption-subject bold font-green uppercase"> Ders Listesi </span>
                    <span class="caption-helper"></span>
                </div>
            </div>
            <div class="portlet-body form">
                <form role="form">
                    <div class="portlet light bordered">
                        <div class="portlet-body">
                            <table id="ogrencisonuc" class="table table-striped table-bordered table-checkable">
                                <thead>
                                    <tr>
                                        <th>DERS ADI</th>
                                        <th style="width:50px;">YETKİ</th>
                                    </tr>
                                </thead>
                                <tr v-for="u in LISTE" @click="Check(u)" style="cursor:pointer;">
                                    <td style="font-weight:600; text-align:left">{{u.DERSAD}}</td>
                                    <td style="font-weight:600;">
                                        <div class="md-checkbox" style="margin:auto!important; width:20px!important; display:block;">
                                            <input type="checkbox" v-model="u.YETKILI" :id="u.DERSAD" class="md-check" v-bind:true-value="true" v-bind:false-value="false" />
                                            <label :for="u.DERSAD">
                                                <span></span>
                                                <span class="check"></span>
                                                <span class="box"></span>
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                            </table>

                            <div class="row">
                                <div class="col-md-12 text-right" style="margin-left:0px;margin-right:0px;">
                                    <button type="button" class="btn green" @click="Kaydet">KAYDET</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="VueComponents/SubeGrupSinif.js?v=3"></script>
<script src="VueComponents/YetkilendirmeFiltreleri.js?v=3"></script>

<script>
    var vue = new Vue({
        el: "#app",
        name: "CevapAnahtariKullaniciYetki.html",

        data: {
            ID_KADEME: 0,
            ID_KULLANICITIPI: 0,
            ID_SUBE: 0,
            ID_KADEME3: 0,
            LISTE: []
        },

        mounted() {
            this.LISTE = [];
        },

        methods: {

            SubeSelected(ID_SUBE) {
                this.ID_SUBE = ID_SUBE;
                this.LISTE = [];
            },

            KademeSelected(ID_KADEME) {
                this.ID_KADEME = ID_KADEME;
            },

            Kademe3Selected(ID_KADEME3) {
                this.ID_KADEME3 = ID_KADEME3;
            },

            KullaniciTipiSelected(ID_KULLANICITIPI) {
                this.ID_KULLANICITIPI = ID_KULLANICITIPI;
                this.LISTE = [];
            },

            KullaniciSelected(TCKIMLIKNO) {
                this.TCKIMLIKNO = TCKIMLIKNO;
                this.Listele();
            },

            Listele() {
                var _idKademe = this.ID_KADEME;
                var _idKullaniciTipi = this.ID_KULLANICITIPI;
                var _tckimlikno = this.TCKIMLIKNO;
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    TC_YETKI: _tckimlikno
                };

                WebPost(this, "CevapAnahtariKullaniciYetki", "DersListele", p, '#ogrencisonuc', 'Yükleniyor..', function (data, parent) {
                    if (data != null) {
                        $('#filters').collapse('hide');
                        parent.LISTE = JSON.parse(data)[0].DersList;
                    }
                    else {
                        Alert_Warning("Seçilen kriterlere göre ders bulunamadı!");
                    }
                })
            },
            Kaydet() {
                var _idKademe = this.ID_KADEME;
                var _idKullaniciTipi = this.ID_KULLANICITIPI;

                var _tckimlikno = this.TCKIMLIKNO;
                if (_idKademe == 0 || _tckimlikno == 0) {
                    Alert_Warning("Kademe ve Kullanıcı seçimi yaptığınızdan emin olunuz!");
                    return;
                }

       

                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    TC_YETKI: _tckimlikno,
                    DERSLIST: JSON.stringify(this.LISTE)
                };
                console.log(p);

                WebPost(this, "CevapAnahtariKullaniciYetki", "KullaniciYetkiKaydet", p, '#ogrencisonuc', 'Yükleniyor..', function (data, parent) {
                    if (data ==1 ) {
                        Alert_Info("Kullanıcı Ders Yetkilendirme Tamamlanmıştır...");
                    }
                    else {
                        Alert_Warning("Kullanıcı Ders Yetkilendirme Yapılamadı..!");
                    }
                })

            },
            Check(u) {
                u.YETKILI = !u.YETKILI;
            }
        }
    });
</script>
<script src="Scripts/PublicMethods.js"></script>
