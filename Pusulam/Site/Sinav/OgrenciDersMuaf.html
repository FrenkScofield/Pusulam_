<head>
    <script src="../../../Scripts/Rapor/amcharts.js"></script>
    <script src="../../../Scripts/Rapor/jquery.easypiechart.js"></script>
    <script src="../../../Scripts/Rapor/light.js"></script>
    <script src="../../../Scripts/Rapor/serial.js"></script>
</head>

<style>
    #chartdiv {
        width: 100%;
        height: 500px;
        font-size: 11px;
    }

    #chartdiv2 {
        width: 100%;
        height: 500px;
        font-size: 11px;
    }

    .table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
        font-size: 11px;
    }


    .table-hover > tbody > tr:hover, .table-hover > tbody > tr:hover > td {
        color: black !important;
    }

    .turuncu {
        background-color: #EA5702 !important;
        color: white !important;
        font-size: 12px !important;
    }

    .fontsize12 {
        font-size: 12px !important;
    }

    .koyumavi {
        background-color: #0E3170;
        color: white;
    }

    .acikmavi {
        background-color: #2786C3;
        color: white;
    }

    .bordermavi {
        border: #2786C3 1px solid;
        text-align: center;
        color: black;
    }

    .bordersag {
        border-right: #b4d2e6 1px solid;
        text-align: center;
    }

    .analizbaslik {
        background-color: #FFA500 !important;
    }

    .fixed-table-body {
        overflow-x: hidden !important;
    }

    .red {
        color: red;
    }
</style>

<link href="../../../assets/fixed-table/css/component.css?v=4" rel="stylesheet" />

<div class="page-head">
    <div class="page-title col-md-12">
        <h1>
            Ders Muafiyet
             <span onclick="YardimGoster(ID_MENU);" class="pull-right" style="cursor:pointer;"><img src="assets/global/img/info.gif" class="info-image-icon" /> </span>
        </h1>
    </div>
</div>

<div class="row" id="app">
    <div class="col-md-12">
        <div class="portlet box green-haze dd-item" style="border:none">
            <div class="portlet-title dd-handle" data-toggle='collapse' data-target='#filters' style="cursor:pointer;">
                <div class="caption">
                    <i class="icon-magnifier"></i>
                    <span class="caption-subject bold uppercase"> Filtreler </span>
                    <span class="caption-helper"></span>
                </div>
                <div class='actions'>
                    <a href='javascript:;' class='btn btn-default btn-sm' style='border:none;'>
                        <i class='fa fa-chevron-down'></i>
                    </a>
                </div>
            </div>
            <div class="portlet-body form collapse in" id="filters">
                <div class="form-body">
                    <div class="portlet-body">
                        <form role="form">
                            <div class="row">
                                <c-sube controller="OgrenciDersMuaf"
                                        @OnChange="SubeSelected">
                                </c-sube>
                                <c-kademe3 controller="OgrenciDersMuaf"
                                           :idkademe="4"
                                           :idsube="idsube"
                                           @OnChange="Kademe3Selected">
                                </c-kademe3>
                                <c-sinif controller="OgrenciDersMuaf"
                                         :idsube="idsube"
                                         :idkademe3="idkademe3"
                                         @OnChange="SinifSelected">
                                </c-sinif>
                            </div>
                            <div class="row">
                                <div class="form-group" style="margin-top:10px;">
                                    <div class="col-md-12 text-right" style="padding-right:15px;">
                                        <button type="button" class="btn yellow" @click="Excel" style="margin-right:10px;">Excel Oluştur</button>
                                        <button type="button" class="btn green" @click="Raporla">Listele</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="portlet light col-md-12" id="Tablodiv" style="min-height:100px;padding:0px;" v-if="divAc==1">
        <div class="comp-table" id="divFixedTable">
            <table id="tablobaslik" class="overflow-y fixed-table">
                <thead id="thead">
                    <tr>
                        <th>Tc Kimlik No</th>
                        <th>Ad</th>
                        <th>Soyad</th>
                        <th>Din Kültürü</th>
                        <th>İngilizce</th>
                    </tr>
                </thead>
                <tbody id="tbody">
                    <tr v-for="u in OgrenciList">
                        <td>{{u.TCKIMLIKNO}}</td>
                        <td>{{u.AD}}</td>
                        <td>{{u.SOYAD}}</td>
                        <td>
                            <div class="form-md-line-input">
                                <div class="col-md-2" style="height:34px; vertical-align:middle;">
                                    <div class="md-checkbox" style="margin:auto!important; width:20px!important; height:20px; margin:0px; margin-top:6px; display:block;">
                                        <input type="checkbox" v-model="u.DIN_MUAF" :id='"din-"+u.TCKIMLIKNO' class="md-check" v-bind:true-value="true" v-bind:false-value="false" @change="OgrenciMuafDuzenle(u.TCKIMLIKNO,0)" />
                                        <label :for='"din-"+u.TCKIMLIKNO'>
                                            <span></span>
                                            <span class="check"></span>
                                            <span class="box"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="form-md-line-input">
                                <div class="col-md-2" style="height:34px; vertical-align:middle;">
                                    <div class="md-checkbox" style="margin:auto!important; width:20px!important; height:20px; margin:0px; margin-top:6px; display:block;">
                                        <input type="checkbox" v-model="u.ING_MUAF" :id='"ing-"+u.TCKIMLIKNO' class="md-check" v-bind:true-value="true" v-bind:false-value="false" @change="OgrenciMuafDuzenle(u.TCKIMLIKNO,1)" />
                                        <label :for='"ing-"+u.TCKIMLIKNO'>
                                            <span></span>
                                            <span class="check"></span>
                                            <span class="box"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="/VueComponents/Genel.js?v=3"></script>
<script src="/VueComponents/KonuAnaliziFiltreleri.js?v=2"></script>
<script>
    var vue = new Vue({
        el: "#app",
        name: "OgrenciDersMuaf.html",

        data: {
            idkademe3: 0,
            idsube: 0,
            idSinif: 0,
            OgrenciList: [],
            TCKIMLIKNO: '',
            divAc: 0,
            tcogrenci: '',
            idkullanicitur: 0,
            ListKullaniciTipi: [],
        },

        methods: {
            SubeSelected(item) {
                this.idsube = item;
                this.idSinif = 0;
                this.divAc = 0;
            },

            Kademe3Selected(item) {
                this.idkademe3 = item;
                this.divAc = 0;
            },

            SinifSelected(item) {
                this.idSinif = item;
                this.divAc = 0;
            },

            Raporla() {
                var _this = this;
                this.divAc = 0;
                if (this.idkademe3 > 0 && this.idSinif > 0) {
                    $('#filters').collapse('hide');
                    var p = {
                        TCKIMLIKNO: session.TCKIMLIKNO,
                        OTURUM: session.OTURUM,
                        ID_SINIF: this.idSinif,
                    };
                    WebPost(this, "OgrenciDersMuaf", "DersMuafOgrenciListele", p, "#app", "Yükleniyor...", function (data, parent) {
                        console.log(data)
                        if (data != "[{}]") {
                            _this.OgrenciList = JSON.parse(data);
                            _this.divAc = 1;
                        } else {
                            Alert_Warning("Sınav Bulunamadı..!");
                        }
                    });
                }
                else {
                    Alert_Warning("Lütfen Gerekli Seçimleri Yapınız")
                }
            },

            // ders 0 din- 1 ing
            OgrenciMuafDuzenle(tcOgrenci, ders) {
                var p = {
                    TCKIMLIKNO: session.TCKIMLIKNO,
                    OTURUM: session.OTURUM,
                    TC_OGRENCI: tcOgrenci,
                    DERS: ders,
                };
                WebPost(this, "OgrenciDersMuaf", "OgrenciMuafDuzenle", p, "#app", "Yükleniyor...", function (data, parent) {
                    if (data == true) {
                        Alert_Info("Öğrenci Ders Muafiyeti Düzenlendi.");
                    } else {
                        Alert_Warning("Öğrenci Ders Muafiyeti Düzenlenemedi..!");
                    }
                });
            },

            Excel() {
                window.open("Rapor.aspx?raporTur=XLSX&rapor=Sinav.OgrenciDersMuafiyet&p="
                    + session.TCKIMLIKNO + ";"
                    + session.OTURUM);
            }

        },
    });
</script>
<script src="../../../Scripts/PublicMethods.js"></script>
<script src="../../../assets/fixed-table/js/jquery.stickyheader.js?v=4"></script>
